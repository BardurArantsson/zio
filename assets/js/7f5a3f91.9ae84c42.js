"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[4512],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return d}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=u(a),d=r,h=m["".concat(l,".").concat(d)]||m[d]||p[d]||i;return a?n.createElement(h,o(o({ref:t},c),{},{components:a})):n.createElement(h,o({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1650:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return m}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],s={id:"histogram",title:"Histogram"},l=void 0,u={unversionedId:"datatypes/metrics/histogram",id:"datatypes/metrics/histogram",isDocsHomePage:!1,title:"Histogram",description:"A Histogram is a metric representing a collection of numerical with the distribution of the cumulative values over time. A typical use of this metric would be to track the time to serve requests.",source:"@site/docs/datatypes/metrics/histogram.md",sourceDirName:"datatypes/metrics",slug:"/datatypes/metrics/histogram",permalink:"/next/datatypes/metrics/histogram",editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/datatypes/metrics/histogram.md",tags:[],version:"current",frontMatter:{id:"histogram",title:"Histogram"},sidebar:"datatypes-sidebar",previous:{title:"Gauge",permalink:"/next/datatypes/metrics/gauge"},next:{title:"Summary",permalink:"/next/datatypes/metrics/summary"}},c=[{value:"Internals",id:"internals",children:[],level:2},{value:"API",id:"api",children:[],level:2},{value:"Use Cases",id:"use-cases",children:[],level:2},{value:"Examples",id:"examples",children:[],level:2}],p={toc:c};function m(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"A ",(0,i.kt)("inlineCode",{parentName:"p"},"Histogram")," is a metric representing a collection of numerical with the distribution of the cumulative values over time. A typical use of this metric would be to track the time to serve requests."),(0,i.kt)("p",null,"Histograms allow visualizing not only the value of the quantity being measured but its distribution. ",(0,i.kt)("strong",{parentName:"p"},"Histograms are constructed with user-specified boundaries which describe the buckets to aggregate values into"),"."),(0,i.kt)("h2",{id:"internals"},"Internals"),(0,i.kt)("p",null,"In a histogram, we assign the incoming samples to pre-defined buckets. So each data point increases the count for the bucket that it falls into, and then the individual samples are discarded. As histograms are bucketed, we can aggregate data across multiple instances. Histograms are a typical way to measure percentiles. We can look at bucket counts to estimate a specific percentile."),(0,i.kt)("p",null,"A histogram observes ",(0,i.kt)("em",{parentName:"p"},"Double")," values and counts the observed values in buckets. Each bucket is defined by an upper boundary, and the count for a bucket with the upper boundary ",(0,i.kt)("inlineCode",{parentName:"p"},"b")," increases by ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," if an observed value ",(0,i.kt)("inlineCode",{parentName:"p"},"v")," is less or\nequal to ",(0,i.kt)("inlineCode",{parentName:"p"},"b"),"."),(0,i.kt)("p",null,"As a consequence, all buckets that have a boundary ",(0,i.kt)("inlineCode",{parentName:"p"},"b1")," with b1 > b will increase by ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," after observing ",(0,i.kt)("inlineCode",{parentName:"p"},"v"),"."),(0,i.kt)("p",null,"A histogram also keeps track of the overall count of observed values, and the sum of all observed values."),(0,i.kt)("p",null,"By definition, the last bucket is always defined as ",(0,i.kt)("inlineCode",{parentName:"p"},"Double.MaxValue"),", so that the count of observed values in the last bucket is always equal to the overall count of observed values within the histogram."),(0,i.kt)("p",null,"The mental model for histogram is inspired from ",(0,i.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/concepts/metric_types/#histogram"},"Prometheus"),"."),(0,i.kt)("h2",{id:"api"},"API"),(0,i.kt)("p",null,"To define a histogram aspect, the API requires that the boundaries for the histogram are specified when creating the aspect."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"observeHistogram"))," \u2014 Create a histogram that can be applied to effects producing ",(0,i.kt)("inlineCode",{parentName:"p"},"Double")," values. The values will be counted as outlined above. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},"def observeHistogram(name: String, boundaries: Chunk[Double], tags: MetricLabel*): Histogram[Double]\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"observeHistogramWith"))," \u2014 Create a histogram that can be applied to effects producing values ",(0,i.kt)("inlineCode",{parentName:"p"},"v")," of ",(0,i.kt)("inlineCode",{parentName:"p"},"A"),". The values ",(0,i.kt)("inlineCode",{parentName:"p"},"f(v)")," will be counted as outlined above. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},"def observeHistogramWith[A](name: String, boundaries: Chunk[Double], tags: MetricLabel*)(\n  f: A => Double\n): Histogram[A]\n")),(0,i.kt)("h2",{id:"use-cases"},"Use Cases"),(0,i.kt)("p",null,"Histogram measures the frequency of value observations that fall into specific ",(0,i.kt)("em",{parentName:"p"},"pre-defined buckets"),". For example, we can measure the request duration of an HTTP request using histograms. Rather than storing every duration for every request, the histogram will make an approximation by storing the frequency of requests that fall into pre-defined particular buckets."),(0,i.kt)("p",null,"Thus, histograms are the best choice in these situations:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"When we want to observe many values and then later want to calculate the percentile of observed values"),(0,i.kt)("li",{parentName:"ul"},"When we can estimate the range of values upfront, as the histogram put the observations into pre-defined buckets"),(0,i.kt)("li",{parentName:"ul"},"When accuracy is not so important, and we don't want the exact values because of the lossy nature of bucketing data in histograms"),(0,i.kt)("li",{parentName:"ul"},"When we need to aggregate histograms across multiple instances")),(0,i.kt)("p",null,"Some examples of histogram use cases:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Request Latency"),(0,i.kt)("li",{parentName:"ul"},"Response Time")),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("p",null,"Create a histogram with 12 buckets: ",(0,i.kt)("inlineCode",{parentName:"p"},"0..100")," in steps of ",(0,i.kt)("inlineCode",{parentName:"p"},"10")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Double.MaxValue"),". It can be applied to effects yielding a ",(0,i.kt)("inlineCode",{parentName:"p"},"Double"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},'import zio._\nval histogram =\n  ZIOMetric.observeHistogram("histogram", ZIOMetric.Histogram.Boundaries.linear(0, 10, 11))\n')),(0,i.kt)("p",null,"Now we can apply the histogram to effects producing ",(0,i.kt)("inlineCode",{parentName:"p"},"Double"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-scala"},"Random.nextDoubleBetween(0.0d, 120.0d) @@ histogram\n")))}m.isMDXComponent=!0}}]);