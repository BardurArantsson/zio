"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[1396],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>m});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=i.createContext({}),c=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},s=function(e){var n=c(e.components);return i.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=c(t),m=r,y=u["".concat(p,".").concat(m)]||u[m]||d[m]||a;return t?i.createElement(y,o(o({ref:n},s),{},{components:t})):i.createElement(y,o({ref:n},s))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=u;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<a;c++)o[c]=t[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},78157:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var i=t(87462),r=(t(67294),t(3905));const a={id:"dependency-injection-in-zio",title:"Getting Started With Dependency Injection in ZIO",sidebar_label:"Getting Started"},o=void 0,l={unversionedId:"reference/di/dependency-injection-in-zio",id:"reference/di/dependency-injection-in-zio",title:"Getting Started With Dependency Injection in ZIO",description:"In this page, we will focus on essential parts of dependency injection in ZIO. So we are not going to cover all the best practices for writing ZIO services.",source:"@site/docs/reference/di/dependency-injection-in-zio.md",sourceDirName:"reference/di",slug:"/reference/di/dependency-injection-in-zio",permalink:"/reference/di/dependency-injection-in-zio",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/reference/di/dependency-injection-in-zio.md",tags:[],version:"current",frontMatter:{id:"dependency-injection-in-zio",title:"Getting Started With Dependency Injection in ZIO",sidebar_label:"Getting Started"},sidebar:"reference-sidebar",previous:{title:"Constructor as a Value",permalink:"/reference/di/zlayer-constructor-as-a-value"},next:{title:"Building Dependency Graph",permalink:"/reference/di/building-dependency-graph"}},p={},c=[{value:"Step 1: Accessing Services From The ZIO Environment",id:"step-1-accessing-services-from-the-zio-environment",level:2},{value:"Step 2: Building The Dependency Graph",id:"step-2-building-the-dependency-graph",level:2},{value:"Step 3: Providing Dependencies to the ZIO Environment",id:"step-3-providing-dependencies-to-the-zio-environment",level:2}],s={toc:c};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,i.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"In this page, we will focus on essential parts of dependency injection in ZIO. So we are not going to cover all the best practices for writing ZIO services."),(0,r.kt)("p",{parentName:"admonition"},"In real world applications, we encourage to use ",(0,r.kt)("a",{parentName:"p",href:"/reference/service-pattern/"},"service pattern")," to write ZIO services.")),(0,r.kt)("p",null,"We can achieve dependency injection through these three simple steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Accessing services from the ZIO environment through the ",(0,r.kt)("inlineCode",{parentName:"li"},"ZIO.service")," operation."),(0,r.kt)("li",{parentName:"ol"},"Building the dependency graph using manual or automatic layer construction."),(0,r.kt)("li",{parentName:"ol"},"Providing dependencies to the ZIO environment through the ",(0,r.kt)("inlineCode",{parentName:"li"},"ZIO.provideXYZ")," operations.")),(0,r.kt)("h2",{id:"step-1-accessing-services-from-the-zio-environment"},"Step 1: Accessing Services From The ZIO Environment"),(0,r.kt)("p",null,"To write application logic, we need to access services from the ZIO environment. We can do this by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"ZIO.service")," operation."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When we call ",(0,r.kt)("inlineCode",{parentName:"li"},"ZIO.service[A]"),", we are asking the ZIO environment for the ",(0,r.kt)("inlineCode",{parentName:"li"},"A")," service. So then we can access all the functionality of the ",(0,r.kt)("inlineCode",{parentName:"li"},"A")," service."),(0,r.kt)("li",{parentName:"ul"},"Accordingly, we can access all services that we need and use them in our application. Because the ZIO environment is composable, finally the type of our application will denote all the services that it needs.")),(0,r.kt)("p",null,"For example, assume we have the following services:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"import zio._\n\ntrait A {\n  def foo(): UIO[String]\n}\n\ntrait B {\n  def bar(i: String): UIO[Int]\n}\n")),(0,r.kt)("p",null,"We can write the following application logic:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"import zio._\n\n// myApp requires A and B services to fulfill its functionality\nval myApp: ZIO[A with B, Nothing, Int] =\n  for {\n    a <- ZIO.service[A] \n    r <- a.foo()\n    b <- ZIO.service[B]\n    o <- b.bar(r)\n  } yield o\n")),(0,r.kt)("h2",{id:"step-2-building-the-dependency-graph"},"Step 2: Building The Dependency Graph"),(0,r.kt)("p",null,"To be able to run our application, we need to build the dependency graph that it needs. This can be done using the ",(0,r.kt)("inlineCode",{parentName:"p"},"ZLayer")," data type. It allows us to build up the whole application's dependency graph by composing layers manually or automatically."),(0,r.kt)("p",null,"Assume each of these services has its own layer like the below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"object A {\n  val layer: ZLayer[Any, Nothing, A] = \n    ZLayer.succeed(???) \n}\n\nobject B {\n  val layer: ZLayer[Any, Nothing, B] = \n    ZLayer.succeed(???)\n}\n")),(0,r.kt)("p",null,"In the previous example, the ",(0,r.kt)("inlineCode",{parentName:"p"},"myApp")," application requires the ",(0,r.kt)("inlineCode",{parentName:"p"},"A")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"B")," services. We can build that manually by composing two ",(0,r.kt)("inlineCode",{parentName:"p"},"A")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"B")," layers horizontally:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"val appLayer: ZLayer[Any, Nothing, A with B] = \n  A.layer ++ B.layer\n")),(0,r.kt)("p",null,"Or we can use automatic layer construction:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"val appLayer: ZLayer[Any, Nothing, A with B] =\n  ZLayer.make[A with B](A.layer, B.layer)\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Automatic layer construction is useful when the dependency graph is large and complex. So in simple cases, it doesn't demonstrate the power of automatic layer construction.")),(0,r.kt)("h2",{id:"step-3-providing-dependencies-to-the-zio-environment"},"Step 3: Providing Dependencies to the ZIO Environment"),(0,r.kt)("p",null,"To run our application, we need to provide (inject) all dependencies to the ZIO environment. This can be done by using one of the ",(0,r.kt)("inlineCode",{parentName:"p"},"ZIO.provideXYZ")," operations. This allows us to propagate dependencies from button to top:"),(0,r.kt)("p",null,"Let's provide our application with the ",(0,r.kt)("inlineCode",{parentName:"p"},"appLayer"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"val result: ZIO[Any, Nothing, Int] = myApp.provideLayer(appLayer)\n")),(0,r.kt)("p",null,"Here the ",(0,r.kt)("inlineCode",{parentName:"p"},"ZLayer")," data types act as a dependency/environment eliminator. By providing required dependencies to our ZIO application, ",(0,r.kt)("inlineCode",{parentName:"p"},"ZLayer")," eliminates all dependencies from the environment of our application."),(0,r.kt)("p",null,"That's it! Now we can run our application:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"import zio._\n\nobject MainApp extends ZIOAppDefault {\n  def run = result\n}\n")),(0,r.kt)("p",null,"Usually, when we use automatic layer construction, we skip the second step and instead provide all dependencies directly to the ",(0,r.kt)("inlineCode",{parentName:"p"},"ZIO.provide")," operation. It takes care of building the dependency graph and providing the dependency graph to our ZIO application:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},"import zio._\n\nobject MainApp extends ZIOAppDefault {\n  def run = myApp.provide(A.layer, B.layer)\n}\n")))}d.isMDXComponent=!0}}]);