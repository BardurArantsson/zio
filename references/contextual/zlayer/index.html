<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-references/contextual/zlayer">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-rh="true">ZLayer | ZIO</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/references/contextual/zlayer"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ZLayer | ZIO"><meta data-rh="true" name="description" content="A ZLayer[-RIn, +E, +ROut] describes a layer of an application: every layer in an application requires some services as input RIn and produces some services as the output ROut."><meta data-rh="true" property="og:description" content="A ZLayer[-RIn, +E, +ROut] describes a layer of an application: every layer in an application requires some services as input RIn and produces some services as the output ROut."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/references/contextual/zlayer"><link data-rh="true" rel="alternate" href="https://zio.dev/references/contextual/zlayer" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/references/contextual/zlayer" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.97da2182.css">
<link rel="preload" href="/assets/js/runtime~main.4c8d210b.js" as="script">
<link rel="preload" href="/assets/js/main.b0e6b04a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/references/">References</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/references/contextual/zlayer">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/core/zio/">Core Data Types</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/references/contextual/">Contextual Types</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/references/contextual/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/references/contextual/zenvironment">ZEnvironment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/references/contextual/zlayer">ZIO Layers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/references/contextual/zlayer">ZLayer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/contextual/rlayer">RLayer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/contextual/ulayer">ULayer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/contextual/layer">Layer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/contextual/urlayer">URLayer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/contextual/tasklayer">TaskLayer</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/references/contextual/services/">Built-in Services</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/fiber/">Concurrency</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/resource/">Resource Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/stream/">Streaming</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/metrics/">Metrics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/test/">Testing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/misc/chunk">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Contextual Types</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ZIO Layers</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ZLayer</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZLayer</h1></header><p>A <code>ZLayer[-RIn, +E, +ROut]</code> describes a layer of an application: every layer in an application requires some services as input <code>RIn</code> and produces some services as the output <code>ROut</code>.</p><p>We can think of a layer as mental model of an asynchronous function from <code>RIn</code> to the <code>Either[E, ROut]</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">type</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">RIn</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">ROut</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> RIn </span><span class="token keyword">=&gt;</span><span class="token plain"> async Either</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> ROut</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For example, a <code>ZLayer[Socket &amp; Persistence, Throwable, Database]</code> can be thought of as a function that map <code>Socket</code> and <code>Persistence</code> services into <code>Database</code> service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token punctuation">(</span><span class="token plain">Socket</span><span class="token punctuation">,</span><span class="token plain"> Persistence</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Database</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we can say that the <code>Database</code> service has two dependencies: <code>Socket</code> and <code>Persistence</code> services.</p><p>In some cases, a <code>ZLayer</code> may not have any dependencies or requirements from the environment. In this case, we can specify <code>Any</code> for the <code>RIn</code> type parameter. The <a href="/references/contextual/layer"><code>Layer</code></a> type alias provided by ZIO is a convenient way to define a layer without requirements.</p><p>ZLayers are:</p><ol><li><p><strong>Recipes for Creating Services</strong> — They describe how to create services from given dependencies. For example, the <code>ZLayer[Socket &amp; Database, Throwable, UserRepo]</code> is a recipe for building a service that requires <code>Socket</code> and <code>Database</code> service, and it produces a <code>UserRepo</code> service.</p></li><li><p><strong>An Alternative to Constructors</strong> — We can think of <code>ZLayer</code> as a more powerful version of a constructor, it is an alternative way to represent a constructor. Like a constructor, it allows us to build the <code>ROut</code> service in terms of its dependencies (<code>RIn</code>).</p></li><li><p><strong>Composable</strong> — Because of their excellent <strong>composition properties</strong>, layers are the idiomatic way in ZIO to create services that depend on other services. We can define layers that are relying on each other.</p></li><li><p><strong>Effectful and Resourceful</strong> — The construction of ZIO layers can be effectful and resourceful. They can be acquired effectfully and safely released when the services are done being utilized or even in case of failure, interruption, or defects in the application. </p><p>For example, to create a recipe for a <code>Database</code> service, we should describe how the <code>Database</code> will be initialized using an acquisition action. In addition, it may contain information about how the <code>Database</code> releases its connection pools.</p></li><li><p><strong>Asynchronous</strong> — Unlike class constructors which are blocking, <code>ZLayer</code> is fully asynchronous and non-blocking. Note that in non-blocking applications we typically want to avoid creating something that is blocking inside its constructor.</p><p>For example, when we are constructing some sort of Kafka streaming service, we might want to connect to the Kafka cluster in the constructor of our service, which takes some time. So it wouldn&#x27;t be a good idea to block inside the constructor. There are some workarounds for fixing this issue, but they are not as perfect as the ZIO solution which allows for asynchronous, non-blocking constructors.</p></li><li><p><strong>Parallelism</strong> — ZIO layers can be acquired in parallel, unlike class constructors, which do not support parallelism. When we compose multiple layers and then acquire them, the construction of each layer will occur in parallel. This will reduce the initialization time of ZIO applications with a large number of dependencies.</p><p>With ZIO ZLayer, our constructor could be asynchronous, but it could also block. We can acquire resources asynchronously or in a blocking fashion, and spend some time doing that, and we don&#x27;t need to worry about it. That is not an anti-pattern. This is the best practice with ZIO. And that is because <code>ZLayer</code> has the full power of the <code>ZIO</code> data type, and as a result, we have strictly more power on our constructors with <code>ZLayer</code>.</p></li><li><p><strong>Resilient</strong> — Layer construction can be resilient. So if the acquiring phase fails, we can have a schedule to retry the acquiring stage. This helps us write apps that are error-proof and respond appropriately to failures.</p></li></ol><p>Let&#x27;s see how we can create a layer:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creation">Creation<a class="hash-link" href="#creation" title="Direct link to heading">​</a></h2><p>There are four main ways to create a ZLayer:</p><ol><li><code>ZLayer.succeed</code> for creating layers from simple values.</li><li><code>ZLayer.scoped</code> for creating layers with <em>for comprehension</em> style from resourceful effects.</li><li><code>ZLayer.apply</code>/<code>ZLayer.fromZIO</code> for creating layers with <em>for comprehension</em> style from effectual but not resourceful effects.</li><li><code>ZLayer.fromFunction</code> for creating layers that are neither effectual nor resourceful.</li></ol><p>Now let&#x27;s look at each of these methods.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-a-simple-value-or-an-existing-service">From a Simple Value or an Existing Service<a class="hash-link" href="#from-a-simple-value-or-an-existing-service" title="Direct link to heading">​</a></h3><p>With <code>ZLayer.succeed</code> we can construct a <code>ZLayer</code> from a value. It returns a <code>ULayer[A]</code> value, which represents a layer of an application that has a service of type <code>A</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> succeed</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using <code>ZLayer.succeed</code> we can create a layer containing <em>simple value</em> or a <em>service</em>:</p><ol><li>To create a layer from a <em>simple value</em>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> configLayer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">AppConfig</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, we created a <code>configLayer</code> that provides us an instance of <code>AppConfig</code>.</p><ol start="2"><li>To create a layer from an <em>existing service</em>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> EmailService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">new</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-resourceful-effects-scoped-resources">From Resourceful Effects (Scoped Resources)<a class="hash-link" href="#from-resourceful-effects-scoped-resources" title="Direct link to heading">​</a></h3><p>Some components of our applications need to be scoped, meaning they undergo a resource acquisition phase before usage, and a resource release phase after usage (e.g. when the application shuts down). As we stated before, the construction of ZIO layers can be effectful and resourceful, this means they can be acquired and safely released when the services are done being utilized.</p><p>The <code>ZLayer</code> relies on the powerful <code>Scope</code> data type and this makes this process extremely simple. We can lift any scoped <code>ZIO</code> to <code>ZLayer</code> by providing a scoped resource to the <code>ZLayer.apply</code> constructor:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">BufferedSource</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fileLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> BufferedSource</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">scoped </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fromAutoCloseable</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">scala</span><span class="token punctuation">.</span><span class="token plain">io</span><span class="token punctuation">.</span><span class="token plain">Source</span><span class="token punctuation">.</span><span class="token plain">fromFile</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see a real-world example of creating a layer from scoped resources. Assume we have the following <code>UserRepository</code> service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">Source</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">FileInputStream</span><span class="token punctuation">,</span><span class="token plain"> FileOutputStream</span><span class="token punctuation">,</span><span class="token plain"> Closeable</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> DBConfig</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Transactor</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> User</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> dbConfig</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">DBConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> initializeDb</span><span class="token punctuation">(</span><span class="token plain">config</span><span class="token operator">:</span><span class="token plain"> DBConfig</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> makeTransactor</span><span class="token punctuation">(</span><span class="token plain">config</span><span class="token operator">:</span><span class="token plain"> DBConfig</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Scope</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Transactor</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> UserRepository </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> UserRepositoryLive</span><span class="token punctuation">(</span><span class="token plain">xa</span><span class="token operator">:</span><span class="token plain"> Transactor</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> UserRepository </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Assume we have written a scoped <code>UserRepository</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> scoped</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Scope</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> UserRepository</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    cfg </span><span class="token keyword">&lt;-</span><span class="token plain"> dbConfig</span><br></span><span class="token-line"><span class="token plain">    _   </span><span class="token keyword">&lt;-</span><span class="token plain"> initializeDb</span><span class="token punctuation">(</span><span class="token plain">cfg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    xa  </span><span class="token keyword">&lt;-</span><span class="token plain"> makeTransactor</span><span class="token punctuation">(</span><span class="token plain">cfg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> UserRepositoryLive</span><span class="token punctuation">(</span><span class="token plain">xa</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can convert that to <code>ZLayer</code> with <code>ZLayer.apply</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> usersLayer </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> UserRepository</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">scoped</span><span class="token punctuation">(</span><span class="token plain">scoped</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// usersLayer: ZLayer[Any, Throwable, UserRepository] = Suspend(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   self = zio.ZLayer$$$Lambda$10315/47875903@12fd21c9</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-non-resourceful-effects">From Non-resourceful Effects<a class="hash-link" href="#from-non-resourceful-effects" title="Direct link to heading">​</a></h3><p>We can create <code>ZLayer</code> from any <code>ZIO</code> effect by using <code>ZLayer.fromZIO</code>/<code>ZLayer.apply</code> constructor.</p><p>For example, assume we have a <code>ZIO</code> effect that reads the application config from a file, we can create a layer from that:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">poolSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> loadConfig </span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> AppConfig </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> TaskLayer</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">(</span><span class="token plain">loadConfig</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token comment">// or ZLayer.fromZIO(loadConfig)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is the for-comprehension way of creating a ZIO service using <code>ZLayer.apply</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> A</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> B</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> C</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> CLive</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> B</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> C</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> CLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> B</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        a </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        b </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> CLive</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-functions">From Functions<a class="hash-link" href="#from-functions" title="Direct link to heading">​</a></h3><p>A <code>ZLayer[R, E, A]</code> can be thought of as a function from <code>R</code> to <code>A</code>. So we can convert functions to the <code>ZLayer</code> using the <code>ZLayer.fromFunction</code> constructor.</p><p>In the following example, the <code>CLive</code> implementation requires two <code>A</code> and <code>B</code> services, and we can easily convert that case class to a <code>ZLayer</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> A</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> B</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> C</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> CLive</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> B</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> C</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> CLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> B</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">fromFunction</span><span class="token punctuation">(</span><span class="token plain">CLive</span><span class="token punctuation">.</span><span class="token plain">apply _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below is a complete working example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> DatabaseConfig </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">DatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Database</span><span class="token punctuation">(</span><span class="token plain">databaseConfig</span><span class="token operator">:</span><span class="token plain"> DatabaseConfig</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">DatabaseConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Database</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">fromFunction</span><span class="token punctuation">(</span><span class="token plain">Database</span><span class="token punctuation">.</span><span class="token plain">apply _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Analytics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Analytics </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">Analytics</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">Analytics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Users</span><span class="token punctuation">(</span><span class="token plain">database</span><span class="token operator">:</span><span class="token plain"> Database</span><span class="token punctuation">,</span><span class="token plain"> analytics</span><span class="token operator">:</span><span class="token plain"> Analytics</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Users </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">fromFunction</span><span class="token punctuation">(</span><span class="token plain">Users</span><span class="token punctuation">.</span><span class="token plain">apply _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> App</span><span class="token punctuation">(</span><span class="token plain">users</span><span class="token operator">:</span><span class="token plain"> Users</span><span class="token punctuation">,</span><span class="token plain"> analytics</span><span class="token operator">:</span><span class="token plain"> Analytics</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> execute</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;This app is made from </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">users</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"> and </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">analytics</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> App </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">fromFunction</span><span class="token punctuation">(</span><span class="token plain">App</span><span class="token punctuation">.</span><span class="token plain">apply _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">App</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">execute</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token comment">// Cannot use `provide` due to this dotty bug: https://github.com/lampepfl/dotty/issues/12498</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">DatabaseConfig</span><span class="token punctuation">.</span><span class="token plain">live </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> Database</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> Analytics</span><span class="token punctuation">.</span><span class="token plain">live </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> Users</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> Analytics</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> App</span><span class="token punctuation">.</span><span class="token plain">live</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-dependency-graph">Building Dependency Graph<a class="hash-link" href="#building-dependency-graph" title="Direct link to heading">​</a></h2><p>We have two options to build a dependency graph:</p><ol><li>Manual layer construction</li><li>Automatic layer construction</li></ol><p>The first method uses ZIO&#x27;s composition operators such as horizontal (<code>++</code>) and vertical (<code>&gt;&gt;&gt;</code>) compositions. The second one uses macro and automatically creates the dependency graph at compile time.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="manual-layer-construction">Manual Layer Construction<a class="hash-link" href="#manual-layer-construction" title="Direct link to heading">​</a></h2><p>We said that we can think of the <code>ZLayer</code> as a more powerful <em>constructor</em>. Constructors are not composable, because they are not values. While a constructor is not composable, <code>ZLayer</code> has a nice facility to compose with other <code>ZLayer</code>s. So we can say that a <code>ZLayer</code> turns a constructor into values.</p><blockquote><p><strong>Note</strong>:</p><p>In a regular ZIO application we are not required to build the dependency graph through composing layers tougher. Instead, we can provide all dependencies to the ZIO application using <code>ZIO#provide</code>, and the ZIO will create the dependency graph manually under the hood. Therefore, use manual layer composition if you know what you&#x27;re doing.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertical-and-horizontal-composition">Vertical and Horizontal Composition<a class="hash-link" href="#vertical-and-horizontal-composition" title="Direct link to heading">​</a></h3><p>Assume we have several services with their dependencies, and we need a way to compose and wire up these dependencies to create the dependency graph of our application. <code>ZLayer</code> is a ZIO solution for this problem, it allows us to build up the whole application dependency graph by composing layers horizontally and vertically.</p><ol><li><strong>Horizontal Composition</strong> — Layers can be composed together horizontally with the <code>++</code> operator. When we compose layers horizontally, the new layer requires all the services that both of them require and produces all services that both of them produce. Horizontal composition is a way of composing two layers side-by-side. It is useful when we combine two layers that don&#x27;t have any relationship with each other.</li></ol><p>We can compose <code>fooLayer</code> and <code>barLayer</code> <em>horizontally</em> to build a layer that has the requirements of both, to provide the capabilities of both, through <code>fooLayer ++ barLayer</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">        </span><span class="token comment">// A ==&gt; B        // A ==&gt; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> barLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">C</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token plain">  </span><span class="token punctuation">,</span><span class="token plain"> D</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">        </span><span class="token comment">// C ==&gt; D        // C ==&gt; D</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> horizontal</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B </span><span class="token operator">&amp;</span><span class="token plain"> D</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain">  </span><span class="token comment">// A &amp; C ==&gt; B &amp; D</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fooLayer </span><span class="token operator">++</span><span class="token plain"> barLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p><strong>Vertical Composition</strong> — We can also compose layers <em>vertically</em> using the <code>&gt;&gt;&gt;</code> operator, meaning the output of one layer is used as input for the subsequent layer, resulting in one layer with the requirement of the first, and the output of the second.  </p><p>For example if we have a layer that requires <code>A</code> and produces <code>B</code>, we can compose this with another layer that requires <code>B</code> and produces <code>C</code>; this composition produces a layer that requires <code>A</code> and produces <code>C</code>. The feed operator, <code>&gt;&gt;&gt;</code>, stack them on top of each other by using vertical composition. This sort of composition is like <em>function composition</em>, feeding an output of one layer to an input of another:</p></li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">  </span><span class="token comment">// A ==&gt; B  // A ==&gt; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> barLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token plain">  </span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">  </span><span class="token comment">// B ==&gt; C  // B ==&gt; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> horizontal</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain">    </span><span class="token comment">// A ==&gt; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fooLayer </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> barLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hidden-versus-passed-through-dependencies">Hidden Versus Passed-through Dependencies<a class="hash-link" href="#hidden-versus-passed-through-dependencies" title="Direct link to heading">​</a></h3><p>ZLayer has a <code>passthrough</code> operator which returns a new layer that produces the outputs of this layer but also passes-through the inputs:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">  </span><span class="token comment">// A ==&gt; B  // A ==&gt; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result1 </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A </span><span class="token operator">&amp;</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain">  </span><span class="token comment">// A ==&gt; A &amp; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fooLayer</span><span class="token punctuation">.</span><span class="token plain">passthrough</span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result2 </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A </span><span class="token operator">&amp;</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain">  </span><span class="token comment">// A ==&gt; A &amp; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> fooLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By default, the <code>ZLayer</code> hides intermediate dependencies when composing vertically. For example, when we compose <code>fooLayer</code> with <code>barLayer</code> vertically, the output would be a <code>ZLayer[A, Throwable, C]</code>. This hides the dependency on the <code>B</code> layer. By using the above technique, we can pass through hidden dependencies.</p><p>Let&#x27;s include the <code>B</code> service into the upstream dependencies of the final layer using the <code>ZIO.service[B]</code>. We can think of <code>ZIO.service[B]</code> as an <em>identity function</em> (<code>B ==&gt; B</code>).</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">  </span><span class="token comment">// A  ==&gt; B  // A  ==&gt; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> barLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">  </span><span class="token comment">// B  ==&gt; C  // B  ==&gt; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> finalLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> B</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token comment">// A &amp; B ==&gt; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">fooLayer </span><span class="token operator">++</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> barLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or we may want to include the middle services in the output channel of the final layer, resulting in a new layer with the inputs of the first layer and the outputs of both layers:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"> </span><span class="token comment">// A  ==&gt; B // A  ==&gt; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> barLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"> </span><span class="token comment">// B  ==&gt; C // B  ==&gt; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> finalLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token comment">// A ==&gt; B &amp; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fooLayer </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">ZLayer</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> barLayer</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can do the same with the <code>&gt;+&gt;</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"> </span><span class="token comment">// A  ==&gt; B // A  ==&gt; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> barLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"> </span><span class="token comment">// B  ==&gt; C // B  ==&gt; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> finalLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token comment">// A ==&gt; B &amp; C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fooLayer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"> barLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This technique is useful when we want to defer the creation of some intermediate services and require them as part of the input of the final layer. For example, assume we have these two layers:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A    </span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">   </span><span class="token comment">// A     ==&gt; B   // A     ==&gt; B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> barLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> D</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain">   </span><span class="token comment">// B &amp; C ==&gt; D   // B &amp; C ==&gt; D</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> finalLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> D</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token comment">// A &amp; B &amp; C ==&gt; B &amp; D</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fooLayer </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> barLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we can defer the creation of the <code>C</code> layer using <code>ZLayer.service[C]</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A    </span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"> </span><span class="token comment">// A ==&gt; B  // A ==&gt; B </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> barLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> D</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"> </span><span class="token comment">// B &amp; C ==&gt; D // B &amp; C ==&gt; D</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> D</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain">        </span><span class="token comment">// A &amp; C ==&gt; D</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">fooLayer </span><span class="token operator">++</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">C</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> barLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is an example in which we passthrough all requirements to bake a <code>Cake</code> so all the requirements are available to all the downstream services: </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Baker </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Ingredients</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Oven</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Dough</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Cake</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> baker      </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Baker</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> ingredients</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Ingredients</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> oven       </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Oven</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> dough      </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Baker </span><span class="token operator">&amp;</span><span class="token plain"> Ingredients</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Dough</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> cake       </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Baker </span><span class="token operator">&amp;</span><span class="token plain"> Oven </span><span class="token operator">&amp;</span><span class="token plain"> Dough</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Cake</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> all</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Baker </span><span class="token operator">&amp;</span><span class="token plain"> Ingredients </span><span class="token operator">&amp;</span><span class="token plain"> Oven </span><span class="token operator">&amp;</span><span class="token plain"> Dough </span><span class="token operator">&amp;</span><span class="token plain"> Cake</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  baker </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain">       </span><span class="token comment">// Baker</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ingredients </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token comment">// Baker &amp; Ingredients</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  oven </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain">        </span><span class="token comment">// Baker &amp; Ingredients &amp; Oven</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  dough </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain">       </span><span class="token comment">// Baker &amp; Ingredients &amp; Oven &amp; Dough</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  cake            </span><span class="token comment">// Baker &amp; Ingredients &amp; Oven &amp; Dough &amp; Cake</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This allows a style of composition where the <code>&gt;+&gt;</code> operator is used to build a progressively larger set of services, with each new service able to depend on all the services before it. If we passthrough dependencies and later want to hide them we can do so through a simple type ascription:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> hidden</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Cake</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZLayer</code> makes it easy to mix and match these styles. If we build our dependency graph more explicitly, we can be confident that dependencies used in multiple parts of the dependency graph will only be created once due to memoization and sharing.</p><p>Using these simple operators we can build complex dependency graphs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updating-local-dependencies">Updating Local Dependencies<a class="hash-link" href="#updating-local-dependencies" title="Direct link to heading">​</a></h3><p>Given a layer, it is possible to update one or more components it provides. We update a dependency in two ways:</p><ol><li><strong>Using the <code>update</code> Method</strong> — This method allows us to replace one requirement with a different implementation:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> origin</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeedEnvironment</span><span class="token punctuation">(</span><span class="token plain">ZEnvironment</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> updated1 </span><span class="token operator">=</span><span class="token plain"> origin</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> updated2 </span><span class="token operator">=</span><span class="token plain"> origin</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> updated3 </span><span class="token operator">=</span><span class="token plain"> origin</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">0.3</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is an example of updating a config layer:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">poolSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      config </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Application config after the update operation: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">config</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> appLayers</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">AppConfig</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Application config initialized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> updatedConfig</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    appLayers</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">c </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      c</span><span class="token punctuation">.</span><span class="token plain">copy</span><span class="token punctuation">(</span><span class="token plain">poolSize </span><span class="token operator">=</span><span class="token plain"> c</span><span class="token punctuation">.</span><span class="token plain">poolSize </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">updatedConfig</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>Using Horizontal Composition</strong> — Another way to update a requirement is to horizontally compose in a layer that provides the updated service. The resulting composition will replace the old layer with the new one:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> origin</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeedEnvironment</span><span class="token punctuation">(</span><span class="token plain">ZEnvironment</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> updated </span><span class="token operator">=</span><span class="token plain"> origin </span><span class="token operator">++</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">321</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see an example of updating a config layer:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">poolSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      config </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _      </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Application config after the update operation: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">config</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> appLayers</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">AppConfig</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Application config initialized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> updatedConfig</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    appLayers </span><span class="token operator">++</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">AppConfig</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">updatedConfig</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cyclic-dependencies">Cyclic Dependencies<a class="hash-link" href="#cyclic-dependencies" title="Direct link to heading">​</a></h3><p>The <code>ZLayer</code> mechanism makes it impossible to build cyclic dependencies, making the initialization process very linear, by construction.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="automatic-layer-construction">Automatic Layer Construction<a class="hash-link" href="#automatic-layer-construction" title="Direct link to heading">​</a></h2><p>ZIO also has an automatic layer construction facility, which takes care of building dependency graphs from the individual layers and building blocks. So instead of manually composing layers together to build the final layer, we can only provide individual layers to the ZIO application, and it will do the rest.</p><p>The automatic layer construction takes place at the <em>compile-time</em>, so if there is a problem in providing a layer, we will receive an error or warning message. So it helps us to diagnose the problem. Additionally, it has a way to print the dependency graph using built-in debug layers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="providing-individual-layers-to-a-zio-application">Providing Individual Layers to a ZIO Application<a class="hash-link" href="#providing-individual-layers-to-a-zio-application" title="Direct link to heading">​</a></h3><p>When we provide individual layers using <code>ZIO#provide</code>, <code>ZIO#provideCustom</code>, or <code>ZIO#provideSome</code> to a ZIO application, the compiler will create the dependency graph automatically from the provided layers:</p><blockquote><p><strong>Note:</strong></p><p>We have a <a href="#dependency-propagation">separate section</a> that describes different methods for providing layers to the ZIO application.</p></blockquote><p>Assume we have written the following services (<code>Cake</code>, <code>Chocolate</code>, <code>Flour</code>, and <code>Spoon</code>):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Cake</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Cake </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Chocolate </span><span class="token operator">&amp;</span><span class="token plain"> Flour</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Cake</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">environment</span><span class="token punctuation">[</span><span class="token plain">Chocolate </span><span class="token operator">&amp;</span><span class="token plain"> Flour</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      cake </span><span class="token keyword">&lt;-</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Cake </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> cake</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Spoon</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Spoon </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">Spoon</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Spoon </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Chocolate</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Chocolate </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Spoon</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Chocolate</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Spoon</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">project</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Chocolate </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Flour</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Flour </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> live</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Spoon</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Flour</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Spoon</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">project</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Flour </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>Cake</code> service has the following dependency graph:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">          Cake</span><br></span><span class="token-line"><span class="token plain">          /   \</span><br></span><span class="token-line"><span class="token plain">   Chocolate   Flour</span><br></span><span class="token-line"><span class="token plain">       |         |</span><br></span><span class="token-line"><span class="token plain">     Spoon     Spoon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can write an application that uses the <code>Cake</code> service as below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Cake</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  cake </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Cake</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _    </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Yay! I baked a cake with flour and chocolate: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">cake</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The type of <code>myApp</code> indicates we should provide <code>Cake</code> to this ZIO application to run it. Let&#x27;s give it that and see what happens:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">Cake</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// error:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// ──── ZLAYER ERROR ────────────────────────────────────────────────────</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//  Please provide layers for the following 2 types:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//    Required by Cake.live</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//    1. Chocolate</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//    2. Flour</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//    </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// ──────────────────────────────────────────────────────────────────────</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here are the errors that will be printed:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">──── ZLAYER ERROR ────────────────────────────────────────────────────</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"> Please provide layers for the following 2 types:</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">   Required by Cake.live</span><br></span><span class="token-line"><span class="token plain">   1. Chocolate</span><br></span><span class="token-line"><span class="token plain">   2. Flour</span><br></span><span class="token-line"><span class="token plain">   </span><br></span><span class="token-line"><span class="token plain">──────────────────────────────────────────────────────────────────────</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It says that we missed providing <code>Chocolate</code> and <code>Flour</code> layers. Now let&#x27;s add these two missing layers:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Cake</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Chocolate</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Flour</span><span class="token punctuation">.</span><span class="token plain">live</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// error:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// ──── ZLAYER ERROR ────────────────────────────────────────────────────</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Please provide a layer for the following type:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Required by Flour.live</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// 1. Spoon</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Required by Chocolate.live</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// 1. Spoon</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// ──────────────────────────────────────────────────────────────────────</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again, the compiler asks us to provide another dependency called <code>Spoon</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">──── ZLAYER ERROR ────────────────────────────────────────────────────</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Please provide a layer for the following type:</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Required by Flour.live</span><br></span><span class="token-line"><span class="token plain">1. Spoon</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Required by Chocolate.live</span><br></span><span class="token-line"><span class="token plain">1. Spoon</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">──────────────────────────────────────────────────────────────────────</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, our application compiles without any errors: </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Cake</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Chocolate</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Flour</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Spoon</span><span class="token punctuation">.</span><span class="token plain">live  </span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the order of dependencies doesn&#x27;t matter. We can provide them in any order.</p><p>Now, let&#x27;s compare the automatic layer construction with the manual one:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layers</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">Cake</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">Spoon</span><span class="token punctuation">.</span><span class="token plain">live </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> Chocolate</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">Spoon</span><span class="token punctuation">.</span><span class="token plain">live </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> Flour</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> Cake</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">layers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automatically-assembling-layers">Automatically Assembling Layers<a class="hash-link" href="#automatically-assembling-layers" title="Direct link to heading">​</a></h3><ol><li><strong>ZLayer.make<!-- -->[R]</strong> — Using <code>ZLayer.make[R]</code>, we can provide a type <code>R</code> and then provide individual layers as arguments, it will automatically assemble these layers to create a layer of type <code>R</code>.</li></ol><p>For example, we can create a <code>Cake</code> layer as below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> cakeLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Cake</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">[</span><span class="token plain">Cake</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Cake</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Chocolate</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Flour</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Spoon</span><span class="token punctuation">.</span><span class="token plain">live</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also create a layer for intersections of services:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> chocolateAndFlourLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Chocolate </span><span class="token operator">&amp;</span><span class="token plain"> Flour</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">[</span><span class="token plain">Chocolate </span><span class="token operator">&amp;</span><span class="token plain"> Flour</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Chocolate</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Flour</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Spoon</span><span class="token punctuation">.</span><span class="token plain">live</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>ZLayer.makeSome<!-- -->[R0, R]</strong> — Automatically constructs a layer for the provided type <code>R</code>, leaving a remainder <code>R0</code>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> cakeLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Spoon</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Cake</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">makeSome</span><span class="token punctuation">[</span><span class="token plain">Spoon</span><span class="token punctuation">,</span><span class="token plain"> Cake</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Cake</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Chocolate</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Flour</span><span class="token punctuation">.</span><span class="token plain">live</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zlayer-debugging">ZLayer Debugging<a class="hash-link" href="#zlayer-debugging" title="Direct link to heading">​</a></h3><p>To debug ZLayer construction, we have two built-in layers, i.e., <code>ZLayer.Debug.tree</code> and <code>ZLayer.Debug.mermaid</code>. </p><p>Let&#x27;s include the <code>ZLayer.Debug.tree</code> layer into the layer construction:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Cake</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Chocolate</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Flour</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Spoon</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZLayer</span><span class="token punctuation">.</span><span class="token plain">Debug</span><span class="token punctuation">.</span><span class="token plain">tree</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following debug messages will be generated by the compiler:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">[info]   ZLayer Wiring Graph</span><br></span><span class="token-line"><span class="token plain">[info]</span><br></span><span class="token-line"><span class="token plain">[info] ◉ Cake.live</span><br></span><span class="token-line"><span class="token plain">[info] ├─◑ Chocolate.live</span><br></span><span class="token-line"><span class="token plain">[info] │ ╰─◑ Spoon.live</span><br></span><span class="token-line"><span class="token plain">[info] ╰─◑ Flour.live</span><br></span><span class="token-line"><span class="token plain">[info]   ╰─◑ Spoon.live</span><br></span><span class="token-line"><span class="token plain">[info] </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we use the <code>ZLayer.Debug.mermaid</code> layer, it will generate the following debug messages:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">[info]   ZLayer Wiring Graph  </span><br></span><span class="token-line"><span class="token plain">[info] </span><br></span><span class="token-line"><span class="token plain">[info] ◉ Cake.live</span><br></span><span class="token-line"><span class="token plain">[info] ├─◑ Chocolate.live</span><br></span><span class="token-line"><span class="token plain">[info] │ ╰─◑ Spoon.live</span><br></span><span class="token-line"><span class="token plain">[info] ╰─◑ Flour.live</span><br></span><span class="token-line"><span class="token plain">[info]   ╰─◑ Spoon.live</span><br></span><span class="token-line"><span class="token plain">[info] </span><br></span><span class="token-line"><span class="token plain">[info] Mermaid Live Editor Link</span><br></span><span class="token-line"><span class="token plain">[info] https://mermaid-js.github.io/mermaid-live-editor/edit/#eyJjb2RlIjoiZ3JhcGhcbiAgICBDb25zb2xlLmxpdmVcbiAgICBDYWtlLmxpdmUgLS0+IENob2NvbGF0ZS5saXZlXG4gICAgQ2FrZS5saXZlIC0tPiBGbG91ci5saXZlXG4gICAgRmxvdXIubGl2ZSAtLT4gU3Bvb24ubGl2ZVxuICAgIFNwb29uLmxpdmVcbiAgICBDaG9jb2xhdGUubGl2ZSAtLT4gU3Bvb24ubGl2ZVxuICAgICIsIm1lcm1haWQiOiAie1xuICBcInRoZW1lXCI6IFwiZGVmYXVsdFwiXG59IiwgInVwZGF0ZUVkaXRvciI6IHRydWUsICJhdXRvU3luYyI6IHRydWUsICJ1cGRhdGVEaWFncmFtIjogdHJ1ZX0=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dependency-propagation">Dependency Propagation<a class="hash-link" href="#dependency-propagation" title="Direct link to heading">​</a></h2><p>When we write an application, our application has a lot of dependencies. We need a way to provide implementations and to feed and propagate all dependencies throughout the whole application. We can solve the propagation problem by using <em>ZIO environment</em>.</p><p>During the development of an application, we don&#x27;t care about implementations. Incrementally, when we use various effects with different requirements on their environment, all parts of our application compose together, and at the end of the day we have a ZIO effect which requires some services as an environment. Before running this effect by <code>unsafeRun</code> we should provide an implementation of these services into the ZIO Environment of that effect.</p><p>ZIO has some facilities for doing this. <code>ZIO#provide</code> is the core function that allows us to <em>feed</em> an <code>R</code> to an effect that requires an <code>R</code>.</p><p>Notice that the act of <code>provide</code>ing an effect with its environment, eliminates the environment dependency in the resulting effect type, represented by type <code>Any</code> of the resulting environment.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-zioprovideenvironment-method">Using <code>ZIO#provideEnvironment</code> Method<a class="hash-link" href="#using-zioprovideenvironment-method" title="Direct link to heading">​</a></h4><p>The <code>ZIO#provideEnvironment</code> takes an instance of <code>ZEnvironment[R]</code> and provides it to the <code>ZIO</code> effect which eliminates its dependency on <code>R</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> provideEnvironment</span><span class="token punctuation">(</span><span class="token plain">r</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZEnvironment</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is similar to dependency injection, and the <code>provide*</code> function can be thought of as <em>inject</em>.</p><p>Assume we have the following services:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">EmailService</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token punctuation">,</span><span class="token plain"> content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s write a simple program using <code>EmailService</code> service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> app</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">EmailService</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> EmailService</span><span class="token punctuation">.</span><span class="token plain">send</span><span class="token punctuation">(</span><span class="token string">&quot;john@doe.com&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Hello John!&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can <code>provide</code> implementation of <code>EmailService</code> service into the <code>app</code> effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> loggingImpl </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> content</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> effect </span><span class="token operator">=</span><span class="token plain"> app</span><span class="token punctuation">.</span><span class="token plain">provideEnvironment</span><span class="token punctuation">(</span><span class="token plain">ZEnvironment</span><span class="token punctuation">(</span><span class="token plain">loggingImpl</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Most of the time, we don&#x27;t use <code>ZIO#provideEnvironment</code> directly to provide our services; instead, we use <code>ZLayer</code> to construct the dependency graph of our application, then we use methods like <code>ZIO#provide</code>, <code>ZIO#provideSome</code> and <code>ZIO#provideCustom</code> to propagate dependencies into the environment of our ZIO effect.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-zioprovide-method">Using <code>ZIO#provide</code> Method<a class="hash-link" href="#using-zioprovide-method" title="Direct link to heading">​</a></h4><p>Unlike the <code>ZIO#provideEnvironment</code> which takes a <code>ZEnvironment[R]</code>, the <code>ZIO#provide</code> takes a <code>ZLayer</code> to the ZIO effect and translates it to another level.</p><p>Assume we have written this piece of program that requires <code>Foo</code> and <code>Bar</code> services:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> Foo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Foo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Foo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">Foo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> FooLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Foo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> FooLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">Foo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">FooLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Bar </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Bar </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Bar</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">Bar</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> BarLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Bar </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> BarLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">Bar</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">BarLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Foo </span><span class="token operator">&amp;</span><span class="token plain"> Bar</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  foo  </span><span class="token keyword">&lt;-</span><span class="token plain"> Foo</span><span class="token punctuation">.</span><span class="token plain">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  bar  </span><span class="token keyword">&lt;-</span><span class="token plain"> Bar</span><span class="token punctuation">.</span><span class="token plain">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _    </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;foo: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">foo</span><span class="token string-interpolation string">, bar: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">bar</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We provide implementations of <code>Foo</code>, <code>Bar</code> services to the <code>myApp</code> effect by using <code>ZIO#provide</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> mainEffect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">FooLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"> BarLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As we see, the type of our effect converted from <code>ZIO[Foo &amp; Bar, Nothing, Unit]</code> which requires two services to <code>ZIO[Any, Nothing, Unit]</code> effect which doesn&#x27;t require any services.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-zioprovidesome-method">Using <code>ZIO#provideSome</code> Method<a class="hash-link" href="#using-zioprovidesome-method" title="Direct link to heading">​</a></h4><p>Sometimes we have written a program, and we don&#x27;t want to provide all its requirements. In these cases, we can use <code>ZIO#provideSome</code> to partially apply some layers to the <code>ZIO</code> effect.</p><p>In the previous example, if we just want to provide the <code>Foo</code>, we should use <code>ZIO#provideSome</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> mainEffectSome</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Bar</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  myApp</span><span class="token punctuation">.</span><span class="token plain">provideSome</span><span class="token punctuation">(</span><span class="token plain">FooLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>Note:</strong></p><p>When using <code>ZIO#provideSome[R0]</code>, we should provide the remaining type as <code>R0</code> type parameter. This workaround helps the compiler to infer the proper types.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment-scope">Environment Scope<a class="hash-link" href="#environment-scope" title="Direct link to heading">​</a></h2><p>We can create a ZIO application by providing a local or a global environment, or a combination:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="global-environment">Global Environment<a class="hash-link" href="#global-environment" title="Direct link to heading">​</a></h3><p>It is usual when writing ZIO applications to provide layers at the end of the world. Then we provide layers to the whole ZIO application all at once. This pattern uses a single global environment for all ZIO applications:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceA </span><span class="token operator">&amp;</span><span class="token plain"> ServiceB </span><span class="token operator">&amp;</span><span class="token plain"> ServiceC </span><span class="token operator">&amp;</span><span class="token plain"> ServiceD</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">,</span><span class="token plain"> c</span><span class="token punctuation">,</span><span class="token plain"> d</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-environment">Local Environment<a class="hash-link" href="#local-environment" title="Direct link to heading">​</a></h3><p>Occasionally, we may need to provide different environments for different parts of our application, or it may be necessary to provide a single global environment for the entire application except for some inner layers. </p><p>Providing a layer locally is analogous to overriding a method in an object-oriented paradigm. So we can think of that as overriding the global environment:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">def</span><span class="token plain"> innerApp1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">def</span><span class="token plain"> innerApp2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain">     Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">    innerApp1</span><span class="token punctuation">.</span><span class="token plain">provideSomeLayer</span><span class="token punctuation">[</span><span class="token plain">A </span><span class="token operator">&amp;</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">localC</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> innerApp2</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">globalA</span><span class="token punctuation">,</span><span class="token plain"> globalB</span><span class="token punctuation">,</span><span class="token plain"> globalC</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Test&#x27;s <a href="/references/test/environment/live">Live service</a> uses this pattern to provide real environment to a single part of an effect.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="layer-memoization">Layer Memoization<a class="hash-link" href="#layer-memoization" title="Direct link to heading">​</a></h2><p>Layer memoization allows a layer to be created once and used multiple times in the dependency graph. So if we use the same layer twice, e.g. <code>(a &gt;&gt;&gt; b) ++ (a &gt;&gt;&gt; c)</code>, then the <code>a</code> layer will be allocated only once.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="layers-are-memoized-by-default-when-providing-globally">Layers are Memoized by Default when Providing Globally<a class="hash-link" href="#layers-are-memoized-by-default-when-providing-globally" title="Direct link to heading">​</a></h3><p>One important feature of a ZIO application is that layers are shared by default, meaning that if the same layer is used twice, and if we provide the layer <a href="#global-environment">globally</a> the layer will only be allocated a single time. For every layer in our dependency graph, there is only one instance of it that is shared between all the layers that depend on it.</p><p>For example, assume we have the three <code>A</code>, <code>B</code>, and <code>C</code> services. The implementation of both <code>B</code> and <code>C</code> are dependent on the <code>A</code> service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> A</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> B</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> C</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> BLive</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> B</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> CLive</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> C</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> a</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> A </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;initialized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      a </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> BLive</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> c</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> C</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      a </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> CLive</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Although both <code>b</code> and <code>c</code> layers require the <code>a</code> layer, the <code>a</code> layer is instantiated only once. It is shared with both <code>b</code> and <code>c</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">C</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// alternative: myApp.provideLayer((a &gt;&gt;&gt; b) ++ (a &gt;&gt;&gt; c))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">,</span><span class="token plain"> c</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="acquiring-a-fresh-version">Acquiring a Fresh Version<a class="hash-link" href="#acquiring-a-fresh-version" title="Direct link to heading">​</a></h4><p>If we don&#x27;t want to share a module, we should create a fresh, non-shared version of it through <code>ZLayer#fresh</code>.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">B </span><span class="token operator">&amp;</span><span class="token plain"> C</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">C</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">.</span><span class="token plain">fresh </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">.</span><span class="token plain">fresh </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="layers-are-not-memoized-when-providing-locally">Layers are not Memoized When Providing Locally<a class="hash-link" href="#layers-are-not-memoized-when-providing-locally" title="Direct link to heading">​</a></h3><p>If we don&#x27;t provide a layer globally but instead provide them <a href="#local-environment">locally</a>, that layer doesn&#x27;t support memoization by default.</p><p>In the following example, we provided the <code>A</code> layer two times locally and the ZIO doesn&#x27;t memoize the construction of the <code>A</code> layer. So, it will be initialized two times:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// providing locally</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// providing locally</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="manual-memoization">Manual Memoization<a class="hash-link" href="#manual-memoization" title="Direct link to heading">​</a></h4><p>We can memoize the <code>A</code> layer manually using the <code>ZLayer#memoize</code> operator. It will return a scoped effect that, if evaluated, will return the lazily computed result of this layer:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">scoped </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      a</span><span class="token punctuation">.</span><span class="token plain">memoize</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> aLayer </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">aLayer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">aLayer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-operators">Other Operators<a class="hash-link" href="#other-operators" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="converting-a-layer-to-a-scoped-value">Converting a Layer to a Scoped Value<a class="hash-link" href="#converting-a-layer-to-a-scoped-value" title="Direct link to heading">​</a></h3><p>Every <code>ZLayer</code> can be converted to a scoped <code>ZIO</code> by using <code>ZLayer.build</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> close</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> connect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Database</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> database</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Database</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">scoped </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">acquireRelease </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Database</span><span class="token punctuation">.</span><span class="token plain">connect</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;connecting to the database&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> database </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      database</span><span class="token punctuation">.</span><span class="token plain">close</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> scopedDatabase</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Scope</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> ZEnvironment</span><span class="token punctuation">[</span><span class="token plain">Database</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  database</span><span class="token punctuation">.</span><span class="token plain">build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="falling-back-to-an-alternate-layer">Falling Back to an Alternate Layer<a class="hash-link" href="#falling-back-to-an-alternate-layer" title="Direct link to heading">​</a></h3><p>If a layer fails, we can provide an alternative layer by using <code>ZLayer#orElse</code> so it will fall back to the second layer:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Database</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> postgresDatabaseLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Database</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> inmemoryDatabaseLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Database</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> databaseLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Database</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  postgresDatabaseLayer</span><span class="token punctuation">.</span><span class="token plain">orElse</span><span class="token punctuation">(</span><span class="token plain">inmemoryDatabaseLayer</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="converting-a-layer-to-a-zio-application">Converting a Layer to a ZIO Application<a class="hash-link" href="#converting-a-layer-to-a-zio-application" title="Direct link to heading">​</a></h3><p>Sometimes our entire application is a ZIO Layer, e.g. an HTTP Server, so by calling the <code>ZLayer#launch</code> we can convert that to a ZIO application. This will build the layer and use it until it is interrupted.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> httpServer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> HttpServer</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">[</span><span class="token plain">HttpServer</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      JsonParserLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      TemplateEngineLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> httpServer</span><span class="token punctuation">.</span><span class="token plain">launch</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrying">Retrying<a class="hash-link" href="#retrying" title="Direct link to heading">​</a></h3><p>We can retry constructing a layer in case of failure:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> databaseLayer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> DatabaseConnection</span><span class="token punctuation">]</span><span class="token plain">   </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> retriedLayer </span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Clock</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> DatabaseConnection</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> databaseLayer</span><span class="token punctuation">.</span><span class="token plain">retry</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">fibonacci</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="layer-projection">Layer Projection<a class="hash-link" href="#layer-projection" title="Direct link to heading">​</a></h3><p>We can project out a part of <code>ZLayer</code> by providing a projection function to the <code>ZLayer#project</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Connection</span><span class="token punctuation">(</span><span class="token plain">host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Login</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> password</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DBConfig</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  connection</span><span class="token operator">:</span><span class="token plain"> Connection</span><span class="token punctuation">,</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  login</span><span class="token operator">:</span><span class="token plain"> Login</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> connection</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">DBConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Connection</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">DBConfig</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">project</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">connection</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tapping">Tapping<a class="hash-link" href="#tapping" title="Direct link to heading">​</a></h3><p>We can perform a specified effect based on the success or failure result of the layer using <code>ZLayer#tap</code>/<code>ZLayer#tapError</code>. This would not change the layer&#x27;s signature:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> config</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZLayer</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// reading config from a file</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  config</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">cnf </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;layer acquisition succeeded with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">cnf</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">tapError</span><span class="token punctuation">(</span><span class="token plain">err </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;error occurred during reading the config </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">err</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-a-zio-application-with-a-simple-dependency">An Example of a ZIO Application with a Simple Dependency<a class="hash-link" href="#an-example-of-a-zio-application-with-a-simple-dependency" title="Direct link to heading">​</a></h3><p>This application demonstrates a ZIO program with a single dependency on a simple <code>AppConfig</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">poolSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// Define our simple ZIO program</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> zio</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      config </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _      </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">println</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Application started with config: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">config</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// Create a ZLayer that produces an AppConfig and can be used to satisfy the AppConfig </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// dependency that the program has</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> defaultConfig</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">AppConfig</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// Run the program, providing the `defaultConfig`</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> zio</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">defaultConfig</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-manually-generating-a-dependency-graph">An Example of Manually Generating a Dependency Graph<a class="hash-link" href="#an-example-of-manually-generating-a-dependency-graph" title="Direct link to heading">​</a></h3><p>Suppose we have defined the <code>UserRepo</code>, <code>DocumentRepo</code>, <code>Database</code>, <code>BlobStorage</code>, and <code>Cache</code> services and their respective implementations as follows:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> User</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> UserRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> UserRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> User</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> UserRepoLive</span><span class="token punctuation">(</span><span class="token plain">cache</span><span class="token operator">:</span><span class="token plain"> Cache</span><span class="token punctuation">,</span><span class="token plain"> database</span><span class="token operator">:</span><span class="token plain"> Database</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> UserRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> UserRepoLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Cache </span><span class="token operator">&amp;</span><span class="token plain"> Database</span><span class="token punctuation">,</span><span class="token plain"> UserRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        cache    </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Cache</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        database </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Database</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> UserRepoLive</span><span class="token punctuation">(</span><span class="token plain">cache</span><span class="token punctuation">,</span><span class="token plain"> database</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Database</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DatabaseLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Database</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> DatabaseLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Database</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">DatabaseLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Cache </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> InmemeoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Cache </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> InmemoryCache </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Cache</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> InmemeoryCache</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;initialized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> PersistentCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Cache </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> PersistentCache </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Cache</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> PersistentCache</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;initialized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Document</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> author</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> body</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> DocumentRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Document</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">Document</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> DocumentRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Document</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocumentRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocumentRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Document</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DocumentRepoLive</span><span class="token punctuation">(</span><span class="token plain">cache</span><span class="token operator">:</span><span class="token plain"> Cache</span><span class="token punctuation">,</span><span class="token plain"> blobStorage</span><span class="token operator">:</span><span class="token plain"> BlobStorage</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DocumentRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Document</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">Document</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> DocumentRepoLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Cache </span><span class="token operator">&amp;</span><span class="token plain"> BlobStorage</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> DocumentRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        cache       </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Cache</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        blobStorage </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">BlobStorage</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> DocumentRepoLive</span><span class="token punctuation">(</span><span class="token plain">cache</span><span class="token punctuation">,</span><span class="token plain"> blobStorage</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> BlobStorage </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> store</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> BlobStorageLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> BlobStorage </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> store</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> BlobStorageLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> BlobStorage</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">BlobStorageLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And then assume we have the following ZIO application:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocumentRepo </span><span class="token operator">&amp;</span><span class="token plain"> UserRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> UserRepo</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">(</span><span class="token string">&quot;john@doe&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;john&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> DocumentRepo</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain">Document</span><span class="token punctuation">(</span><span class="token string">&quot;introduction to zio&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;john&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> UserRepo</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token string">&quot;john@doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;retrieved john@doe user&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> DocumentRepo</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token string">&quot;introduction to zio&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;retrieved article about zio&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>myApp</code> requires <code>DocumentRepo</code> and <code>UserRepo</code> services to run. So we need to create a <code>ZLayer</code> which requires no services and produces <code>DocumentRepo</code> and <code>UserRepo</code>. We can manually create this layer using <a href="#vertical-and-horizontal-composition">vertical and horizontal layer composition</a>: </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layers</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> DocumentRepo </span><span class="token keyword">with</span><span class="token plain"> UserRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">BlobStorageLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">++</span><span class="token plain"> InmemoryCache</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">++</span><span class="token plain"> DatabaseLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token plain">DocumentRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"> UserRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">layers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-automatically-generating-a-dependency-graph">An Example of Automatically Generating a Dependency Graph<a class="hash-link" href="#an-example-of-automatically-generating-a-dependency-graph" title="Direct link to heading">​</a></h3><p>Instead of creating the required layer manually, we can use the <code>ZIO#provide</code>. ZIO internally creates the dependency graph automatically based on all dependencies provided:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      InmemoryCache</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      DatabaseLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      UserRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      BlobStorageLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      DocumentRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-providing-different-implementations-of-the-same-service">An Example of Providing Different Implementations of the Same Service<a class="hash-link" href="#an-example-of-providing-different-implementations-of-the-same-service" title="Direct link to heading">​</a></h3><p>Let&#x27;s say we want to provide different versions of the same service to different services. In this example, both <code>UserRepo</code> and <code>DocumentRepo</code> services require the <code>Cache</code> service. However, we want to provide different cache implementations for these two services. Our goal is to provide an <code>InmemoryCache</code> layer for <code>UserRepo</code> and a <code>PersistentCache</code> layer for the <code>DocumentRepo</code> service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layers</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> UserRepo </span><span class="token keyword">with</span><span class="token plain"> DocumentRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">InmemoryCache</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">++</span><span class="token plain"> DatabaseLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> UserRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">PersistentCache</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">++</span><span class="token plain"> BlobStorageLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> DocumentRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">layers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-how-to-get-fresh-layers">An Example of How to Get Fresh Layers<a class="hash-link" href="#an-example-of-how-to-get-fresh-layers" title="Direct link to heading">​</a></h3><p>Having covered the topic of <a href="#acquiring-a-fresh-version">acquiring fresh layers</a>, let&#x27;s see an example of using the <code>ZLayer#fresh</code> operator.</p><p><code>DocumentRepo</code> and <code>UserRepo</code> services are dependent on an in-memory cache service. On the other hand, let&#x27;s assume the cache service is quite simple, and we might be prone to cache conflicts between services. While sharing the cache service may cause some problems for our business logic, we should separate the cache service for both <code>DocumentRepo</code> and <code>UserRepo</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layers</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> UserRepo </span><span class="token operator">&amp;</span><span class="token plain"> DocumentRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">InmemoryCache</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">.</span><span class="token plain">fresh </span><span class="token operator">++</span><span class="token plain"> DatabaseLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> UserRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">InmemoryCache</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">.</span><span class="token plain">fresh </span><span class="token operator">++</span><span class="token plain"> BlobStorageLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> DocumentRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">layers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-pass-through-dependencies">An Example of Pass-through Dependencies<a class="hash-link" href="#an-example-of-pass-through-dependencies" title="Direct link to heading">​</a></h3><p>Notice that in the previous examples, both <code>UserRepo</code> and <code>DocuemntRepo</code> have some <a href="#hidden-versus-passed-through-dependencies">hidden dependencies</a>, such as <code>Cache</code>, <code>Database</code>, and <code>BlobStorage</code>.  So these hidden dependencies are no longer expressed in the type signature of the <code>layers</code>. From the perspective of a caller, <code>layers</code> just outputs a <code>UserRepo</code> and <code>DocuemntRepo</code> and requires no inputs. The caller does not need to be concerned with the internal implementation details of how the <code>UserRepo</code> and <code>DocumentRepo</code> are constructed.</p><p>An upstream dependency that is used by many other services can be &quot;passed-through&quot; and included in a layer&#x27;s output. This can be done with the <code>&gt;+&gt;</code> operator, which provides the output of one layer to another layer, returning a new layer that outputs the services of <em>both</em>.</p><p>The following example shows how to passthrough all dependencies to the final layer:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// passthrough all dependencies</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layers</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Database </span><span class="token operator">&amp;</span><span class="token plain"> BlobStorage </span><span class="token operator">&amp;</span><span class="token plain"> Cache </span><span class="token operator">&amp;</span><span class="token plain"> DocumentRepo </span><span class="token operator">&amp;</span><span class="token plain"> UserRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    DatabaseLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      BlobStorageLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      InmemoryCache</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      DocumentRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      UserRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// providing all passthrough dependencies to the ZIO application</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">layers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-updating-hidden-dependencies">An Example of Updating Hidden Dependencies<a class="hash-link" href="#an-example-of-updating-hidden-dependencies" title="Direct link to heading">​</a></h3><p>One of the use cases of having explicit all dependencies in the final layer is that we can <a href="#updating-local-dependencies">update</a> those hidden layers using <code>ZLayer#update</code>. In the following example, we are replacing the <code>InmemoryCache</code> with another implementation called <code>PersistentCache</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocumentRepo </span><span class="token operator">&amp;</span><span class="token plain"> UserRepo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">UserRepo</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">DocumentRepo</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layers</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Database </span><span class="token operator">&amp;</span><span class="token plain"> BlobStorage </span><span class="token operator">&amp;</span><span class="token plain"> Cache </span><span class="token operator">&amp;</span><span class="token plain"> DocumentRepo </span><span class="token operator">&amp;</span><span class="token plain"> UserRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    DatabaseLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      BlobStorageLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      InmemoryCache</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      DocumentRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer </span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      UserRepoLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      layers</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">[</span><span class="token plain">Cache</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> PersistentCache</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/references/contextual/zlayer.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/references/contextual/zenvironment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ZEnvironment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/references/contextual/rlayer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RLayer</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creation" class="table-of-contents__link toc-highlight">Creation</a><ul><li><a href="#from-a-simple-value-or-an-existing-service" class="table-of-contents__link toc-highlight">From a Simple Value or an Existing Service</a></li><li><a href="#from-resourceful-effects-scoped-resources" class="table-of-contents__link toc-highlight">From Resourceful Effects (Scoped Resources)</a></li><li><a href="#from-non-resourceful-effects" class="table-of-contents__link toc-highlight">From Non-resourceful Effects</a></li><li><a href="#from-functions" class="table-of-contents__link toc-highlight">From Functions</a></li></ul></li><li><a href="#building-dependency-graph" class="table-of-contents__link toc-highlight">Building Dependency Graph</a></li><li><a href="#manual-layer-construction" class="table-of-contents__link toc-highlight">Manual Layer Construction</a><ul><li><a href="#vertical-and-horizontal-composition" class="table-of-contents__link toc-highlight">Vertical and Horizontal Composition</a></li><li><a href="#hidden-versus-passed-through-dependencies" class="table-of-contents__link toc-highlight">Hidden Versus Passed-through Dependencies</a></li><li><a href="#updating-local-dependencies" class="table-of-contents__link toc-highlight">Updating Local Dependencies</a></li><li><a href="#cyclic-dependencies" class="table-of-contents__link toc-highlight">Cyclic Dependencies</a></li></ul></li><li><a href="#automatic-layer-construction" class="table-of-contents__link toc-highlight">Automatic Layer Construction</a><ul><li><a href="#providing-individual-layers-to-a-zio-application" class="table-of-contents__link toc-highlight">Providing Individual Layers to a ZIO Application</a></li><li><a href="#automatically-assembling-layers" class="table-of-contents__link toc-highlight">Automatically Assembling Layers</a></li><li><a href="#zlayer-debugging" class="table-of-contents__link toc-highlight">ZLayer Debugging</a></li></ul></li><li><a href="#dependency-propagation" class="table-of-contents__link toc-highlight">Dependency Propagation</a></li><li><a href="#environment-scope" class="table-of-contents__link toc-highlight">Environment Scope</a><ul><li><a href="#global-environment" class="table-of-contents__link toc-highlight">Global Environment</a></li><li><a href="#local-environment" class="table-of-contents__link toc-highlight">Local Environment</a></li></ul></li><li><a href="#layer-memoization" class="table-of-contents__link toc-highlight">Layer Memoization</a><ul><li><a href="#layers-are-memoized-by-default-when-providing-globally" class="table-of-contents__link toc-highlight">Layers are Memoized by Default when Providing Globally</a></li><li><a href="#layers-are-not-memoized-when-providing-locally" class="table-of-contents__link toc-highlight">Layers are not Memoized When Providing Locally</a></li></ul></li><li><a href="#other-operators" class="table-of-contents__link toc-highlight">Other Operators</a><ul><li><a href="#converting-a-layer-to-a-scoped-value" class="table-of-contents__link toc-highlight">Converting a Layer to a Scoped Value</a></li><li><a href="#falling-back-to-an-alternate-layer" class="table-of-contents__link toc-highlight">Falling Back to an Alternate Layer</a></li><li><a href="#converting-a-layer-to-a-zio-application" class="table-of-contents__link toc-highlight">Converting a Layer to a ZIO Application</a></li><li><a href="#retrying" class="table-of-contents__link toc-highlight">Retrying</a></li><li><a href="#layer-projection" class="table-of-contents__link toc-highlight">Layer Projection</a></li><li><a href="#tapping" class="table-of-contents__link toc-highlight">Tapping</a></li></ul></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#an-example-of-a-zio-application-with-a-simple-dependency" class="table-of-contents__link toc-highlight">An Example of a ZIO Application with a Simple Dependency</a></li><li><a href="#an-example-of-manually-generating-a-dependency-graph" class="table-of-contents__link toc-highlight">An Example of Manually Generating a Dependency Graph</a></li><li><a href="#an-example-of-automatically-generating-a-dependency-graph" class="table-of-contents__link toc-highlight">An Example of Automatically Generating a Dependency Graph</a></li><li><a href="#an-example-of-providing-different-implementations-of-the-same-service" class="table-of-contents__link toc-highlight">An Example of Providing Different Implementations of the Same Service</a></li><li><a href="#an-example-of-how-to-get-fresh-layers" class="table-of-contents__link toc-highlight">An Example of How to Get Fresh Layers</a></li><li><a href="#an-example-of-pass-through-dependencies" class="table-of-contents__link toc-highlight">An Example of Pass-through Dependencies</a></li><li><a href="#an-example-of-updating-hidden-dependencies" class="table-of-contents__link toc-highlight">An Example of Updating Hidden Dependencies</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4c8d210b.js"></script>
<script src="/assets/js/main.b0e6b04a.js"></script>
</body>
</html>