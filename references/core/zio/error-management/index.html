<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-references/core/zio/error-management">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-rh="true">Error Management | ZIO</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/references/core/zio/error-management"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Error Management | ZIO"><meta data-rh="true" name="description" content="As well as providing first-class support for typed errors, ZIO has a variety of facilities for catching, propagating, and transforming errors in a typesafe manner. In this section, we will learn about different types of errors in ZIO and how we can manage them."><meta data-rh="true" property="og:description" content="As well as providing first-class support for typed errors, ZIO has a variety of facilities for catching, propagating, and transforming errors in a typesafe manner. In this section, we will learn about different types of errors in ZIO and how we can manage them."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/references/core/zio/error-management"><link data-rh="true" rel="alternate" href="https://zio.dev/references/core/zio/error-management" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/references/core/zio/error-management" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.97da2182.css">
<link rel="preload" href="/assets/js/runtime~main.4c8d210b.js" as="script">
<link rel="preload" href="/assets/js/main.b0e6b04a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/references/">References</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/references/core/zio/error-management">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/">References</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/references/core/zio/">Core Data Types</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/references/core/zio/">ZIO Effects</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/zio/">ZIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/references/core/zio/error-management">Error Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/zio/uio">UIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/zio/urio">URIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/zio/task">Task</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/zio/rio">RIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/zio/io">IO</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/zioapp">ZIOApp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/runtime">Runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/exit">Exit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/references/core/cause">Cause</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/contextual/">Contextual Types</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/fiber/">Concurrency</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/resource/">Resource Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/stream/">Streaming</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/metrics/">Metrics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/test/">Testing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/references/misc/chunk">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core Data Types</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ZIO Effects</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Error Management</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Error Management</h1></header><p>As well as providing first-class support for typed errors, ZIO has a variety of facilities for catching, propagating, and transforming errors in a typesafe manner. In this section, we will learn about different types of errors in ZIO and how we can manage them.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="three-types-of-errors-in-zio">Three Types of Errors in ZIO<a class="hash-link" href="#three-types-of-errors-in-zio" title="Direct link to heading">​</a></h2><p>We should consider three types of errors when writing ZIO applications:</p><ol><li><p><strong>Failures</strong> are expected errors. We use <code>ZIO.fail</code> to model failures. As they are expected, we know how to handle them. We should handle these errors and prevent them from propagating throughout the call stack.</p></li><li><p><strong>Defects</strong> are unexpected errors. We use <code>ZIO.die</code> to model a defect. As they are not expected, we need to propagate them through the application stack, until in the upper layers one of the following situations happens:</p><ul><li>In one of the upper layers, it makes sense to expect these errors. So we will convert them to failure, and then they can be handled.</li><li>None of the upper layers won&#x27;t catch these errors, so it will finally crash the whole application.</li></ul></li><li><p><strong>Fatals</strong> are catastrophic unexpected errors. When they occur we should kill the application immediately without propagating the error furthermore. At most, we might need to log the error and print its call stack.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-failures">1. Failures<a class="hash-link" href="#1-failures" title="Direct link to heading">​</a></h3><p>When writing ZIO application, we can model a failure, using the <code>ZIO.fail</code> constructor:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> fail</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> E</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try to model some failures using this constructor:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> f1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> f2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">     </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, let&#x27;s try to run a failing effect and see what happens:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will crash the application and print the following stack trace:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">08</span><span class="token plain">T17</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">50.002161369</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token plain">&quot; java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token builtin">String</span><span class="token operator">:</span><span class="token plain"> Oh uh</span><span class="token operator">!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also model a failure using <code>Exception</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">val f2: ZIO[Any, Exception, Nothing] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.fail(new Exception(&quot;Oh uh!&quot;))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or using user-defined failure types (domain errors):</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">case class NegativeNumberException(msg: String) extends Exception(msg)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val validateNonNegaive(input: Int): ZIO[Any, NegativeNumberException, Int] =</span><br></span><span class="token-line"><span class="token plain">  if (input &lt; 0)</span><br></span><span class="token-line"><span class="token plain">    ZIO.fail(NegativeNumberException(s&quot;entered negative number: $input&quot;))</span><br></span><span class="token-line"><span class="token plain">  else</span><br></span><span class="token-line"><span class="token plain">    ZIO.succeed(input)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above examples, we can see that the type of the <code>validateNonNegaive</code> function is <code>ZIO[Any, NegativeNumberException, Int]</code>. It means this is an exceptional effect, which may fail with the type of <code>NegativeNumberException</code>.</p><p>The <code>ZIO.fail</code> constructor is somehow the moral equivalent of <code>throw</code> for pure codes. We will discuss this <a href="#imperative-vs-functional-error-handling">further</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-defects">2. Defects<a class="hash-link" href="#2-defects" title="Direct link to heading">​</a></h3><p>By providing a <code>Throwable</code> value to the <code>ZIO.die</code> constructor, we can describe a dying effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> die</span><span class="token punctuation">(</span><span class="token plain">t</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Throwable</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is an example of such effect, which will die because of encountering <em>divide by zero</em> defect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> dyingEffect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">(</span><span class="token string">&quot;divide by zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result is the creation of a ZIO effect whose error channel and success channel are both <code>Nothing</code>. In other words, this effect cannot fail and does not produce anything. Instead, it is an effect describing a <em>defect</em> or an <em>unexpected error</em>.</p><p>Let&#x27;s see what happens if we run this effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">(</span><span class="token string">&quot;divide by zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we run this effect, ZIO runtime will print the stack trace that belongs to this defect. So, here is the output:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">16</span><span class="token plain">T13</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">44.057191215</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token plain">&quot; java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">ArithmeticException</span><span class="token operator">:</span><span class="token plain"> divide by zero</span><br></span><span class="token-line"><span class="token plain">    at MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$run$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$die$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">3384</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">runUntil</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">ZScheduler$$anon$</span><span class="token number">1.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">ZScheduler</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">151</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZIO.die</code> constructor is used to manually describe a dying effect because of a defect inside the code.</p><p>For example, assume we want to write a <code>divide</code> function that takes two numbers and divides the first number by the second. We know that the <code>divide</code> function is not defined for zero dominators. Therefore, we should signal an error if division by zero occurs.</p><p>We have two choices to implement this function using the ZIO effect:</p><ol><li>We can divide the first number by the second, and if the second number was zero, we can fail the effect using <code>ZIO.fail</code> with the <code>ArithmeticException</code> failure value:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">b </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">(</span><span class="token string">&quot;divide by zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">/</span><span class="token plain"> b</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>We can divide the first number by the second. In the case of zero for the second number, we use <code>ZIO.die</code> to kill the effect by sending a signal of <code>ArithmeticException</code> as a defect:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">b </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">(</span><span class="token string">&quot;divide by zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// Unexpected error</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">/</span><span class="token plain"> b</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So what is the difference between these two approaches? Let&#x27;s compare the function signature:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">   </span><span class="token comment">// using ZIO.fail</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain">             </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">   </span><span class="token comment">// using ZIO.die</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>The first approach, models the <em>divide by zero</em> error by <em>failing</em> the effect. We call these failures <em>expected errors</em> or <em>typed error</em>.</li><li>While the second approach models the <em>divide by zero</em> error by <em>dying</em> the effect. We call these kinds of errors <em>unexpected errors</em>, <em>defects</em> or <em>untyped errors</em>.</li></ol><p>We use the first method when we are handling errors as we expect them, and thus we know how to handle them. In contrast, the second method is used when we aren&#x27;t expecting those errors in our domain, and we don&#x27;t know how to handle them. Therefore, we use the <em>let it crash</em> philosophy.</p><p>In the second approach, we can see that the <code>divide</code> function indicates that it cannot fail because it&#x27;s error channel is <code>Nothing</code>. However, it doesn&#x27;t mean that this function hasn&#x27;t any defects. ZIO defects are not typed, so they cannot be seen in type parameters.</p><p>Note that to create an effect that will die, we shouldn&#x27;t throw an exception inside the <code>ZIO.die</code> constructor, although it works. Instead, the idiomatic way of creating a dying effect is to provide a <code>Throwable</code> value into the <code>ZIO.die</code> constructor:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> defect1 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">(</span><span class="token string">&quot;divide by zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain">       </span><span class="token comment">// recommended       // recommended</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> defect2 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">(</span><span class="token string">&quot;divide by zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// not recommended</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, if we import a code that may throw an exception, all the exceptions will be translated to the ZIO defect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> defect3 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token string">&quot;boom!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Therefore, in the second approach of the <code>divide</code> function, we do not require to manually die the effect in case of the <em>dividing by zero</em>, because the JVM itself throws an <code>ArithmeticException</code> when the denominator is zero.</p><p>When we import any code into the <code>ZIO</code> effect, any exception is thrown inside that code will be translated to <em>ZIO defects</em> by default. So the following program is the same as the previous example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">/</span><span class="token plain"> b</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another important note is that if we <code>map</code>/<code>flatMap</code> a ZIO effect and then accidentally throw an exception inside the map operation, that exception will be translated to a ZIO defect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> defect4 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> defect5 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-fatal-errors">3. Fatal Errors<a class="hash-link" href="#3-fatal-errors" title="Direct link to heading">​</a></h3><p>In ZIO on the JVM platform, the <code>VirtualMachineError</code> and all its subtypes are the only errors considered fatal by the ZIO runtime. So if during the running application, the JVM throws any of these errors like <code>StackOverflowError</code>, the ZIO runtime considers it as a catastrophic fatal error. So it will interrupt the whole application immediately without safe resource interruption. None of the <code>ZIO#catchAll</code> and <code>ZIO#catchAllDefects</code> can catch these fatal errors. At most, if we set the <code>Runtime.setReportFatal</code>, the application will log the stack trace before interrupting the whole application.</p><p>Here is an example of manually creating a fatal error. Although we are ignoring all expected and unexpected errors, the fatal error interrupts the whole application:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> StackOverflowError</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token string">&quot;The call stack pointer exceeds the stack bound.&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><span class="token punctuation">)</span><span class="token plain">       </span><span class="token comment">// ignoring all expected errors</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">catchAllDefect</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ignoring all unexpected errors</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output will be something like this:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">StackOverflowError</span><span class="token operator">:</span><span class="token plain"> The call stack pointer exceeds the stack bound</span><span class="token punctuation">.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">examples</span><span class="token punctuation">.</span><span class="token plain">MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$run$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$</span><span class="token punctuation">.</span><span class="token plain">liftedTree1$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">2603</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$attempt$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">2603</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$isFatalWith$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">3571</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">runUntil</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">410</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">Runtime</span><span class="token punctuation">.</span><span class="token plain">unsafeRunWithRefs</span><span class="token punctuation">(</span><span class="token plain">Runtime</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token plain"> WARNING </span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">Catastrophic error encountered</span><span class="token punctuation">.</span><span class="token plain"> Application not safely interrupted</span><span class="token punctuation">.</span><span class="token plain"> Resources may be leaked</span><span class="token punctuation">.</span><span class="token plain"> Check the logs </span><span class="token keyword">for</span><span class="token plain"> more details and consider overriding `Runtime</span><span class="token punctuation">.</span><span class="token plain">reportFatal` to </span><span class="token namespace">capture</span><span class="token plain"> context</span><span class="token punctuation">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that we can change the default way to report fatal errors using <code>Runtime#reportFatal</code> or the <code>Runtime.setReportFatal</code> layer.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="imperative-vs-functional-error-handling">Imperative vs. Functional Error Handling<a class="hash-link" href="#imperative-vs-functional-error-handling" title="Direct link to heading">​</a></h2><p>When practicing imperative programming in Scala, we have the <code>try</code>/<code>catch</code> language construct for handling errors. Using them, we can wrap regions that may throw exceptions, and handle them in the catch block.</p><p>Let&#x27;s try an example. In the following code we have an age validation function that may throw two exceptions:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">sealed</span><span class="token plain"> </span><span class="token keyword">trait</span><span class="token plain"> AgeValidationException </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> AgeValidationException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> AgeValidationException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validate</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">throw</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">18</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">throw</span><span class="token plain"> IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> age</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using <code>try</code>/<code>catch</code> we can handle exceptions:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validate</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain">  </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are some issues with error handling using exceptions and <code>try</code>/<code>catch</code>/<code>finally</code> statement:</p><ol><li><strong>It lacks type safety on errors</strong> — There is no way to know what errors can be thrown by looking the function signature. The only way to find out in which circumstance a method may throw an exception is to read and investigate its implementation. So the compiler cannot prevent us from writing unsafe codes. It is also hard for a developer to read the documentation event through reading the documentation is not suffice as it may be obsolete, or it may don&#x27;t reflect the exact exceptions.</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">sealed</span><span class="token plain"> </span><span class="token keyword">trait</span><span class="token plain"> AgeValidationException </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> AgeValidationException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> AgeValidationException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validate</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AgeValidationException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">18</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can handle errors using <code>catchAll</code>/<code>catchSome</code> methods:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">validate</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>It doesn&#x27;t help us to write total functions</strong> — When we use <code>try</code>/<code>catch</code> the compiler doesn&#x27;t know about errors at compile-time, so if we forgot to handle one of the exceptions the compiler doesn&#x27;t help us to write total functions. This code will crash at runtime because we forgot to handle the <code>IllegalAgeException</code> case:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validate</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">//  case IllegalAgeException(age) =&gt; ???</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we are using typed errors we can have exhaustive checking support of the compiler. For example, when we are catching all errors if we forgot to handle one of the cases, the compiler warns us about that:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">validate</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// res12: ZIO[Any, Nothing, Int] = OnSuccessAndFailure(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   trace = &quot;repl.MdocSession.App10.res12(error-management.md:265)&quot;,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   first = OnSuccess(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     trace = &quot;repl.MdocSession.App10.validate(error-management.md:245)&quot;,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     first = GenerateStackTrace(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//       trace = &quot;repl.MdocSession.App10.validate(error-management.md:245)&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     ),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     successK = zio.ZIO$$$Lambda$10660/1199686105@2bf07a1a</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   ),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   successK = zio.ZIO$$Lambda$10716/1239062139@a15a38a,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   failureK = zio.ZIO$$Lambda$10710/1626611310@2e7b2cf7</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This helps us cover all cases and write <em>total functions</em> easily.</p><blockquote><p><strong>Note:</strong></p><p>When a function is defined for all possible input values, it is called a <em>total function</em> in functional programming.</p></blockquote><ol start="3"><li><strong>Its error model is broken and lossy</strong> — The error model based on the <code>try</code>/<code>catch</code>/<code>finally</code> statement is broken. Because if we have the combinations of these statements we can throw many exceptions, and then we are only able to catch one of them. All the other ones are lost. They are swallowed into a black hole, and also the one that we catch is the wrong one. It is not the primary cause of the failure.</li></ol><p>To be more specific, if the <code>try</code> block throws an exception, and the <code>finally</code> block throws an exception as well, then, if these are caught at a higher level, only the finalizer&#x27;s exception will be caught normally, not the exception from the try block.</p><p>In the following example, we are going to show this behavior:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"> </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Error</span><span class="token punctuation">(</span><span class="token string">&quot;e1&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">finally</span><span class="token plain"> </span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Error</span><span class="token punctuation">(</span><span class="token string">&quot;e2&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">   </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> Error </span><span class="token keyword">=&gt;</span><span class="token plain"> println</span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// e2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above program just prints the <code>e2</code> while it is not the primary cause of failure. That is why we say the <code>try</code>/<code>catch</code> model is lossy.</p><p>In ZIO, all the errors will still be reported. So even though we are only able to catch one error, the other ones will be reported which we have full control over them. They don&#x27;t get lost.</p><p>Let&#x27;s write a ZIO version:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;e1&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token string">&quot;e2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;e1&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;e1&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;e2&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;e2&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// e1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO guarantees that no errors are lost. It has a <em>lossless error model</em>. This guarantee is provided via a hierarchy of supervisors and information made available via data types such as <code>Exit</code> and <code>Cause</code>. All errors will be reported. If there&#x27;s a bug in the code, ZIO enables us to find about it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="expected-and-unexpected-errors">Expected and Unexpected Errors<a class="hash-link" href="#expected-and-unexpected-errors" title="Direct link to heading">​</a></h2><p>Inside an application, there are two distinct categories of errors:</p><ol><li><strong>Expected Errors</strong>— They are also known as <em>recoverable errors</em>, <em>declared errors</em> or <em>errors</em>.</li></ol><p>Expected errors are those errors in which we expected them to happen in normal circumstances, and we can&#x27;t prevent them. They can be predicted upfront, and we can plan for them. We know when, where, and why they occur. So we know when, where, and how to handle these errors. By handling them we can recover from the failure, this is why we say they are <em>recoverable errors</em>. All domain errors, business errors are expected once because we talk about them in workflows and user stories, so we know about them in the context of business flows.</p><p>For example, when accessing an external database, that database might be down for some short period of time, so we retry to connect again, or after some number of attempts, we might decide to use an alternative solution, e.g. using an in-memory database.</p><ol start="2"><li><strong>Unexpected Errors</strong>— <em>non-recoverable errors</em>, <em>defects</em>.</li></ol><p>We know there is a category of things that we are not going to expect and plan for. These are the things we don&#x27;t expect but of course, we know they are going to happen. We don&#x27;t know what is the exact root of these errors at runtime, so we have no idea how to handle them. They are actually going to bring down our production application, and then we have to figure out what went wrong to fix them.</p><p>For example, the corrupted database file will cause an unexpected error. We can&#x27;t handle that in runtime. It may be necessary to shut down the whole application in order to prevent further damage.</p><p>Most of the unexpected errors are rooted in programming errors. This means, we have just tested the <em>happy path</em>, so in case of <em>unhappy path</em> we encounter a defect. When we have defects in our code we have no way of knowing about them otherwise we investigate, test, and fix them.</p><p>One of the common programming errors is forgetting to validate unexpected errors that may occur when we expect an input but the input is not valid, while we haven&#x27;t validated the input. When the user inputs the invalid data, we might encounter the divide by zero exception or might corrupt our service state or a cause similar defect. These kinds of defects are common when we upgrade our service with the new data model for its input, while one of the other services is not upgraded with the new data contract and is calling our service with the deprecated data model. If we haven&#x27;t a validation phase, they will cause defects!</p><p>Another example of defects is memory errors like buffer overflows, stack overflows, out-of-memory, invalid access to null pointers, and so forth. Most of the time these unexpected errors are occurs when we haven&#x27;t written a memory-safe and resource-safe program, or they might occur due to hardware issues or uncontrollable external problems. We as a developer don&#x27;t know how to cope with these types of errors at runtime. We should investigate to find the exact root cause of these defects.</p><p>As we cannot handle unexpected errors, we should instead log them with their respective stack traces and contextual information. So later we could investigate the problem and try to fix them. The best we can do with unexpected errors is to <em>sandbox</em> them to limit the damage that they do to the overall application. For example, an unexpected error in browser extension shouldn&#x27;t crash the whole browser.</p><p>So the best practice for each of these errors is as follows:</p><ol><li><strong>Expected Errors</strong> — we handle expected errors with the aid of the Scala compiler, by pushing them into the type system. In ZIO there is the error type parameter called <code>E</code>, and this error type parameter is for modeling all the expected errors in the application.</li></ol><p>A ZIO value has a type parameter <code>E</code> which is the type of <em>declared errors</em> it can fail with. <code>E</code> only covers the errors which were specified at the outset. The same ZIO value could still throw exceptions in unforeseen ways. These unforeseen situations are called <em>defects</em> in a ZIO program, and they lie outside <code>E</code>.</p><p>Bringing abnormal situations from the domain of defects into that of <code>E</code> enables the compiler to help us keep a tab on error conditions throughout the application, at compile time. This helps ensure the handling of domain errors in domain-specific ways.</p><ol start="2"><li><strong>Unexpected Errors</strong> — We encode unexpected errors by not reflecting them to the type system because there is no way we could do it, and it wouldn&#x27;t provide any value if we could. At best as we can, we simply sandbox that to some well-defined area of the application.</li></ol><p>Note that <em>defects</em>, can creep silently to higher levels in our application, and, if they get triggered at all, their handling might eventually be in more general ways.</p><p>So for ZIO, expected errors are reflected in the type of the ZIO effect, whereas unexpected errors are not so reflective, and that is the distinction.</p><p>That is the best practice. It helps us write better code. The code that we can reason about its error properties and potential expected errors. We can look at the ZIO effect and know how it is supposed to fail.</p><p>So to summarize</p><ol><li>Unexpected errors are impossible to recover and they will eventually shut down the application but expected errors can be recovered by handling them.</li><li>We do not type unexpected errors, but we type expected errors either explicitly or using general <code>Throwable</code> error type.</li><li>Unexpected errors mostly is a sign of programming errors, but expected errors part of domain errors.</li><li>Even though we haven&#x27;t any clue on how to handle defects, we might still need to do some operation, before letting them crash the application. So in such a situation, we can <a href="#catching-defects">catch defects</a> do following operations, and then rethrow them again:</li></ol><ul><li>logging the defect to a log aggregator</li><li>sending an email to alert developers</li><li>displaying a nice &quot;unexpected error&quot; message to the user</li><li>etc.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exceptional-and-unexceptional-effects">Exceptional and Unexceptional Effects<a class="hash-link" href="#exceptional-and-unexceptional-effects" title="Direct link to heading">​</a></h2><p>Besides the <code>IO</code> type alias, ZIO has four different type aliases which can be categorized into two different categories:</p><ul><li><strong>Exceptional Effect</strong> — <code>Task</code> and <code>RIO</code> are two effects whose error parameter is fixed to <code>Throwable</code>, so we call them exceptional effects.</li><li><strong>Unexceptional Effect</strong> - <code>UIO</code> and <code>URIO</code> have error parameters that are fixed to <code>Nothing</code>, indicating that they are unexceptional effects. So they can&#x27;t fail, and the compiler knows about it.</li></ul><p>So when we compose different effects together, at any point of the codebase we can determine this piece of code can fail or cannot. As a result, typed errors offer a compile-time transition point between this can fail and this can&#x27;t fail.</p><p>For example, the <code>ZIO.acquireReleaseWith</code> API asks us to provide three different inputs: <em>require</em>, <em>release</em>, and <em>use</em>. The <code>release</code> parameter requires a function from <code>A</code> to <code>URIO[R, Any]</code>. So, if we put an exceptional effect, it will not compile:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> acquireReleaseWith</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    acquire</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    release</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    use</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="typed-errors-dont-guarantee-the-absence-of-defects-and-interruptions">Typed Errors Don&#x27;t Guarantee the Absence of Defects and Interruptions<a class="hash-link" href="#typed-errors-dont-guarantee-the-absence-of-defects-and-interruptions" title="Direct link to heading">​</a></h2><p>Having an effect of type <code>ZIO[R, E, A]</code>, means it can fail because of some failure of type <code>E</code>, but it doesn&#x27;t mean it can&#x27;t die or be interrupted. So the error channel is only for <code>failure</code> errors.</p><p>In the following example, the type of the <code>validateNonNegativeNumber</code> function is <code>ZIO[Any, String, Int]</code> which denotes it is a typed exceptional effect. It can fail of type <code>String</code> but it still can die with the type of <code>NumberFormatException</code> defect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validateNonNegativeNumber</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  input</span><span class="token punctuation">.</span><span class="token plain">toIntOption </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> value </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">other</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;the entered number is negative: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">other</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> None </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">new</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;the entered input is not in the correct number format: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">input</span><span class="token string-interpolation string">&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, its underlying fiber can be interrupted without affecting the type of the error channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f </span><span class="token keyword">&lt;-</span><span class="token plain"> validateNonNegativeNumber</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> f</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><br></span><span class="token-line"><span class="token plain">    r </span><span class="token keyword">&lt;-</span><span class="token plain"> f</span><span class="token punctuation">.</span><span class="token plain">join</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> r</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Therefore, if we run the <code>myApp</code> effect, it will be interrupted before it gets the chance to finish.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sequential-and-parallel-errors">Sequential and Parallel Errors<a class="hash-link" href="#sequential-and-parallel-errors" title="Direct link to heading">​</a></h2><p>A simple and regular ZIO application usually fails with one error, which is the first error encountered by the ZIO runtime:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> fail </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> die </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> interruption </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fail </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> die</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> interruption</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This application will fail with the first error which is &quot;Oh uh!&quot;:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">09</span><span class="token plain">T09</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">22.067072131</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token plain">&quot; java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token builtin">String</span><span class="token operator">:</span><span class="token plain"> Oh uh</span><span class="token operator">!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In some cases, we may run into multiple errors. When we perform parallel computations, the application may fail due to multiple errors:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token generics punctuation">&lt;</span><span class="token generics operator">&amp;</span><span class="token generics punctuation">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we run this application, we can see two exceptions in two different fibers that caused the failure (<code>zio-fiber-0</code> and <code>zio-fiber-14</code>):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">09</span><span class="token plain">T08</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">48.703035927</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">13</span><span class="token plain">&quot; java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token builtin">String</span><span class="token operator">:</span><span class="token plain"> Oh</span><span class="token operator">!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">Exception in thread </span><span class="token string">&quot;zio-fiber-14&quot;</span><span class="token plain"> java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token builtin">String</span><span class="token operator">:</span><span class="token plain"> Uh</span><span class="token operator">!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO has a combinator called <code>ZIO#parallelErrors</code> that exposes all parallel failure errors in the error channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">::</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token generics punctuation">&lt;</span><span class="token generics operator">&amp;</span><span class="token generics punctuation">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh Error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">parallelErrors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that this operator is only for failures, not defects or interruptions.</p><p>Also, when we work with resource-safety operators like <code>ZIO#ensuring</code> we can have multiple sequential errors. Why? because regardless of the original effect has any errors or not, the finalizer is uninterruptible. So the finalizer will be run. Unless the finalizer should be an unexceptional effect (<code>URIO</code>), it may die because of a defect. Therefore, it creates multiple sequential errors:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we run this application, we can see that the original failure (<code>Oh uh!</code>) was suppressed by another defect (<code>Boom!</code>):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">09</span><span class="token plain">T08</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">56.563179230</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token plain">&quot; java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token builtin">String</span><span class="token operator">:</span><span class="token plain"> Oh uh</span><span class="token operator">!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Suppressed</span><span class="token operator">:</span><span class="token plain"> java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">RuntimeException</span><span class="token operator">:</span><span class="token plain"> Boom</span><span class="token operator">!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recovering-from-errors">Recovering From Errors<a class="hash-link" href="#recovering-from-errors" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-catching">1. Catching<a class="hash-link" href="#1-catching" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="catching-failures">Catching Failures<a class="hash-link" href="#catching-failures" title="Direct link to heading">​</a></h4><p>If we want to catch and recover from all <em>typed error</em> and effectfully attempt recovery, we can use the <code>ZIO#catchAll</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchAll</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">h</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can recover from all errors while reading a file and then fallback to another operation:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> z</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    readFile</span><span class="token punctuation">(</span><span class="token string">&quot;backup.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the callback passed to <code>ZIO#catchAll</code>, we may return an effect with a different error type (or perhaps <code>Nothing</code>), which will be reflected in the type of effect returned by <code>ZIO#catchAll</code>.</p><p>When using this operator, the match cases should be exhaustive:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validate</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;negative age: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">age</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;illegal age: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">age</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we forget to catch all cases and the match fails, the original <strong>failure</strong> will be lost and replaced by a <code>MatchError</code> <strong>defect</strong>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    validate</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;negative age: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">age</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//        case IllegalAgeException(age) =&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//          ZIO.debug(s&quot;illegal age: $age&quot;).as(-1)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> result</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another important note about <code>ZIO#catchAll</code> is that this operator only can recover from <em>failures</em>. So it can&#x27;t recover from defects or fiber interruptions.</p><p>Let&#x27;s try what happens if we <code>catchAll</code> on a dying effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> die</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> die</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, if we have a fiber interruption, we can&#x27;t catch that using this operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> interruptedEffect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">interrupt </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> interruptedEffect</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we want to catch and recover from only some types of exceptions and effectfully attempt recovery, we can use the <code>ZIO#catchSome</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchSome</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we are only catching failure of type <code>FileNotFoundException</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> data</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchSome </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token operator">:</span><span class="token plain"> FileNotFoundException </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      readFile</span><span class="token punctuation">(</span><span class="token string">&quot;backup.data&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="catching-defects">Catching Defects<a class="hash-link" href="#catching-defects" title="Direct link to heading">​</a></h4><p>Like catching failures, ZIO has two operators to catch <em>defects</em>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchAllDefect</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">h</span><span class="token operator">:</span><span class="token plain"> Throwable </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchSomeDefect</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try the <code>ZIO#catchAllDefect</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">catchAllDefect </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> RuntimeException </span><span class="token keyword">if</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token plain">getMessage </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;Boom!&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Boom! defect caught.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> _</span><span class="token operator">:</span><span class="token plain"> NumberFormatException </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;NumberFormatException defect caught.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown defect caught.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We should note that using these operators, we can only recover from a dying effect, and it cannot recover from a failure or fiber interruption.</p><p>A defect is an error that cannot be anticipated in advance, and there is no way to respond to it. Our rule of thumb is to not recover defects since we don&#x27;t know about them. We let them crash the application. Although, in some cases, we might need to reload a part of the application instead of killing the entire application.</p><p>Assume we have written an application that can load plugins at runtime. During the runtime of the plugins, if a defect occurs, we don&#x27;t want to crash the entire application; rather, we log all defects and then reload the plugin.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="catching-causes">Catching Causes<a class="hash-link" href="#catching-causes" title="Direct link to heading">​</a></h4><p>So far, we have only studied how to catch <em>failures</em> and <em>defects</em>. But what about <em>fiber interruptions</em> or how about the specific combination of these errors?</p><p>There are two ZIO operators useful for catching causes:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchAllCause</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">h</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchSomeCause</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the help of the <code>ZIO#catchAllCause</code> operator we can catch all errors of an effect and recover from them:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exceptionalEffect </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">exceptionalEffect</span><span class="token punctuation">.</span><span class="token plain">catchAllCause </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Empty </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;no error caught&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Fail</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;a failure caught: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Die</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;a defect caught: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Interrupt</span><span class="token punctuation">(</span><span class="token plain">fiberId</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;a fiber interruption caught with the fiber id: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">fiberId</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Stackless</span><span class="token punctuation">(</span><span class="token plain">cause</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Die</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;a stackless defect caught: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">cause</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Stackless</span><span class="token punctuation">(</span><span class="token plain">cause</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">_</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;an unknown stackless defect caught: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">cause</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">squashWith</span><span class="token string-interpolation interpolation expression punctuation">(</span><span class="token string-interpolation interpolation expression">identity</span><span class="token string-interpolation interpolation expression punctuation">)</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Then</span><span class="token punctuation">(</span><span class="token plain">left</span><span class="token punctuation">,</span><span class="token plain"> right</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;two consequence causes caught&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Both</span><span class="token punctuation">(</span><span class="token plain">left</span><span class="token punctuation">,</span><span class="token plain"> right</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;two parallel causes caught&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Additionally, there is a partial version of this operator called <code>ZIO#catchSomeCause</code>, which can be used when we don&#x27;t want to catch all causes, but some of them.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="catching-traces">Catching Traces<a class="hash-link" href="#catching-traces" title="Direct link to heading">​</a></h4><p>The two <code>ZIO#catchAllTrace</code> and <code>ZIO#catchSomeTrace</code> operators are useful to catch the typed error as well as stack traces of exceptional effects:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchAllTrace</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    h</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> Trace</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchSomeTrace</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> Trace</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the below example, let&#x27;s try to catch a failure on the line number 4:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">catchAllTrace </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">,</span><span class="token plain"> trace</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> trace</span><span class="token punctuation">.</span><span class="token plain">toJava</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">getLineNumber</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">headOption</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">contains</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;caught a failure on the line number 4&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;caught other failures&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="catching-non-fatal">Catching Non-Fatal<a class="hash-link" href="#catching-non-fatal" title="Direct link to heading">​</a></h4><p>We can use the <code>ZIO#catchNonFatalOrDie</code> to recover from all non-fatal errors:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> catchNonFatalOrDie</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    h</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev1</span><span class="token operator">:</span><span class="token plain"> CanFail</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> ev2</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token operator">&lt;</span><span class="token plain"> Throwable</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In case of occurring any <a href="#3-fatal-errors">fatal error</a>, it will die.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">openFile</span><span class="token punctuation">(</span><span class="token string">&quot;data.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchNonFatalOrDie</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> openFile</span><span class="token punctuation">(</span><span class="token string">&quot;backup.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-fallback">2. Fallback<a class="hash-link" href="#2-fallback" title="Direct link to heading">​</a></h3><ol><li><strong><code>ZIO#orElse</code></strong>— We can try one effect, or if it fails, try another effect with the <code>orElse</code> combinator:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> orElse</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">that</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try an example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> primaryOrBackupData</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orElse</span><span class="token punctuation">(</span><span class="token plain">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;backup.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO#orElseEither</code></strong>— If the original effect fails, this operator tries another effect, and as a result, returns either:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> orElseEither</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">that</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This operator is useful when the fallback effect has a different result type than the original effect. So this will unify both in the <code>Either[A, B]</code> data type. Here is an example usage of this operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> LocalConfig</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> RemoteConfig</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> readLocalConfig</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> LocalConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> readRemoteConfig</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> RemoteConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">LocalConfig</span><span class="token punctuation">,</span><span class="token plain"> RemoteConfig</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readLocalConfig</span><span class="token punctuation">.</span><span class="token plain">orElseEither</span><span class="token punctuation">(</span><span class="token plain">readRemoteConfig</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#orElseSucceed</code>/<code>ZIO#orElseFail</code></strong>— These two operators convert the original failure with constant succeed or failure values:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> orElseFail</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">e1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> E1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> orElseSucceed</span><span class="token punctuation">[</span><span class="token plain">A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">a1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> A1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZIO#orElseFail</code> will always replace the original failure with the new one, so <code>E1</code> does not have to be a supertype of <code>E</code>. It is useful when we have <code>Unit</code> as an error, and we want to unify that with something else:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validate</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AgeValidationException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">NegativeAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">18</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">IllegalAgeException</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orElseFail</span><span class="token punctuation">(</span><span class="token string">&quot;invalid age&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZIO#orElseSucceed</code> will always replace the original failure with a success value so the resulting effect cannot fail. It is useful when we have a constant value that will work in case the effect fails:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orElseSucceed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li><strong><code>ZIO#orElseOptional</code></strong>— When dealing with optional failure types, we might need to fall back to another effect when the failure value is <code>None</code>. This operator helps to do so:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> orElseOptional</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      that</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev</span><span class="token operator">:</span><span class="token plain"> E IsSubtypeOfError Option</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, the <code>parseInt(&quot; &quot;)</code> fails with <code>None</code>, so then the fallback effect results in a zero:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  input</span><span class="token punctuation">.</span><span class="token plain">toIntOption </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> None </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">trim</span><span class="token punctuation">.</span><span class="token plain">isEmpty</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">None</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;invalid non-integer input: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">input</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orElseOptional</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li><strong><code>ZIO.firstSuccessOf</code>/<code>ZIO#firstSuccessOf</code></strong>— These two operators make it easy for a user to run an effect, and in case it fails, it will run a series of ZIO effects until one succeeds:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> firstSuccessOf</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    zio</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    rest</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Iterable</span><span class="token punctuation">[</span><span class="token plain">ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> firstSuccessOf</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    rest</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Iterable</span><span class="token punctuation">[</span><span class="token plain">ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These methods use <code>orElse</code> to reduce the non-empty iterable of effects into a single effect.</p><p>In the following example, we are trying to get the config from the master node, and if it fails, we will try successively to retrieve the config from the next available node:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Config</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> remoteConfig</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Config</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> masterConfig</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Config</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  remoteConfig</span><span class="token punctuation">(</span><span class="token string">&quot;master&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> nodeConfigs</span><span class="token operator">:</span><span class="token plain"> Seq</span><span class="token punctuation">[</span><span class="token plain">ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Config</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  List</span><span class="token punctuation">(</span><span class="token string">&quot;node1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;node2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;node3&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;node4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">remoteConfig</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> config</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Config</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">firstSuccessOf</span><span class="token punctuation">(</span><span class="token plain">masterConfig</span><span class="token punctuation">,</span><span class="token plain"> nodeConfigs</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-folding">3. Folding<a class="hash-link" href="#3-folding" title="Direct link to heading">​</a></h3><p>Scala&#x27;s <code>Option</code> and <code>Either</code> data types have <code>fold</code>, which let us handle both failure and success at the same time. In a similar fashion, <code>ZIO</code> effects also have several methods that allow us to handle both failure and success.</p><ol><li><strong><code>ZIO#fold</code>/<code>ZIO#foldZIO</code></strong>— The first fold method, <code>ZIO#fold</code>, lets us non-effectfully handle both failure and success, by supplying a non-effectful handler for each case. The second fold method, <code>ZIO#foldZIO</code>, lets us effectfully handle both failure and success, by supplying an effectful (but still pure) handler for each case:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> fold</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> B</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> B</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foldZIO</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try an example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> DefaultData</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> Array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> primaryOrDefaultData</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fold</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> DefaultData</span><span class="token punctuation">,</span><span class="token plain"> data </span><span class="token keyword">=&gt;</span><span class="token plain"> data</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can ignore any failure and success values:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh oh!&quot;</span><span class="token punctuation">)</span><span class="token plain">         </span><span class="token comment">// ZIO[Any, String, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain">                  </span><span class="token comment">// ZIO[Any, String, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fold</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, Nothing, Unit]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is equivalent to use the <code>ZIO#ignore</code> operator instead:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh oh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">ignore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s try the effectful version of the fold operation. In this example, in case of failure on reading from the primary file, we will fallback to another effectful operation which will read data from the secondary file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> primaryOrSecondaryData</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">foldZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure </span><span class="token operator">=</span><span class="token plain"> _    </span><span class="token keyword">=&gt;</span><span class="token plain"> readFile</span><span class="token punctuation">(</span><span class="token string">&quot;secondary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success </span><span class="token operator">=</span><span class="token plain"> data </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">data</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Nearly all error handling methods are defined in terms of <code>foldZIO</code>, because it is both powerful and fast.</p><p>In the following example, <code>foldZIO</code> is used to handle both failure and success of the <code>readUrls</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> urls</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">Content</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readUrls</span><span class="token punctuation">(</span><span class="token string">&quot;urls.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">foldZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    error   </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">NoContent</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success </span><span class="token keyword">=&gt;</span><span class="token plain"> fetchContent</span><span class="token punctuation">(</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s important to note that both <code>ZIO#fold</code> and <code>ZIO#foldZIO</code> operators cannot catch fiber interruptions. So the following application will crash due to <code>InterruptedException</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">interrupt </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh oh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fold</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And here is the output:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span><span class="token plain">T13</span><span class="token operator">:</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">01.696273024</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token string">&quot; java.lang.InterruptedException: Interrupted by thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token plain">&quot;</span><br></span><span class="token-line"><span class="token plain">   at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO#foldCause</code>/<code>ZIO#foldCauseZIO</code></strong>— This cause version of the <code>fold</code> operator is useful to access the full cause of the underlying fiber. So in case of failure, based on the exact cause, we can determine what to do:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foldCause</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> B</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> B</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foldCauseZIO</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Among the fold operators, these are the most powerful combinators. They can recover from any error, even fiber interruptions.</p><p>In the following example, we are printing the proper message according to what cause occurred due to failure:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exceptionalEffect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  exceptionalEffect</span><span class="token punctuation">.</span><span class="token plain">foldCauseZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Fail</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain">        </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;failure: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Die</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain">         </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;cause: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Interrupt</span><span class="token punctuation">(</span><span class="token plain">failure</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">failure</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">threadName</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"> interrupted!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> _                           </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;failed due to other causes&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success </span><span class="token operator">=</span><span class="token plain"> succeed </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;succeeded with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">succeed</span><span class="token string-interpolation string"> value&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When catching errors using this operator, if our cases were not exhaustive, we may receive a defect of the type <code>scala.MatchError</code> :</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> exceptionalEffect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    exceptionalEffect</span><span class="token punctuation">.</span><span class="token plain">foldCauseZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      failure </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Fail</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;failure: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Die</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;cause: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">toString</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token comment">// case Cause.Interrupt(failure, _) =&gt; ZIO.debug(s&quot;${failure.threadName} interrupted!&quot;)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      success </span><span class="token operator">=</span><span class="token plain"> succeed </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;succeeded with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">succeed</span><span class="token string-interpolation string"> value&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span><span class="token plain">T11</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">40.241436257</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token plain">&quot; scala</span><span class="token punctuation">.</span><span class="token plain">MatchError</span><span class="token operator">:</span><span class="token plain"> Interrupt</span><span class="token punctuation">(</span><span class="token plain">Runtime</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1645700739</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">Trace</span><span class="token punctuation">(</span><span class="token plain">Runtime</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1645700739</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain">Chunk</span><span class="token punctuation">(</span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">exceptionalEffect</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">myApp</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">of </span><span class="token keyword">class</span><span class="token plain"> zio</span><span class="token punctuation">.</span><span class="token plain">Cause$Interrupt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$myApp$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$TracedCont$$anon$</span><span class="token number">33.</span><span class="token plain">apply</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">6167</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$TracedCont$$anon$</span><span class="token number">33.</span><span class="token plain">apply</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">6165</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">runUntil</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">885</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">ZScheduler$$anon$</span><span class="token number">1.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">ZScheduler</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">151</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">runUntil</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">538</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#foldTraceZIO</code></strong>— This version of fold, provide us the facility to access the trace info of the failure:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foldTraceZIO</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> Trace</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev</span><span class="token operator">:</span><span class="token plain"> CanFail</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">foldTraceZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    failure </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token operator">:</span><span class="token plain"> NegativeAgeException</span><span class="token punctuation">,</span><span class="token plain"> trace</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token string">&quot;The entered age is negative\n&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;trace info: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">trace</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">stackTrace</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">mkString</span><span class="token string-interpolation interpolation expression punctuation">(</span><span class="token string-interpolation interpolation expression string">&quot;\n&quot;</span><span class="token string-interpolation interpolation expression punctuation">)</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token operator">:</span><span class="token plain"> IllegalAgeException</span><span class="token punctuation">,</span><span class="token plain"> trace</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token string">&quot;The entered age in not legal\n&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;trace info: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">trace</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">stackTrace</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">mkString</span><span class="token string-interpolation interpolation expression punctuation">(</span><span class="token string-interpolation interpolation expression string">&quot;\n&quot;</span><span class="token string-interpolation interpolation expression punctuation">)</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success </span><span class="token operator">=</span><span class="token plain"> s </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that similar to <code>ZIO#fold</code> and <code>ZIO#foldZIO</code> this operator cannot recover from fiber interruptions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-retrying">4. Retrying<a class="hash-link" href="#4-retrying" title="Direct link to heading">​</a></h3><p>When we are building applications we want to be resilient in the face of a transient failure. This is where we need to retry to overcome these failures.</p><p>There are a number of useful methods on the ZIO data type for retrying failed effects:</p><ol><li><strong><code>ZIO#retry</code></strong>— The most basic of these is <code>ZIO#retry</code>, which takes a <code>Schedule</code> and returns a new effect that will retry the first effect if it fails, according to the specified policy:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> retry</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">policy</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Schedule</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we try to read from a file. If we fail to do that, it will try five more times:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> retriedOpenFile</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">retry</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">recurs</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO#retryN</code></strong>— In case of failure, a ZIO effect can be retried as many times as specified:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> file </span><span class="token operator">=</span><span class="token plain"> readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">retryN</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#retryOrElse</code></strong>— The next most powerful function is <code>ZIO#retryOrElse</code>, which allows specification of a fallback to use, if the effect does not succeed with the specified policy:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> retryOrElse</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    policy</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Schedule</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    orElse</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>orElse</code> is the recovery function that has two inputs:</p><ol><li>The last error message</li><li>Schedule output</li></ol><p>So based on these two values, we can decide what to do as the fallback operation. Let&#x27;s try an example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Random</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">nextIntBounded</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is less than 9!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;failed&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;succeeded&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">retryOrElse</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        policy </span><span class="token operator">=</span><span class="token plain"> Schedule</span><span class="token punctuation">.</span><span class="token plain">recurs</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        orElse </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">lastError</span><span class="token punctuation">,</span><span class="token plain"> scheduleOutput</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;after </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">scheduleOutput</span><span class="token string-interpolation string"> retries, we couldn&#x27;t succeed!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;the last error message we received was: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">lastError</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;the final result&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li><strong><code>ZIO#retryOrElseEither</code></strong>— This operator is almost the same as the <strong><code>ZIO#retryOrElse</code></strong> except it will return either result of the original or the fallback operation:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> LocalConfig</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> RemoteConfig</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> readLocalConfig</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> LocalConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> readRemoteConfig</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> RemoteConfig</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">RemoteConfig</span><span class="token punctuation">,</span><span class="token plain"> LocalConfig</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readLocalConfig</span><span class="token punctuation">.</span><span class="token plain">retryOrElseEither</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    schedule0 </span><span class="token operator">=</span><span class="token plain"> Schedule</span><span class="token punctuation">.</span><span class="token plain">fibonacci</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    orElse </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token operator">:</span><span class="token plain"> Duration</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> readRemoteConfig</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li><strong><code>ZIO#retryUntil</code>/<code>ZIO#retryUntilZIO</code></strong>— We can retry an effect until a condition on the error channel is satisfied:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> retryUntil</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> retryUntilZIO</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Assume we have defined the following remote service call:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">sealed</span><span class="token plain"> </span><span class="token keyword">trait</span><span class="token plain">  ServiceError </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">object</span><span class="token plain"> TemporarilyUnavailable </span><span class="token keyword">extends</span><span class="token plain"> ServiceError</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">object</span><span class="token plain"> DataCorrupted          </span><span class="token keyword">extends</span><span class="token plain"> ServiceError</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> remoteService</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ServiceError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we repeat the failed remote service call until we reach the <code>DataCorrupted</code> error:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">remoteService</span><span class="token punctuation">.</span><span class="token plain">retryUntil</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">==</span><span class="token plain"> DataCorrupted</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To provide an effectful predicate we use the <code>ZIO#retryUntilZIO</code> operator.</p><ol start="6"><li><strong><code>ZIO#retryUntilEqual</code></strong>— Like the previous operator, it tries until its error is equal to the specified error:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">remoteService</span><span class="token punctuation">.</span><span class="token plain">retryUntilEquals</span><span class="token punctuation">(</span><span class="token plain">DataCorrupted</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li><strong><code>ZIO#retryWhile</code>/<code>ZIO#retryWhileZIO</code></strong>— Unlike the <code>ZIO#retryUntil</code> it will retry the effect while its error satisfies the specified predicate:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> retryWhile</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> retryWhileZIO</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we repeat the failed remote service call while we have the <code>TemporarilyUnavailable</code> error:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">remoteService</span><span class="token punctuation">.</span><span class="token plain">retryWhile</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">==</span><span class="token plain"> TemporarilyUnavailable</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To provide an effectful predicate we use the <code>ZIO#retryWhileZIO</code> operator.</p><ol start="8"><li><strong><code>ZIO#retryWhileEquals</code></strong>— Like the previous operator, it tries while its error is equal to the specified error:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">remoteService</span><span class="token punctuation">.</span><span class="token plain">retryWhileEquals</span><span class="token punctuation">(</span><span class="token plain">TemporarilyUnavailable</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-timing-out">5. Timing out<a class="hash-link" href="#5-timing-out" title="Direct link to heading">​</a></h3><ol><li><strong><code>ZIO#timeout</code></strong>— ZIO lets us timeout any effect using the <code>ZIO#timeout</code> method, which returns a new effect that succeeds with an <code>Option</code>. A value of <code>None</code> indicates the timeout elapsed before the effect completed. If an effect times out, then instead of continuing to execute in the background, it will be interrupted so no resources will be wasted.</li></ol><p>Assume we have the following effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;start doing something.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">2.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;my job is finished!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token string">&quot;result&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We should note that when we use the <code>ZIO#timeout</code> operator on the <code>myApp</code>, it doesn&#x27;t return until one of the following situations happens:</p><ol><li>The original effect returns before the timeout elapses so the output will be <code>Some</code> of the produced value by the original effect:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timeout</span><span class="token punctuation">(</span><span class="token number">3.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timed</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">_1</span><span class="token punctuation">.</span><span class="token plain">toMillis </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execution time of the whole program in second&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p>The original effect interrupted after the timeout elapses:</p><ul><li>If the effect is interruptible it will be immediately interrupted, and finally, the timeout operation produces <code>None</code> value.</li></ul><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timeout</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timed</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">_1</span><span class="token punctuation">.</span><span class="token plain">toMillis </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execution time of the whole program in second&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// start doing something.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// output: None</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// execution time of the whole program in second: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>If the effect is uninterruptible it will be blocked until the original effect safely finished its work, and then the timeout operator produces the <code>None</code> value:</li></ul><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">uninterruptible</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timeout</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timed</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">_1</span><span class="token punctuation">.</span><span class="token plain">toMillis </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execution time of the whole program in second&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// start doing something.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// my job is finished!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// output: None</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// execution time of the whole program in second: 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>Instead of waiting for the original effect to be interrupted, we can use <code>effect.disconnect.timeout</code> which first disconnects the effect&#x27;s interruption signal before performing the timeout. By using this technique, we can return early after the timeout has passed and before an underlying effect has been interrupted.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    myApp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">uninterruptible</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">disconnect</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timeout</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">timed</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">_1</span><span class="token punctuation">.</span><span class="token plain">toMillis </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execution time of the whole program in second&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By using this technique, the original effect will be interrupted in the background.</p><ol start="2"><li><strong><code>ZIO#timeoutTo</code></strong>— This operator is similar to the previous one, but it also allows us to manually create the final result type:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> delayedNextInt</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextIntBounded</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">delay</span><span class="token punctuation">(</span><span class="token number">2.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  delayedNextInt</span><span class="token punctuation">.</span><span class="token plain">timeoutTo</span><span class="token punctuation">(</span><span class="token plain">None</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  delayedNextInt</span><span class="token punctuation">.</span><span class="token plain">timeoutTo</span><span class="token punctuation">(</span><span class="token plain">Left</span><span class="token punctuation">(</span><span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">Right</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r3</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  delayedNextInt</span><span class="token punctuation">.</span><span class="token plain">timeoutTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">identity</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#timeoutFail</code>/<code>ZIO#timeoutFailCause</code></strong>— In case of elapsing the timeout, we can produce a particular error message:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">concurrent</span><span class="token namespace punctuation">.</span><span class="token plain">TimeoutException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> TimeoutException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  delayedNextInt</span><span class="token punctuation">.</span><span class="token plain">timeoutFail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> TimeoutException</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  delayedNextInt</span><span class="token punctuation">.</span><span class="token plain">timeoutFailCause</span><span class="token punctuation">(</span><span class="token plain">Cause</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Error</span><span class="token punctuation">(</span><span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-sandboxing">6. Sandboxing<a class="hash-link" href="#6-sandboxing" title="Direct link to heading">​</a></h3><p>We know that a ZIO effect may fail due to a failure, a defect, a fiber interruption, or a combination of these causes. So a ZIO effect may contain more than one cause. Using the <code>ZIO#sandbox</code> operator, we can sandbox all errors of a ZIO application, whether the cause is a failure, defect, or a fiber interruption or combination of these. This operator exposes the full cause of a ZIO effect into the error channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> sandbox</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can use the <code>ZIO#sandbox</code> operator to uncover the full causes of an <em>exceptional effect</em>. So we can see all the errors that occurred as a type of <code>Cause[E]</code> at the error channel of the <code>ZIO</code> data type. So then we can use normal error-handling operators such as <code>ZIO#catchSome</code> and <code>ZIO#catchAll</code> operators:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;primary result&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    effect</span><span class="token punctuation">.</span><span class="token plain">sandbox</span><span class="token punctuation">.</span><span class="token plain">catchSome </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Interrupt</span><span class="token punctuation">(</span><span class="token plain">fiberId</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Caught interruption of a fiber with id: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">fiberId</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;fallback result on fiber interruption&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Die</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Caught a defect: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;fallback result on defect&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Fail</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Caught a failure: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;fallback result on failure&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> finalApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">unsandbox</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;final result&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> finalApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Caught a failure: Oh uh!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// final result: fallback result on failure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the <code>sandbox</code> operation we are exposing the full cause of an effect. So then we have access to the underlying cause in more detail. After handling exposed causes using <code>ZIO#catch*</code> operators, we can undo the <code>sandbox</code> operation using the <code>unsandbox</code> operation. It will submerge the full cause (<code>Cause[E]</code>) again:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> effect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;primary result&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">effect            </span><span class="token comment">// ZIO[Any, String, String]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">sandbox        </span><span class="token comment">// ZIO[Any, Cause[String], String]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">catchSome</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, Cause[String], String]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">unsandbox      </span><span class="token comment">// ZIO[Any, String, String]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is another version of sandbox called <code>ZIO#sandboxWith</code>. This operator helps us to sandbox, then catch all causes, and then unsandbox back:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> sandboxWith</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try the previous example using this operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;primary result&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    effect</span><span class="token punctuation">.</span><span class="token plain">sandboxWith</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> e </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      e</span><span class="token punctuation">.</span><span class="token plain">catchSome </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Interrupt</span><span class="token punctuation">(</span><span class="token plain">fiberId</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Caught interruption of a fiber with id: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">fiberId</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;fallback result on fiber interruption&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Die</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Caught a defect: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;fallback result on defect&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> Cause</span><span class="token punctuation">.</span><span class="token plain">Fail</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Caught a failure: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;fallback result on failure&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-accumulation">Error Accumulation<a class="hash-link" href="#error-accumulation" title="Direct link to heading">​</a></h2><p>Sequential combinators such as <code>ZIO#zip</code> and <code>ZIO.foreach</code> stop when they reach the first error and return immediately. So their policy on error management is to fail fast.</p><p>In the following example, we can see that the <code>ZIO#zip</code> operator will fail as soon as it reaches the first failure. As a result, we only see the first error in the stack trace:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">  </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f3</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f4</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">  </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh no!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f1 zip f2 zip f3 zip f4</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is also the <code>ZIO.foreach</code> operator that takes a collection and an effectful operation, then tries to apply the transformation to all elements of the collection. This operator also has the same error management behavior. It fails when it encounters the first error:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is not less that 4&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are some situations when we need to collect all potential errors in a computation rather than failing fast. In this section, we will discuss operators that accumulate errors as well as successes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ziovalidate"><code>ZIO#validate</code><a class="hash-link" href="#ziovalidate" title="Direct link to heading">​</a></h3><p>It is similar to the <code>ZIO#zip</code> operator, it sequentially zips two ZIO effects together, if both effects fail, it combines their causes with <code>Cause.Then</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> validate</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">that</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If any of effecful operations doesn&#x27;t fail, it results like the <code>zip</code> operator. Otherwise, when it reaches the first error it won&#x27;t stop, instead, it will continue the zip operation until reach the final effect while combining:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f1 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f2 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f3 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f4 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh error!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f5 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f1 validate f2 validate f3 validate f4 validate f5</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">cause</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">.</span><span class="token plain">uncause</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZIO#validatePar</code> operator is similar to the <code>ZIO#validate</code> operator zips two effects but in parallel. As this operator doesn&#x27;t fail fast, unlike the <code>ZIO#zipPar</code> if it reaches a failure, it won&#x27;t interrupt another running effect. If both effects fail, it will combine their causes with <code>Cause.Both</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f1 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f2 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f3 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f4 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh error!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f5 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f1 validatePar f2 validatePar f3 validatePar f4 validatePar f5</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">cause</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">untraced</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">.</span><span class="token plain">uncause</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In addition, it has a <code>ZIO#validateWith</code> variant, which is useful for providing combiner function (<code>f: (A, B) =&gt; C</code>) to combine pair values.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ziovalidate-1"><code>ZIO.validate</code><a class="hash-link" href="#ziovalidate-1" title="Direct link to heading">​</a></h3><p>This operator is very similar to the <code>ZIO.foreach</code> operator. It transforms all elements of a collection using the provided effectful operation, but it collects all errors in the error channel, as well as the success values in the success channel.</p><p>It is similar to the <code>ZIO.partition</code> but it is an exceptional operator which means it collects errors in the error channel and success in the success channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> validate</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">in</span><span class="token operator">:</span><span class="token plain"> Collection</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">::</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> Collection</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> validate</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">in</span><span class="token operator">:</span><span class="token plain"> NonEmptyChunk</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">::</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> NonEmptyChunk</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another difference is that this operator is lossy, which means if there are errors all successes will be lost.</p><p>In the lossy scenario, it will collect all errors in the error channel, which cause the failure:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">::</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">validate</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is not less that 5&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the success scenario when we have no errors at all, all the successes will be collected in the success channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">::</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">validate</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is not less that 5&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Two more notes:</p><ol><li>The <code>ZIO.validate</code> operator is sequential, so we can use the <code>ZIO.validatePar</code> version to do the computation in parallel.</li><li>The <code>ZIO.validateDiscard</code> and <code>ZIO.validateParDiscard</code> operators are mostly similar to their non-discard versions, except they discard the successes. So the type of the success channel will be <code>Unit</code>.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ziovalidatefirst"><code>ZIO.validateFirst</code><a class="hash-link" href="#ziovalidatefirst" title="Direct link to heading">​</a></h3><p>Like the <code>ZIO.validate</code> in the success scenario, it will collect all errors in the error channel except in the success scenario it will return only the first success:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> validateFirst</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">in</span><span class="token operator">:</span><span class="token plain"> Collection</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Collection</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the failure scenario, it will collect all errors in the failure channel, and it causes the failure:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">validateFirst</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is not less that 5&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the success scenario it will return the first success value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">validateFirst</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is not less that 5&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ziopartition"><code>ZIO.partition</code><a class="hash-link" href="#ziopartition" title="Direct link to heading">​</a></h3><p>The partition operator takes an iterable and effectful function that transforms each value of the iterable and finally creates a tuple of both failures and successes in the success channel.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> partition</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">in</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Iterable</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">Iterable</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> Iterable</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that this operator is an unexceptional effect, which means the type of the error channel is <code>Nothing</code>. So using this operator, if we reach a failure case, the whole effect doesn&#x27;t fail. This is similar to the <code>List#partition</code> in the standard library:</p><p>Let&#x27;s try an example of collecting even numbers from the range of 0 to 7:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">Iterable</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> Iterable</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">partition</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is not even&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">res</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-channel-operations">Error Channel Operations<a class="hash-link" href="#error-channel-operations" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="map-and-flatmap-on-the-error-channel">Map and FlatMap on the Error Channel<a class="hash-link" href="#map-and-flatmap-on-the-error-channel" title="Direct link to heading">​</a></h3><p>Other than <code>ZIO#map</code> and <code>ZIO#flatMap</code>, ZIO has several other operators to manage errors while mapping:</p><ol><li><strong><code>ZIO#mapError</code>/<code>ZIO#mapErrorCause</code></strong>— Let&#x27;s begin with <code>ZIO#mapError</code> and <code>ZIO#mapErrorCause</code>. These operators help us to access the error channel as a raw error value or as a type of <code>Cause</code> and map their values:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> mapError</span><span class="token punctuation">[</span><span class="token plain">E2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> E2</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> mapErrorCause</span><span class="token punctuation">[</span><span class="token plain">E2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">h</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here are two simple examples for these operators:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// mapping the error of the original effect to its message</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;five&quot;</span><span class="token punctuation">)</span><span class="token plain">                </span><span class="token comment">// ZIO[Any, NumberFormatException, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">e </span><span class="token keyword">=&gt;</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token plain">getMessage</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token comment">// ZIO[Any, String, Int]  // ZIO[Any, String, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// mapping the cause of the original effect to be untraced</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2 </span><span class="token operator">=</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;five&quot;</span><span class="token punctuation">)</span><span class="token plain">         </span><span class="token comment">// ZIO[Any, NumberFormatException, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">mapErrorCause</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">untraced</span><span class="token punctuation">)</span><span class="token plain">      </span><span class="token comment">// ZIO[Any, NumberFormatException, Int]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><em><strong>Note:</strong></em></p><p>Note that mapping over an effect&#x27;s success or error channel does not change the success or failure of the effect, in the same way that mapping over an <code>Either</code> does not change whether the <code>Either</code> is <code>Left</code> or <code>Right</code>.</p></blockquote><ol start="2"><li><strong><code>ZIO#mapAttempt</code></strong>— The <code>ZIO#mapAttempt</code> returns an effect whose success is mapped by the specified side-effecting <code>f</code> function, translating any thrown exceptions into typed failed effects. So it converts an unchecked exception to a checked one by returning the <code>RIO</code> effect.</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">  </span><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">def</span><span class="token plain"> map</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> B</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">def</span><span class="token plain"> mapAttempt</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> B</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using operations that can throw exceptions inside of <code>ZIO#map</code> such as <code>effect.map(_.unsafeOpThatThrows)</code> will result in a defect (an unexceptional effect that will die). In the following example, when we use the <code>ZIO#map</code> operation. So, if the <code>String#toInt</code> operation throws <code>NumberFormatException</code> it will be converted to a defect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">orDie</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As a result, when the map operation is unsafe, it may lead to buggy programs that may crash, as shown below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter a number: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;You have entered an even number.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;You have entered an odd number.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Converting literal &quot;five&quot; String to Int by calling <code>toInt</code> is a side effecting operation because it will throw <code>NumberFormatException</code> exception. So in the previous example, if we enter a non-integer number, e.g. &quot;five&quot;, it will die because of a <code>NumberFormatException</code> defect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">Please enter a number</span><span class="token operator">:</span><span class="token plain"> five</span><br></span><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">17</span><span class="token plain">T14</span><span class="token operator">:</span><span class="token number">01</span><span class="token operator">:</span><span class="token number">33.323639073</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token string">&quot; java.lang.NumberFormatException: For input string: &quot;</span><span class="token plain">five&quot;</span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">NumberFormatException</span><span class="token punctuation">.</span><span class="token plain">forInputString</span><span class="token punctuation">(</span><span class="token plain">NumberFormatException</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">parseInt</span><span class="token punctuation">(</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">660</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">parseInt</span><span class="token punctuation">(</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">778</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at scala</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">StringOps$</span><span class="token punctuation">.</span><span class="token plain">toInt$extension</span><span class="token punctuation">(</span><span class="token plain">StringOps</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">910</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$myApp$</span><span class="token number">3</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$myApp$</span><span class="token number">3</span><span class="token plain">$adapted</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">$anonfun$map$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">1168</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$FlatMap</span><span class="token punctuation">.</span><span class="token plain">apply</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">6182</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$FlatMap</span><span class="token punctuation">.</span><span class="token plain">apply</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">6171</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">runUntil</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">885</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">util</span><span class="token punctuation">.</span><span class="token plain">concurrent</span><span class="token punctuation">.</span><span class="token plain">ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token plain">runWorker</span><span class="token punctuation">(</span><span class="token plain">ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">1130</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">util</span><span class="token punctuation">.</span><span class="token plain">concurrent</span><span class="token punctuation">.</span><span class="token plain">ThreadPoolExecutor$Worker</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">630</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">Thread</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">Thread</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">831</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">runUntil</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">538</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">myApp</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">myApp</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see that the error channel of <code>myApp</code> is typed as <code>Nothing</code>, so it&#x27;s not an exceptional error. If we want typed effects, this behavior is not intended. So instead of <code>ZIO#map</code> we can use the <code>mapAttempt</code> combinator which is a safe map operator that translates all thrown exceptions into typed exceptional effect.</p><p>To prevent converting exceptions to defects, we can use <code>ZIO#mapAttempt</code> which converts any exceptions to exceptional effects:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">orDie</span><span class="token punctuation">.</span><span class="token plain">mapAttempt</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Having typed errors helps us to catch errors explicitly and handle them in the right way:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter a number: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">mapAttempt</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;You have entered an even number.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;You have entered an odd number.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> myApp</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#mapBoth</code></strong>— It takes two map functions, one for the error channel and the other for the success channel, and maps both sides of a ZIO effect:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> mapBoth</span><span class="token punctuation">[</span><span class="token plain">E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> g</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> B</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is a simple example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">orDie</span><span class="token punctuation">.</span><span class="token plain">mapAttempt</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">mapBoth</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string">&quot;non-integer input&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    n </span><span class="token keyword">=&gt;</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token plain">abs</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li><strong><code>ZIO#flatMapError</code></strong>— Unlike <code>ZIO#flatMap</code> the <code>ZIO#flatMapError</code> combinator chains two effects, where the second effect is dependent on the error channel of the first effect:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> flatMapError</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we are trying to find a random prime number between 1000 and 10000. We will use the <code>ZIO#flatMapError</code> to collect all errors inside a <code>Ref</code> of type <code>List[String]</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> isPrime</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token number">2</span><span class="token plain"> until n</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">forall</span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token keyword">=&gt;</span><span class="token plain"> n </span><span class="token operator">%</span><span class="token plain"> i </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> findPrimeBetween</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      minInclusive</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      maxExclusive</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      errors </span><span class="token keyword">&lt;-</span><span class="token plain"> Ref</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      number </span><span class="token keyword">&lt;-</span><span class="token plain"> Random</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">nextIntBetween</span><span class="token punctuation">(</span><span class="token plain">minInclusive</span><span class="token punctuation">,</span><span class="token plain"> maxExclusive</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">reject </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> n </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">isPrime</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;non-prime number rejected: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string">&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">flatMapError</span><span class="token punctuation">(</span><span class="token plain">error </span><span class="token keyword">=&gt;</span><span class="token plain"> errors</span><span class="token punctuation">.</span><span class="token plain">updateAndGet</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">:</span><span class="token operator">+</span><span class="token plain"> error</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">retryUntil</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">length </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> number</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    findPrimeBetween</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">prime </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;found a prime number: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">prime</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">errors</span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;failed to find a prime number after 5 attempts:\n  </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">errors</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">mkString</span><span class="token string-interpolation interpolation expression punctuation">(</span><span class="token string-interpolation interpolation expression string">&quot;\n  &quot;</span><span class="token string-interpolation interpolation expression punctuation">)</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="filtering-the-success-channel-values">Filtering the Success Channel Values<a class="hash-link" href="#filtering-the-success-channel-values" title="Direct link to heading">​</a></h3><p>ZIO has a variety of operators that can filter values on the success channel based on a given predicate, and if the predicate fails, we can use different strategies:</p><ul><li>Failing the original effect (<code>ZIO#filterOrFail</code>)</li><li>Dying the original effect (<code>ZIO#filterOrDie</code> and <code>ZIO#filterOrDieMessage</code>)</li><li>Running an alternative ZIO effect (<code>ZIO#filterOrElse</code> and <code>ZIO#filterOrElseWith</code>)</li></ul><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> getNumber</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter a non-negative number: &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">mapAttempt</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">retryUntil</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">isInstanceOf</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">.</span><span class="token plain">filterOrFail</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;random number is negative&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">.</span><span class="token plain">filterOrDie</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">new</span><span class="token plain"> IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;random number is negative&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r3</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">.</span><span class="token plain">filterOrDieMessage</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;random number is negative&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r4</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">.</span><span class="token plain">filterOrElse</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">getNumber</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r5</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">.</span><span class="token plain">filterOrElseWith</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tapping-errors">Tapping Errors<a class="hash-link" href="#tapping-errors" title="Direct link to heading">​</a></h3><p>Like <a href="/references/core/zio/#tapping">tapping for success values</a> ZIO has several operators for tapping error values. So we can peek into failures or underlying defects or causes:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tapError</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tapErrorCause</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tapErrorTrace</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> Trace</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tapDefect</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tapBoth</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> g</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tapEither</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try an example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">mapAttempt</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">tapError </span><span class="token punctuation">{</span><span class="token plain"> e </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;user entered an invalid input: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">e</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">when</span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token punctuation">.</span><span class="token plain">isInstanceOf</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="putting-errors-into-success-channel-and-submerging-them-back-again">Putting Errors Into Success Channel and Submerging Them Back Again<a class="hash-link" href="#putting-errors-into-success-channel-and-submerging-them-back-again" title="Direct link to heading">​</a></h3><p>Before taking into <code>ZIO#either</code> and <code>ZIO#absolve</code>, let&#x27;s see their signature:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> either</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev</span><span class="token operator">:</span><span class="token plain"> CanFail</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> absolve</span><span class="token punctuation">[</span><span class="token plain">E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev</span><span class="token operator">:</span><span class="token plain"> A IsSubtypeOfOutput Either</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><strong><code>ZIO#either</code></strong>— The <code>ZIO#either</code> convert a <code>ZIO[R, E, A]</code> effect to another effect in which its failure (<code>E</code>) and success (<code>A</code>) channel have been lifted into an <code>Either[E, A]</code> data type as success channel of the <code>ZIO</code> data type:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">AgeValidationException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> validate</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">either</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The resulting effect is an unexceptional effect and cannot fail, because the failure case has been exposed as part of the <code>Either</code> success case. The error parameter of the returned <code>ZIO</code> is <code>Nothing</code>, since it is guaranteed the <code>ZIO</code> effect does not model failure.</p><p>This method is useful for recovering from <code>ZIO</code> effects that may fail:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter your age: &quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    age </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    res </span><span class="token keyword">&lt;-</span><span class="token plain"> validate</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">either</span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> res </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Left</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;validation failed: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">error</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;The </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">age</span><span class="token string-interpolation string"> validated!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO#absolve</code>/<code>ZIO.absolve</code></strong>— The <code>ZIO#abolve</code> operator and the <code>ZIO.absolve</code> constructor perform the inverse. They submerge the error case of an <code>Either</code> into the <code>ZIO</code>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">validate</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, AgeValidationException, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">either     </span><span class="token comment">// ZIO[Any, Either[AgeValidationException, Int]]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">absolve    </span><span class="token comment">// ZIO[Any, AgeValidationException, Int]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is another example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> sqrt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">absolve</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    input</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> value </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">value </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Left</span><span class="token punctuation">(</span><span class="token string">&quot;Value must be &gt;= 0.0&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Right</span><span class="token punctuation">(</span><span class="token plain">Math</span><span class="token punctuation">.</span><span class="token plain">sqrt</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="converting-defects-to-failures">Converting Defects to Failures<a class="hash-link" href="#converting-defects-to-failures" title="Direct link to heading">​</a></h3><p>Both <code>ZIO#resurrect</code> and <code>ZIO#absorb</code> are symmetrical opposite of the <code>ZIO#orDie</code> operator. The <code>ZIO#orDie</code> takes failures from the error channel and converts them into defects, whereas the <code>ZIO#absorb</code> and <code>ZIO#resurrect</code> take defects and convert them into failures:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> absorb</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev</span><span class="token operator">:</span><span class="token plain"> E IsSubtypeOfError Throwable</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> absorbWith</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> Throwable</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> resurrect</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev1</span><span class="token operator">:</span><span class="token plain"> E IsSubtypeOfError Throwable</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below are examples of the <code>ZIO#absorb</code> and <code>ZIO#resurrect</code> operators:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> effect1 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;wrong argument&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token comment">// ZIO[Any, IllegalArgumentException, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">orDie                                                  </span><span class="token comment">// ZIO[Any, Nothing, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">absorb                                                 </span><span class="token comment">// ZIO[Any, Throwable, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">IllegalArgumentException</span><span class="token punctuation">]</span><span class="token plain">                </span><span class="token comment">// ZIO[Any, IllegalArgumentException, Nothing]                // ZIO[Any, IllegalArgumentException, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> effect2 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;wrong argument&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token comment">// ZIO[Any, IllegalArgumentException , Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">orDie                                                  </span><span class="token comment">// ZIO[Any, Nothing, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">resurrect                                              </span><span class="token comment">// ZIO[Any, Throwable, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">IllegalArgumentException</span><span class="token punctuation">]</span><span class="token plain">                </span><span class="token comment">// ZIO[Any, IllegalArgumentException, Nothing]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So what is the difference between <code>ZIO#absorb</code> and <code>ZIO#resurrect</code> operators?</p><p>The <code>ZIO#absorb</code> can recover from both <code>Die</code> and <code>Interruption</code> causes. Using this operator we can absorb failures, defects and interruptions using <code>ZIO#absorb</code> operation. It attempts to convert all causes into a failure, throwing away all information about the cause of the error:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect1 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, Nothing, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">absorb               </span><span class="token comment">// ZIO[Any, Throwable, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">ignore</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect2 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">interrupt           </span><span class="token comment">// ZIO[Any, Nothing, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">absorb               </span><span class="token comment">// ZIO[Any, Throwable, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">ignore</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">effect1 </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> effect2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;application exited successfully&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output would be as below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">application exited successfully</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Whereas, the <code>ZIO#resurrect</code> will only recover from <code>Die</code> causes:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect1 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, Nothing, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">resurrect           </span><span class="token comment">// ZIO[Any, Throwable, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">ignore</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect2 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">interrupt          </span><span class="token comment">// ZIO[Any, Nothing, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">resurrect           </span><span class="token comment">// ZIO[Any, Throwable, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">ignore</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">effect1 </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> effect2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;couldn&#x27;t recover from fiber interruption&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And, here is the output:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">18</span><span class="token plain">T14</span><span class="token operator">:</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">52.559872464</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token string">&quot; java.lang.InterruptedException: Interrupted by thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token plain">&quot;</span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">effect2</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">effect2</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">effect2</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="error-refinement">Error Refinement<a class="hash-link" href="#error-refinement" title="Direct link to heading">​</a></h3><p>ZIO has some operators useful for converting defects into failures. So we can take part in non-recoverable errors and convert them into the typed error channel and vice versa.</p><p>Note that both <code>ZIO#refine*</code> and <code>ZIO#unrefine*</code> do not alter the error behavior, but only change the error model. That is to say, if an effect fails or die, then after <code>ZIO#refine*</code> or <code>ZIO#unrefine*</code>, it will still fail or die; and if an effect succeeds, then after <code>ZIO#refine*</code> or <code>ZIO#unrefine*</code>, it will still succeed; only the manner in which it signals the error will be altered by these two methods:</p><ol><li>The <code>ZIO#refine*</code> pinches off a piece of <em>failure</em> of type <code>E</code>, and converts it into a <em>defect</em>.</li><li>The <code>ZIO#unrefine*</code> pinches off a piece of a <em>defect</em>, and converts it into a <em>failure</em> of type <code>E</code>.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="refining">Refining<a class="hash-link" href="#refining" title="Direct link to heading">​</a></h4><ol><li><strong><code>ZIO#refineToOrDie</code></strong>— This operator <strong>narrows</strong> down the type of the error channel from <code>E</code> to the <code>E1</code>. It leaves the rest errors untyped, so everything that doesn&#x27;t fit is turned into a defect. So it makes the error space <strong>smaller</strong>.</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">E1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we are going to implement <code>parseInt</code> by importing <code>String#toInt</code> code from the standard scala library using <code>ZIO#attempt</code> and then refining the error channel from <code>Throwable</code> to the <code>NumberFormatException</code> error type:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain">                 </span><span class="token comment">// ZIO[Any, Throwable, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token plain">  </span><span class="token comment">// ZIO[Any, NumberFormatException, Int]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, if the <code>input.toInt</code> throws any other exceptions other than <code>NumberFormatException</code>, e.g. <code>IndexOutOfBoundsException</code>, will be translated to the ZIO defect.</p><ol start="2"><li><strong><code>ZIO#refineOrDie</code></strong>— It is the more powerful version of the previous operator. Instead of refining to one specific error type, we can refine to multiple error types using a partial function:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> refineOrDie</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we excluded the <code>Baz</code> exception from recoverable errors, so it will be converted to a defect. In another word, we narrowed <code>DomainError</code> down to just <code>Foo</code> and <code>Bar</code> errors:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">sealed</span><span class="token plain"> </span><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DomainError</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">with</span><span class="token plain"> Serializable</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">with</span><span class="token plain"> Product</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Foo</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DomainError</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Bar</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DomainError</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Baz</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DomainError</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> DomainError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">Baz</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> refined</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> DomainError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    effect</span><span class="token punctuation">.</span><span class="token plain">refineOrDie </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> foo</span><span class="token operator">:</span><span class="token plain"> Foo </span><span class="token keyword">=&gt;</span><span class="token plain"> foo</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> bar</span><span class="token operator">:</span><span class="token plain"> Bar </span><span class="token keyword">=&gt;</span><span class="token plain"> bar</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> refined</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#refineOrDieWith</code></strong>— In the two previous refine combinators, we were dealing with exceptional effects whose error channel type was <code>Throwable</code> or a subtype of that. The <code>ZIO#refineOrDieWith</code> operator is a more powerful version of refining operators. It can work with any exceptional effect whether they are <code>Throwable</code> or not. When we narrow down the failure space, some failures become defects. To convert those failures to defects, it takes a function from <code>E</code> to <code>Throwable</code>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> refineOrDieWith</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> Throwable</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we excluded the <code>BazError</code> from recoverable errors, so it will be converted to a defect. In another word, we narrowed the whole space of <code>String</code> errors down to just &quot;FooError&quot; and &quot;BarError&quot;:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> effect</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;FooError&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;BarError&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;BazError&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> refined</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    effect</span><span class="token punctuation">(</span><span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">refineOrDieWith </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;FooError&quot;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string">&quot;BarError&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string">&quot;Oh Uh!&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token plain">e </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Throwable</span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> refined</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="unrefining">Unrefining<a class="hash-link" href="#unrefining" title="Direct link to heading">​</a></h4><ol><li><strong><code>ZIO#unrefineTo[E1 &gt;: E]</code></strong>— This operator <strong>broadens</strong> the type of the error channel from <code>E</code> to the <code>E1</code> and embeds some defects into it. So it is going from some fiber failures back to errors and thus making the error type <strong>larger</strong>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> unrefineTo</span><span class="token punctuation">[</span><span class="token plain">E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we are going to implement <code>parseInt</code> by importing <code>String#toInt</code> code from the standard scala library using <code>ZIO#succeed</code> and then unrefining the error channel from <code>Nothing</code> to the <code>NumberFormatException</code> error type:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain">              </span><span class="token comment">// ZIO[Any, Nothing, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">unrefineTo</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token plain">  </span><span class="token comment">// ZIO[Any, NumberFormatException, Int]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO#unrefine</code></strong>— It is a more powerful version of the previous operator. It takes a partial function from <code>Throwable</code> to <code>E1</code> and converts those defects to recoverable errors:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> unrefine</span><span class="token punctuation">[</span><span class="token plain">E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Foo</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Throwable</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Bar</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Throwable</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Baz</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Throwable</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> unsafeOpThatMayThrows</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">throw</span><span class="token plain"> Foo</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">throw</span><span class="token plain"> Bar</span><span class="token punctuation">(</span><span class="token string">&quot;Oh Error!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">throw</span><span class="token plain"> Baz</span><span class="token punctuation">(</span><span class="token string">&quot;Oh no!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"> i</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> effect</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">unsafeOpThatMayThrows</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> unrefined</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Foo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    effect</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">unrefine </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> Foo </span><span class="token keyword">=&gt;</span><span class="token plain"> e </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> unrefined</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using <code>ZIO#unrefine</code> we can have more control to unrefine a ZIO effect that may die because of some defects, for example in the following example we are going to convert both <code>Foo</code> and <code>Bar</code> defects to recoverable errors and remain <code>Baz</code> unrecoverable:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> unrefined</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  effect</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">unrefine </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> Foo </span><span class="token keyword">=&gt;</span><span class="token plain"> e</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> Bar </span><span class="token keyword">=&gt;</span><span class="token plain"> e</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#unrefineWith</code></strong>- This is the most powerful version of unrefine operators. It takes a partial function, as the previous operator, and then tries to broaden the failure space by converting some of the defects to typed recoverable errors. If it doesn&#x27;t find any defect, it will apply the <code>f</code> which is a function from <code>E</code> to <code>E1</code>, and map all typed errors using this function:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> unrefineWith</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> E </span><span class="token keyword">=&gt;</span><span class="token plain"> E1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Foo</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Bar</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> effect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Foo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">ifZIO</span><span class="token punctuation">(</span><span class="token plain">Random</span><span class="token punctuation">.</span><span class="token plain">nextBoolean</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      onTrue </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">Foo</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      onFalse </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token plain">Bar</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> unrefined</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    effect</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">unrefineWith </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> Bar </span><span class="token keyword">=&gt;</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token plain">getMessage</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token plain">e </span><span class="token keyword">=&gt;</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token plain">getMessage</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> unrefined</span><span class="token punctuation">.</span><span class="token plain">cause</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="converting-option-on-values-to-option-on-errors-and-vice-versa">Converting Option on Values to Option on Errors and Vice Versa<a class="hash-link" href="#converting-option-on-values-to-option-on-errors-and-vice-versa" title="Direct link to heading">​</a></h3><p>We can extract a value from a Some using <code>ZIO#some</code> and then we can unsome it again using <code>ZIO#unsome</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">Option</span><span class="token punctuation">(</span><span class="token string">&quot;something&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, Throwable, Option[String]]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">some                          </span><span class="token comment">// ZIO[Any, Option[Throwable], String]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">unsome                        </span><span class="token comment">// ZIO[Any, Throwable, Option[String]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flattening-optional-error-types">Flattening Optional Error Types<a class="hash-link" href="#flattening-optional-error-types" title="Direct link to heading">​</a></h3><p>If we have an optional error of type <code>E</code> in the error channel, we can flatten it to the <code>E</code> type using the <code>ZIO#flattenErrorOption</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">isEmpty</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token string">&quot;empty input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> _</span><span class="token operator">:</span><span class="token plain"> NumberFormatException </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">None</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> flattenedParseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  parseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flattenErrorOption</span><span class="token punctuation">(</span><span class="token string">&quot;non-numeric input&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> flattenedParseInt</span><span class="token punctuation">(</span><span class="token string">&quot;zero&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> flattenedParseInt</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r3</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> flattenedParseInt</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="merging-the-error-channel-into-the-success-channel">Merging the Error Channel into the Success Channel<a class="hash-link" href="#merging-the-error-channel-into-the-success-channel" title="Direct link to heading">​</a></h3><p>With <code>ZIO#merge</code> we can merge the error channel into the success channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> merged </span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, String, Nothing]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">merge           </span><span class="token comment">// ZIO[Any, Nothing, String]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the error and success channels were of different types, it would choose the supertype of both.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flipping-the-error-and-success-channels">Flipping the Error and Success Channels<a class="hash-link" href="#flipping-the-error-and-success-channels" title="Direct link to heading">​</a></h3><p>Sometimes, we would like to apply some methods on the error channel which are specific for the success channel, or we want to apply some methods on the success channel which are specific for the error channel. Therefore, we can flip the error and success channel and before flipping back, we can perform the right operator on flipped channels:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> flip</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> flipWith</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Assume we have the following example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> evens</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">validate</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is not even&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We want to reverse the order of errors. In order to do that instead of using <code>ZIO#mapError</code>, we can map the error channel by using flip operators:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> evens</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">reverse</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> evens</span><span class="token punctuation">.</span><span class="token plain">flip</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">reverse</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flip</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r3</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> evens</span><span class="token punctuation">.</span><span class="token plain">flipWith</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">reverse</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rejecting-some-success-values">Rejecting Some Success Values<a class="hash-link" href="#rejecting-some-success-values" title="Direct link to heading">​</a></h3><p>We can reject some success values using the <code>ZIO#reject</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> reject</span><span class="token punctuation">[</span><span class="token plain">E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> rejectZIO</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    pf</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the <code>PartialFunction</code> matches, it will reject that success value and convert that to a failure, otherwise it will continue with the original success value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">nextIntBounded</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">reject </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> n </span><span class="token keyword">if</span><span class="token plain"> n </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;even number rejected: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string">&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain">               </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string">&quot;number 5 was rejected&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zoom-inout-on-left-or-right-side-of-an-either-value">Zoom in/out on Left or Right Side of An Either Value<a class="hash-link" href="#zoom-inout-on-left-or-right-side-of-an-either-value" title="Direct link to heading">​</a></h3><p>With <code>Either</code> ZIO values, we can zoom in or out on the left or right side of an <code>Either</code>, as well as we can do the inverse and zoom out.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> eitherEffect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Exception</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">eitherEffect </span><span class="token comment">// ZIO[Any, Exception, Either[String, Int]]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">left      </span><span class="token comment">// ZIO[Any, Either[Exception, Int], String]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">unleft    </span><span class="token comment">// ZIO[Any, Exception, Either[String, Int]]    // ZIO[Any, Exception, Either[String, Int]]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">eitherEffect </span><span class="token comment">// ZIO[Any, Exception, Either[String, Int]]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">right     </span><span class="token comment">// ZIO[Any, Either[String, Exception], Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">unright   </span><span class="token comment">// ZIO[Any, Exception, Either[String, Int]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="converting-optional-values-to-optional-errors-and-vice-versa">Converting Optional Values to Optional Errors and Vice Versa<a class="hash-link" href="#converting-optional-values-to-optional-errors-and-vice-versa" title="Direct link to heading">​</a></h3><p>Assume we have the following effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> nextRandomEven</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">reject </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> n </span><span class="token keyword">if</span><span class="token plain"> n </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> is negative!&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> n </span><span class="token keyword">if</span><span class="token plain"> n </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> _               </span><span class="token keyword">=&gt;</span><span class="token plain"> None</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can convert this effect which is optional on the success channel to an effect that is optional on the error channel using the <code>ZIO#some</code> operator and also the <code>ZIO#unsome</code> to reverse this conversion.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">nextRandomEven </span><span class="token comment">// ZIO[Any, String, Option[Int]]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">some        </span><span class="token comment">// ZIO[Any, Option[String], Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">unsome      </span><span class="token comment">// ZIO[Any, String, Option[Int]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sometimes instead of converting optional values to optional errors, we can perform one of the following operations:</p><ol><li><strong><code>ZIO#someOrElse</code></strong>— Extract the optional value if it is not empty or return the given default:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> getEnv</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  getEnv</span><span class="token punctuation">.</span><span class="token plain">someOrElse</span><span class="token punctuation">(</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO#someOrElseZIO</code></strong>— Like the <code>ZIO#someOrElse</code> but the effectful version:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Config</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> list</span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Config</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> getCurrentConfig</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token plain">Config</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">list</span><span class="token punctuation">.</span><span class="token plain">headOption</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> getRemoteConfig </span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Config</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Config </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> config</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Config</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  getCurrentConfig</span><span class="token punctuation">.</span><span class="token plain">someOrElseZIO</span><span class="token punctuation">(</span><span class="token plain">getRemoteConfig</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO#someOrFail</code></strong>— It converts the ZIO effect of an optional value to an exceptional effect:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> head</span><span class="token punctuation">(</span><span class="token plain">list</span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NoSuchElementException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">list</span><span class="token punctuation">.</span><span class="token plain">headOption</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">someOrFail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> NoSuchElementException</span><span class="token punctuation">(</span><span class="token string">&quot;empty list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above example, we can also use the <code>ZIO#someOrFailException</code> which will directly convert the unexceptional effect to the exceptional effect with the error type of <code>NoSuchElementException</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="uncovering-the-underlying-cause-of-an-effect">Uncovering the Underlying Cause of an Effect<a class="hash-link" href="#uncovering-the-underlying-cause-of-an-effect" title="Direct link to heading">​</a></h3><p>Using the <code>ZIO#cause</code> operation we can expose the cause, and then by using <code>ZIO#uncause</code> we can reverse this operation:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> cause</span><span class="token operator">:</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> uncause</span><span class="token punctuation">[</span><span class="token plain">E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> ev</span><span class="token operator">:</span><span class="token plain"> A IsSubtypeOfOutput Cause</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the following example, we expose and then untrace the underlying cause:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh uh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> f2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> f1 zipPar f2</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">cause</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">untraced</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sometimes the <a href="#map-and-flatmap-on-error-channel"><code>ZIO#mapErrorCause</code></a> operator is a better choice when we just want to map the underlying cause without exposing the cause.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a class="hash-link" href="#best-practices" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="model-domain-errors-using-algebraic-data-types">Model Domain Errors Using Algebraic Data Types<a class="hash-link" href="#model-domain-errors-using-algebraic-data-types" title="Direct link to heading">​</a></h3><p>It is best to use <em>algebraic data types (ADTs)</em> when modeling errors within the same domain or subdomain.</p><p>Sealed traits allow us to introduce an error type as a common supertype and all errors within a domain are part of that error type by extending that:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">sealed</span><span class="token plain"> </span><span class="token keyword">trait</span><span class="token plain"> UserServiceError </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> InvalidUserId</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> ID</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> UserServiceError</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ExpiredAuth</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> ID</span><span class="token punctuation">)</span><span class="token plain">   </span><span class="token keyword">extends</span><span class="token plain"> UserServiceError</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, the super error type is <code>UserServiceError</code>. We sealed that trait, and we extend it by two cases, <code>InvalidUserId</code> and <code>ExpiredAuth</code>. Because it is sealed, if we have a reference to a <code>UserServiceError</code> we can match against it and the Scala compiler knows there are two possibilities for a <code>UserServiceError</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">userServiceError </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> InvalidUserId</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> ExpiredAuth</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain">   </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a sum type, and also an enumeration. The Scala compiler knows only two of these <code>UserServiceError</code> exist. If we don&#x27;t match on all of them, it is going to warn us. We can add the <code>-Xfatal-warnings</code> compiler option which treats warnings as errors. By turning on the fatal warning, we will have type-safety control on expected errors. So sealing these traits gives us great power.</p><p>Also extending all of our errors from a common supertype helps the ZIO&#x27;s combinators like flatMap to auto widen to the most specific error type.</p><p>Let&#x27;s say we have this for-comprehension here that calls the <code>userAuth</code> function, and it can fail with <code>ExpiredAuth</code>, and then we call <code>userProfile</code> that fails with <code>InvalidUserID</code>, and then we call <code>generateEmail</code> that can&#x27;t fail at all, and finally we call <code>sendEmail</code> which can fail with <code>EmailDeliveryError</code>. We have got a lot of different errors here:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">Exception</span><span class="token punctuation">,</span><span class="token plain"> Receipt</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    service </span><span class="token keyword">&lt;-</span><span class="token plain"> userAuth</span><span class="token punctuation">(</span><span class="token plain">token</span><span class="token punctuation">)</span><span class="token plain">                </span><span class="token comment">// IO[ExpiredAuth, UserService]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    profile </span><span class="token keyword">&lt;-</span><span class="token plain"> service</span><span class="token punctuation">.</span><span class="token plain">userProfile</span><span class="token punctuation">(</span><span class="token plain">userId</span><span class="token punctuation">)</span><span class="token plain">    </span><span class="token comment">// IO[InvalidUserId, Profile]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    body    </span><span class="token keyword">&lt;-</span><span class="token plain"> generateEmail</span><span class="token punctuation">(</span><span class="token plain">orderDetails</span><span class="token punctuation">)</span><span class="token plain">    </span><span class="token comment">// IO[Nothing, String]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    receipt </span><span class="token keyword">&lt;-</span><span class="token plain"> sendEmail</span><span class="token punctuation">(</span><span class="token string">&quot;Your order detail&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">       body</span><span class="token punctuation">,</span><span class="token plain"> profile</span><span class="token punctuation">.</span><span class="token plain">email</span><span class="token punctuation">)</span><span class="token plain">                   </span><span class="token comment">// IO[EmailDeliveryError, Unit]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> receipt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the flatMap operations auto widens the error type to the most specific error type possible. As a result, the inferred error type of this for-comprehension will be <code>Exception</code> which gives us the best information we could hope to get out of this. We have lost information about the particulars of this. We no longer know which of these error types it is. We know it is some type of <code>Exception</code> which is more information than nothing.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-union-types-to-be-more-specific-about-error-types">Use Union Types to Be More Specific About Error Types<a class="hash-link" href="#use-union-types-to-be-more-specific-about-error-types" title="Direct link to heading">​</a></h3><p>In Scala 3, we have an exciting new feature called union types. By using the union operator, we can encode multiple error types. Using this facility, we can have more precise information on typed errors.</p><p>Let&#x27;s see an example of <code>Storage</code> service which have <code>upload</code>, <code>download</code> and <code>delete</code> api:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">type</span><span class="token plain"> Name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">enum StorageError </span><span class="token keyword">extends</span><span class="token plain"> Exception </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> ObjectExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> Name</span><span class="token punctuation">)</span><span class="token plain">            </span><span class="token keyword">extends</span><span class="token plain"> StorageError</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> ObjectNotExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> Name</span><span class="token punctuation">)</span><span class="token plain">         </span><span class="token keyword">extends</span><span class="token plain"> StorageError</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> PermissionDenied</span><span class="token punctuation">(</span><span class="token plain">cause</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain">    </span><span class="token keyword">extends</span><span class="token plain"> StorageError</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> StorageLimitExceeded</span><span class="token punctuation">(</span><span class="token plain">limit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain">   </span><span class="token keyword">extends</span><span class="token plain"> StorageError</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> BandwidthLimitExceeded</span><span class="token punctuation">(</span><span class="token plain">limit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> StorageError</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> StorageError</span><span class="token punctuation">.</span><span class="token plain">*</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Storage </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> upload</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> Name</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      obj</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ObjectExist </span><span class="token operator">|</span><span class="token plain"> StorageLimitExceeded</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> download</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> Name</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ObjectNotExist </span><span class="token operator">|</span><span class="token plain"> BandwidthLimitExceeded</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> Name</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ObjectNotExist </span><span class="token operator">|</span><span class="token plain"> PermissionDenied</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Union types allow us to get rid of the requirement to extend some sort of common error types like <code>Exception</code> or <code>Throwable</code>. This allows us to have completely unrelated error types.</p><p>In the following example, the <code>FooError</code> and <code>BarError</code> are two distinct error. They have no super common type like <code>FooBarError</code> and also they are not extending <code>Exception</code> or <code>Throwable</code> classes:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token operator">*</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Two unrelated errors without having a common supertype</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> FooError</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> BarError</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">FooError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> FooError </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> bar</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">BarError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> BarError </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> FooError </span><span class="token operator">|</span><span class="token plain"> BarError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> foo</span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> bar</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dont-type-unexpected-errors">Don&#x27;t Type Unexpected Errors<a class="hash-link" href="#dont-type-unexpected-errors" title="Direct link to heading">​</a></h3><p>When we first discover typed errors, it may be tempting to put every error into the error type parameter. That is a mistake because we can&#x27;t recover from all types of errors. When we encounter unexpected errors we can&#x27;t do anything in those cases. We should let the application die. Let it crash is the erlang philosophy. It is a good philosophy for all unexpected errors. At best, we can sandbox it, but we should let it crash.</p><p>The context of a domain determines whether an error is expected or unexpected. When using typed errors, sometimes it is necessary to make a typed-error un-typed because in that case, we can&#x27;t handle the error, and we should let the application crash.</p><p>For example, in the following example, we don&#x27;t want to handle the <code>IOException</code> so we can call <code>ZIO#orDie</code> to make the effect&#x27;s failure unchecked. This will translate effect&#x27;s failure to the death of the fiber running it:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, IOException, Unit]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">orDie                          </span><span class="token comment">// ZIO[Any, Nothing, Unit]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we have an effect that fails for some <code>Throwable</code> we can pick certain recoverable errors out of that, and then we can just let the rest of them kill the fiber that is running that effect. The ZIO effect has a method called <code>ZIO#refineOrDie</code> that allows us to do that.</p><p>In the following example, calling <code>ZIO#refineOrDie</code> on an effect that has an error type <code>Throwable</code> allows us to refine it to have an error type of <code>TemporaryUnavailable</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> response</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Response</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      httpClient</span><span class="token punctuation">.</span><span class="token plain">fetchUrl</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, Throwable, Response]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">refineOrDie</span><span class="token punctuation">[</span><span class="token plain">TemporaryUnavailable</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> TemporaryUnavailable </span><span class="token keyword">=&gt;</span><span class="token plain"> e</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, TemporaryUnavailable, Response]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">retry</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Schedule</span><span class="token punctuation">.</span><span class="token plain">fibonacci</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// ZIO[Any, TemporaryUnavailable, Response]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">orDie </span><span class="token comment">// ZIO[Any, Nothing, Response]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we are importing the <code>fetchUrl</code> which is a blocking operation into a <code>ZIO</code> value. We know that in case of a service outage it will throw the <code>TemporaryUnavailable</code> exception. This is an expected error, so we want that to be typed. We are going to reflect that in the error type. We only expect it, so we know how to recover from it.</p><p>Also, this operation may throw unexpected errors like <code>OutOfMemoryError</code>, <code>StackOverflowError</code>, and so forth. Therefore, we don&#x27;t include these errors since we won&#x27;t be handling them at runtime. They are defects, and in case of unexpected errors, we should let the application crash.</p><p>Therefore, it is quite common to import a code that may throw exceptions, whether that uses expected errors for error handling or can fail for a wide variety of unexpected errors like disk unavailable, service unavailable, and so on. Generally, importing these operations end up represented as a <code>Task</code> (<code>ZIO[Any, Throwable, A]</code>). So in order to make recoverable errors typed, we use the <code>ZIO#refineOrDie</code> method.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dont-reflexively-log-errors">Don&#x27;t Reflexively Log Errors<a class="hash-link" href="#dont-reflexively-log-errors" title="Direct link to heading">​</a></h3><p>In modern async concurrent applications with a lot of subsystems, if we do not type errors, we are not able to see what section of our code fails with what error. Therefore, this can be very tempting to log errors when they happen. So when we lose type-safety in the whole application it makes us be more sensitive and program defensively. Therefore, whenever we are calling an API we tend to catch its errors, log them as below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">sealed</span><span class="token plain"> </span><span class="token keyword">trait</span><span class="token plain"> UploadError </span><span class="token keyword">extends</span><span class="token plain"> Exception</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> FileExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain">          </span><span class="token keyword">extends</span><span class="token plain"> UploadError</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> FileNotExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain">       </span><span class="token keyword">extends</span><span class="token plain"> UploadError</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> StorageLimitExceeded</span><span class="token punctuation">(</span><span class="token plain">limit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> UploadError</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">/**</span><br></span><span class="token-line"><span class="token comment"> * This API fail with `FileExist` failure when the provided file name exist.</span><br></span><span class="token-line"><span class="token comment"> */</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> upload</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">FileExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">StorageLimitExceeded</span><span class="token punctuation">(</span><span class="token plain">limit</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// This error is undocumented unintentionally</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">upload</span><span class="token punctuation">(</span><span class="token string">&quot;contacts.csv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> FileExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token string">&quot;contacts.csv&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> upload</span><span class="token punctuation">(</span><span class="token string">&quot;contacts.csv&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">.</span><span class="token plain">toString</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// logging the error</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// failing again (just like rethrowing exceptions in OOP)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above code when we see the <code>upload</code>&#x27;s return type we can&#x27;t find out what types of error it may fail with. So as a programmer we need to read the API documentation, and see in what cases it may fail. Due to the fact that the documents may be outdated and they may not provide all error cases, we tend to add another case to cover all the other errors. Expert developers may prefer to read the implementation to find out all expected errors, but it is a tedious task to do.</p><p>We don&#x27;t want to lose any errors. So if we do not use typed errors, it makes us defensive to log every error, regardless of whether they will occur or not.</p><p>When we are programming with typed errors, that allows us to never lose any errors. Even if we don&#x27;t handle all, the error channel of our effect type demonstrate the type of remaining errors:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> UploadError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  upload</span><span class="token punctuation">(</span><span class="token string">&quot;contacts.csv&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">catchSome </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> FileExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> upload</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is still going to be sent an unhandled error type as a result. Therefore, there is no way to lose any errors, and they propagate automatically through all the different subsystems in our application, which means we don&#x27;t have to be fearful anymore. It will be handled by higher-level code, or if it doesn&#x27;t it will be passed off to something that can.</p><p>If we handle all errors using <code>ZIO#catchAll</code> the type of error channel become <code>Nothing</code> which means there is no expected error remaining to handle:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  upload</span><span class="token punctuation">(</span><span class="token string">&quot;contacts.csv&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> FileExist</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">unit </span><span class="token comment">// handling FileExist error case</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> StorageLimitExceeded</span><span class="token punctuation">(</span><span class="token plain">limit</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">unit </span><span class="token comment">// handling StorageLimitExceeded error case</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we type errors, we know that they can&#x27;t be lost. So typed errors give us the ability to log less.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging">Debugging<a class="hash-link" href="#debugging" title="Direct link to heading">​</a></h2><p>When we are writing an application using the ZIO effect, we are writing workflows as data transformers. So there are lots of cases where we need to debug our application by seeing how the data transformed through the workflow. We can add or remove debugging capability without changing the signature of our effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">ifZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextIntBounded</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;random number&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;remainder&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  onTrue </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;Success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  onFalse </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;Failure&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">.</span><span class="token plain">repeatWhile</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token string">&quot;Success&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following could be one of the results of this program:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">random number: 5</span><br></span><span class="token-line"><span class="token plain">remainder: 1</span><br></span><span class="token-line"><span class="token plain">Failure</span><br></span><span class="token-line"><span class="token plain">random number: 1</span><br></span><span class="token-line"><span class="token plain">remainder: 1</span><br></span><span class="token-line"><span class="token plain">Failure</span><br></span><span class="token-line"><span class="token plain">random number: 2</span><br></span><span class="token-line"><span class="token plain">remainder: 0</span><br></span><span class="token-line"><span class="token plain">Success</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="logging">Logging<a class="hash-link" href="#logging" title="Direct link to heading">​</a></h2><p>ZIO has built-in logging functionality. This allows us to log within our application without adding new dependencies. ZIO logging doesn&#x27;t require any services from the environment.</p><p>We can easily log inside our application using the <code>ZIO.log</code> function:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;Application started!&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output would be something like this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token punctuation">[</span><span class="token plain">info</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">2021</span><span class="token plain">-10-06T07:23:29.974297029Z </span><span class="token assign-left variable">level</span><span class="token operator">=</span><span class="token plain">INFO </span><span class="token assign-left variable">thread</span><span class="token operator">=</span><span class="token comment">#2 message=&quot;Application started!&quot; file=ZIOLoggingExample.scala line=6 class=zio.examples.ZIOLoggingExample$ method=run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To log with a specific log-level, we can use the <code>ZIO.logLevel</code> combinator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">logLevel</span><span class="token punctuation">(</span><span class="token plain">LogLevel</span><span class="token punctuation">.</span><span class="token plain">Warning</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;The response time exceeded its threshold!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or we can use the following functions directly:</p><ul><li><code>ZIO.logDebug</code></li><li><code>ZIO.logError</code></li><li><code>ZIO.logFatal</code></li><li><code>ZIO.logInfo</code></li><li><code>ZIO.logWarning</code></li></ul><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">logError</span><span class="token punctuation">(</span><span class="token string">&quot;File does not exist: ~/var/www/favicon.ico&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It also supports logging spans:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">logSpan</span><span class="token punctuation">(</span><span class="token string">&quot;myspan&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;The job is finished!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Logging calculates and records the running duration of the span and includes that in logging data:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token punctuation">[</span><span class="token plain">info</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token assign-left variable">timestamp</span><span class="token operator">=</span><span class="token number">2021</span><span class="token plain">-10-06T07:29:57.816775631Z </span><span class="token assign-left variable">level</span><span class="token operator">=</span><span class="token plain">INFO </span><span class="token assign-left variable">thread</span><span class="token operator">=</span><span class="token comment">#2 message=&quot;The job is done!&quot; myspan=1013ms file=ZIOLoggingExample.scala line=8 class=zio.examples.ZIOLoggingExample$ method=run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">​</a></h2><p>Let&#x27;s write an application that takes numerator and denominator from the user and then print the result back to the user:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      a </span><span class="token keyword">&lt;-</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token string">&quot;Enter the first number  (a): &quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      b </span><span class="token keyword">&lt;-</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token string">&quot;Enter the second number (b): &quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      r </span><span class="token keyword">&lt;-</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;a / b: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">r</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">b </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">die</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ArithmeticException</span><span class="token punctuation">(</span><span class="token string">&quot;divide by zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// unexpected error</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">/</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s try to enter the zero for the second number and see what happens:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">Please enter the first number  </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">Please enter the second number </span><span class="token punctuation">(</span><span class="token plain">b</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">14</span><span class="token plain">T09</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">53.981143209</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token plain">&quot; java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">ArithmeticException</span><span class="token operator">:</span><span class="token plain"> divide by zero</span><br></span><span class="token-line"><span class="token plain">at MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$divide$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">ZIO$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$die$</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">3384</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">runUntil</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at zio</span><span class="token punctuation">.</span><span class="token plain">internal</span><span class="token punctuation">.</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">FiberContext</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">util</span><span class="token punctuation">.</span><span class="token plain">concurrent</span><span class="token punctuation">.</span><span class="token plain">ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token plain">runWorker</span><span class="token punctuation">(</span><span class="token plain">ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">1130</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">util</span><span class="token punctuation">.</span><span class="token plain">concurrent</span><span class="token punctuation">.</span><span class="token plain">ThreadPoolExecutor$Worker</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">630</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">Thread</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">Thread</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">831</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">divide</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As we see, because we entered the zero for the denominator, the <code>ArithmeticException</code> defect, makes the application crash.</p><p>Defects are any <em>unexpected errors</em> that we are not going to handle. They will propagate through our application stack until they crash the whole.</p><p>Defects have many roots, most of them are from a programming error. Errors will happen when we haven&#x27;t written the application with best practices. For example, one of these practices is that we should validate the inputs before providing them to the <code>divide</code> function. So if the user entered the zero as the denominator, we can retry and ask the user to return another number:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      a </span><span class="token keyword">&lt;-</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token string">&quot;Enter the first number  (a): &quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      b </span><span class="token keyword">&lt;-</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token string">&quot;Enter the second number (b): &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeatUntil</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      r </span><span class="token keyword">&lt;-</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;a / b: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">r</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">/</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another note about defects is that they are invisible, and they are not typed. We cannot expect what defects will happen by observing the typed error channel. In the above example, when we run the application and enter noninteger input, another defect, which is called <code>NumberFormatException</code> will crash the application:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">Enter the first number  </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> five</span><br></span><span class="token-line"><span class="token plain">timestamp</span><span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">18</span><span class="token plain">T06</span><span class="token operator">:</span><span class="token number">36</span><span class="token operator">:</span><span class="token number">25.984665171</span><span class="token plain">Z level</span><span class="token operator">=</span><span class="token plain">ERROR thread</span><span class="token operator">=</span><span class="token plain">#zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">0</span><span class="token plain"> message</span><span class="token operator">=</span><span class="token string">&quot;Exception in thread &quot;</span><span class="token plain">zio</span><span class="token operator">-</span><span class="token plain">fiber</span><span class="token operator">-</span><span class="token number">2</span><span class="token string">&quot; java.lang.NumberFormatException: For input string: &quot;</span><span class="token plain">five&quot;</span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">NumberFormatException</span><span class="token punctuation">.</span><span class="token plain">forInputString</span><span class="token punctuation">(</span><span class="token plain">NumberFormatException</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">parseInt</span><span class="token punctuation">(</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">660</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at java</span><span class="token punctuation">.</span><span class="token plain">base</span><span class="token operator">/</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">parseInt</span><span class="token punctuation">(</span><span class="token plain">Integer</span><span class="token punctuation">.</span><span class="token plain">java</span><span class="token operator">:</span><span class="token number">778</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at scala</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">StringOps$</span><span class="token punctuation">.</span><span class="token plain">toInt$extension</span><span class="token punctuation">(</span><span class="token plain">StringOps</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">910</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$readNumber$</span><span class="token number">3</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at MainApp$</span><span class="token punctuation">.</span><span class="token plain">$anonfun$readNumber$</span><span class="token number">3</span><span class="token plain">$adapted</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    at </span><span class="token generics punctuation">&lt;</span><span class="token generics">empty</span><span class="token generics punctuation">&gt;</span><span class="token punctuation">.</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">MainApp</span><span class="token punctuation">.</span><span class="token plain">scala</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The cause of this defect is also a programming error, which means we haven&#x27;t validated input when parsing it. So let&#x27;s try to validate the input, and make sure that it is a number. We know that if the entered input does not contain a parsable <code>Int</code> the <code>String#toInt</code> throws the <code>NumberFormatException</code> exception. As we want this exception to be typed, we import the <code>String#toInt</code> function using the <code>ZIO.attempt</code> constructor. Using this constructor the function signature would be as follows:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInput</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since the <code>NumberFormatException</code> is an expected error, and we want to handle it. So we type the error channel as <code>NumberFormatException</code>.</p><p>To be more specific, we would like to narrow down the error channel to the <code>NumberFormatException</code>, so we can use the <code>refineToOrDie</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInput</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain">                 </span><span class="token comment">// ZIO[Any, Throwable, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token plain">  </span><span class="token comment">// ZIO[Any, NumberFormatException, Int]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The same result can be achieved by succeeding the <code>String#toInt</code> and then widening the error channel using the <code>ZIO#unrefineTo</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInput</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain">                 </span><span class="token comment">// ZIO[Any, Nothing, Int]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">unrefineTo</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token plain">     </span><span class="token comment">// ZIO[Any, NumberFormatException, Int]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, let&#x27;s refactor the example with recent changes:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      a </span><span class="token keyword">&lt;-</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token string">&quot;Enter the first number  (a): &quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      b </span><span class="token keyword">&lt;-</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token string">&quot;Enter the second number (b): &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeatUntil</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      r </span><span class="token keyword">&lt;-</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;a / b: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">r</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> parseInput</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> readNumber</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">parseInput</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">retryUntil</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">isInstanceOf</span><span class="token punctuation">[</span><span class="token plain">NumberFormatException</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> divide</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">/</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/references/core/zio/error-management.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/references/core/zio/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ZIO</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/references/core/zio/uio"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">UIO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#three-types-of-errors-in-zio" class="table-of-contents__link toc-highlight">Three Types of Errors in ZIO</a><ul><li><a href="#1-failures" class="table-of-contents__link toc-highlight">1. Failures</a></li><li><a href="#2-defects" class="table-of-contents__link toc-highlight">2. Defects</a></li><li><a href="#3-fatal-errors" class="table-of-contents__link toc-highlight">3. Fatal Errors</a></li></ul></li><li><a href="#imperative-vs-functional-error-handling" class="table-of-contents__link toc-highlight">Imperative vs. Functional Error Handling</a></li><li><a href="#expected-and-unexpected-errors" class="table-of-contents__link toc-highlight">Expected and Unexpected Errors</a></li><li><a href="#exceptional-and-unexceptional-effects" class="table-of-contents__link toc-highlight">Exceptional and Unexceptional Effects</a></li><li><a href="#typed-errors-dont-guarantee-the-absence-of-defects-and-interruptions" class="table-of-contents__link toc-highlight">Typed Errors Don&#39;t Guarantee the Absence of Defects and Interruptions</a></li><li><a href="#sequential-and-parallel-errors" class="table-of-contents__link toc-highlight">Sequential and Parallel Errors</a></li><li><a href="#recovering-from-errors" class="table-of-contents__link toc-highlight">Recovering From Errors</a><ul><li><a href="#1-catching" class="table-of-contents__link toc-highlight">1. Catching</a></li><li><a href="#2-fallback" class="table-of-contents__link toc-highlight">2. Fallback</a></li><li><a href="#3-folding" class="table-of-contents__link toc-highlight">3. Folding</a></li><li><a href="#4-retrying" class="table-of-contents__link toc-highlight">4. Retrying</a></li><li><a href="#5-timing-out" class="table-of-contents__link toc-highlight">5. Timing out</a></li><li><a href="#6-sandboxing" class="table-of-contents__link toc-highlight">6. Sandboxing</a></li></ul></li><li><a href="#error-accumulation" class="table-of-contents__link toc-highlight">Error Accumulation</a><ul><li><a href="#ziovalidate" class="table-of-contents__link toc-highlight"><code>ZIO#validate</code></a></li><li><a href="#ziovalidate-1" class="table-of-contents__link toc-highlight"><code>ZIO.validate</code></a></li><li><a href="#ziovalidatefirst" class="table-of-contents__link toc-highlight"><code>ZIO.validateFirst</code></a></li><li><a href="#ziopartition" class="table-of-contents__link toc-highlight"><code>ZIO.partition</code></a></li></ul></li><li><a href="#error-channel-operations" class="table-of-contents__link toc-highlight">Error Channel Operations</a><ul><li><a href="#map-and-flatmap-on-the-error-channel" class="table-of-contents__link toc-highlight">Map and FlatMap on the Error Channel</a></li><li><a href="#filtering-the-success-channel-values" class="table-of-contents__link toc-highlight">Filtering the Success Channel Values</a></li><li><a href="#tapping-errors" class="table-of-contents__link toc-highlight">Tapping Errors</a></li><li><a href="#putting-errors-into-success-channel-and-submerging-them-back-again" class="table-of-contents__link toc-highlight">Putting Errors Into Success Channel and Submerging Them Back Again</a></li><li><a href="#converting-defects-to-failures" class="table-of-contents__link toc-highlight">Converting Defects to Failures</a></li><li><a href="#error-refinement" class="table-of-contents__link toc-highlight">Error Refinement</a></li><li><a href="#converting-option-on-values-to-option-on-errors-and-vice-versa" class="table-of-contents__link toc-highlight">Converting Option on Values to Option on Errors and Vice Versa</a></li><li><a href="#flattening-optional-error-types" class="table-of-contents__link toc-highlight">Flattening Optional Error Types</a></li><li><a href="#merging-the-error-channel-into-the-success-channel" class="table-of-contents__link toc-highlight">Merging the Error Channel into the Success Channel</a></li><li><a href="#flipping-the-error-and-success-channels" class="table-of-contents__link toc-highlight">Flipping the Error and Success Channels</a></li><li><a href="#rejecting-some-success-values" class="table-of-contents__link toc-highlight">Rejecting Some Success Values</a></li><li><a href="#zoom-inout-on-left-or-right-side-of-an-either-value" class="table-of-contents__link toc-highlight">Zoom in/out on Left or Right Side of An Either Value</a></li><li><a href="#converting-optional-values-to-optional-errors-and-vice-versa" class="table-of-contents__link toc-highlight">Converting Optional Values to Optional Errors and Vice Versa</a></li><li><a href="#uncovering-the-underlying-cause-of-an-effect" class="table-of-contents__link toc-highlight">Uncovering the Underlying Cause of an Effect</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#model-domain-errors-using-algebraic-data-types" class="table-of-contents__link toc-highlight">Model Domain Errors Using Algebraic Data Types</a></li><li><a href="#use-union-types-to-be-more-specific-about-error-types" class="table-of-contents__link toc-highlight">Use Union Types to Be More Specific About Error Types</a></li><li><a href="#dont-type-unexpected-errors" class="table-of-contents__link toc-highlight">Don&#39;t Type Unexpected Errors</a></li><li><a href="#dont-reflexively-log-errors" class="table-of-contents__link toc-highlight">Don&#39;t Reflexively Log Errors</a></li></ul></li><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4c8d210b.js"></script>
<script src="/assets/js/main.b0e6b04a.js"></script>
</body>
</html>