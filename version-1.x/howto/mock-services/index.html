<!doctype html>
<html class="docs-version-1.x" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-react-helmet="true">How to Mock Services? | ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zio.dev/version-1.x/howto/mock-services"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="1.x"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-1.x"><meta data-react-helmet="true" property="og:title" content="How to Mock Services? | ZIO"><meta data-react-helmet="true" name="description" content="How to test interactions between services?"><meta data-react-helmet="true" property="og:description" content="How to test interactions between services?"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://zio.dev/version-1.x/howto/mock-services"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/version-1.x/howto/mock-services" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/version-1.x/howto/mock-services" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.f4d50625.css">
<link rel="preload" href="/assets/js/runtime~main.2ca2038d.js" as="script">
<link rel="preload" href="/assets/js/main.d278da23.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_TMUO themedImage--dark_uzRr"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/version-1.x/overview/overview_index">Overview</a><a class="navbar__item navbar__link" href="/version-1.x/datatypes/index">Data Types</a><a class="navbar__item navbar__link" href="/version-1.x/usecases/usecases_index">Use Cases</a><a class="navbar__item navbar__link" href="/version-1.x/howto/index">How to</a><a class="navbar__item navbar__link" href="/version-1.x/resources/index">Resources</a><a class="navbar__item navbar__link" href="/version-1.x/about/about_index">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/version-1.x/overview/overview_index">ZIO 1.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/next/howto/mock-services">ZIO 2.x (WIP)</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/version-1.x/howto/mock-services">ZIO 1.x</a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">How to</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/version-1.x/howto/use-test-assertions">How to Use Test Assertions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/version-1.x/howto/test-effects">How to Test effects?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/version-1.x/howto/mock-services">How to Mock Services?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/version-1.x/howto/handle-errors">How to Handle Errors?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/version-1.x/howto/access-system-information">How to Access System Information?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/version-1.x/howto/use-zio-macros">How to use ZIO Macros?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Interop</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Migrate</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->ZIO 1.x</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to Mock Services?</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-test-interactions-between-services">How to test interactions between services?<a aria-hidden="true" class="hash-link" href="#how-to-test-interactions-between-services" title="Direct link to heading">â€‹</a></h2><p>Whenever possible, we should strive to make our functions pure, which makes testing such function easy - you just need to assert on the return value.
However in larger applications there is a need for intermediate layers that delegate the work to specialized services.</p><p>For example, in a HTTP server the first layer of indirection are so called <em>routes</em>, whose job is to match the request and delegate the processing to
downstream layers. Often below there is a second layer of indirection, so called <em>controllers</em>, which consist of several business logic units grouped
by their domain. In a RESTful API that would be all operations on a certain model. The <em>controller</em> to perform its job might call on further
specialized services for communicating with the database, sending email, logging, et cetera.</p><p>If the job of the <em>capability</em> is to call on another <em>capability</em>, how should we test it?</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="hidden-outputs">Hidden outputs<a aria-hidden="true" class="hash-link" href="#hidden-outputs" title="Direct link to heading">â€‹</a></h2><p>A pure function is such a function which operates only on its inputs and produces only its output. Command-like methods, by definition are impure, as
their job is to change state of the collaborating object (performing a <em>side effect</em>). For example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import scala.concurrent.Future</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def processEvent(event: Event): Future[Unit] = Future(println(s&quot;Got $event&quot;))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The signature of this method <code>Event =&gt; Future[Unit]</code> hints us we&#x27;re dealing with a command. It returns <code>Unit</code> (well, wrapped in future, but it does
not matter here), you can&#x27;t do anything useful with <code>Unit</code> and it does not contain any information. It is the equivalent of returning nothing. It is
also an unreliable return type, as when Scala expects the return type to be <code>Unit</code> it will discard whatever value it had (for details see
<a href="https://scala-lang.org/files/archive/spec/2.13/06-expressions.html#value-conversions" target="_blank" rel="noopener noreferrer">Section 6.26.1</a> of the Scala Language Specification), which may shadow the fact that the final value produced (and discarded) was
not the one you expected.</p><p>Inside the future there may be happening any side effects. It may open a file, print to console, connect to databases. We simply don&#x27;t know. Let&#x27;s have a look how this problem would be solved using ZIO&#x27;s effect system:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.console.Console</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def processEvent(event: Event): URIO[Console, Unit] =</span><br></span><span class="token-line"><span class="token plain">  console.putStrLn(s&quot;Got $event&quot;).orDie</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>With ZIO, we&#x27;ve regained to ability to reason about the effects called. We know that <code>processEvent</code> can only call on <em>capabilities</em> of <code>Console</code>, so even though we still have <code>Unit</code> as the result, we have narrowed the possible effects space to a few.</p><blockquote><p><strong>Note:</strong> this is true assuming the programmer disciplines themselves to only perform effects expressed in the type signature.
There is no way (at the moment) to enforce this by the compiler. There is some research done in this space, perhaps future programming languages
will enable us to further constrain side effects.</p></blockquote><p>However, the same method could be implemented as:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">def processEvent2(event: Event): URIO[Console, Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.unit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>How can we test it did exactly what we expected it to do?</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mocking">Mocking<a aria-hidden="true" class="hash-link" href="#mocking" title="Direct link to heading">â€‹</a></h2><p>In this sort of situations we need mock implementations of our collaborator service. As <em>Martin Fowler</em> puts it in his excellent article
<a href="https://martinfowler.com/articles/mocksArentStubs.html" target="_blank" rel="noopener noreferrer">Mocks Aren&#x27;t Stubs</a>:</p><blockquote><p><strong>Mocks</strong> are (...) objects pre-programmed with expectations which form a specification of the calls they are expected to receive.</p></blockquote><p>ZIO Test provides a framework for mocking your modules.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="creating-a-mock-service">Creating a mock service<a aria-hidden="true" class="hash-link" href="#creating-a-mock-service" title="Direct link to heading">â€‹</a></h2><p>We&#x27;ll be assuming you&#x27;ve read about modules and layers in the <a href="/version-1.x/datatypes/contextual/index">contextual types</a> guide. In the main sources we define the <em>service</em>, a module alias and <em>capability accessors</em>. In test sources we&#x27;re defining the <em>mock object</em> which extends <code>zio.test.mock.Mock</code> which holds <em>capability tags</em> and <em>compose layer</em>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// main sources</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import zio.stream.{ ZSink, ZStream }</span><br></span><span class="token-line"><span class="token plain">import zio.test.mock._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">type Example = Has[Example.Service]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object Example {</span><br></span><span class="token-line"><span class="token plain">  trait Service {</span><br></span><span class="token-line"><span class="token plain">    val static                                 : UIO[String]</span><br></span><span class="token-line"><span class="token plain">    def zeroArgs                               : UIO[Int]</span><br></span><span class="token-line"><span class="token plain">    def zeroArgsWithParens()                   : UIO[Long]</span><br></span><span class="token-line"><span class="token plain">    def singleArg(arg1: Int)                   : UIO[String]</span><br></span><span class="token-line"><span class="token plain">    def multiArgs(arg1: Int, arg2: Long)       : UIO[String]</span><br></span><span class="token-line"><span class="token plain">    def multiParamLists(arg1: Int)(arg2: Long) : UIO[String]</span><br></span><span class="token-line"><span class="token plain">    def command(arg1: Int)                     : UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">    def overloaded(arg1: Int)                  : UIO[String]</span><br></span><span class="token-line"><span class="token plain">    def overloaded(arg1: Long)                 : UIO[String]</span><br></span><span class="token-line"><span class="token plain">    def function(arg1: Int)                    : String</span><br></span><span class="token-line"><span class="token plain">    def sink(a: Int)                           : ZSink[Any, String, Int, Int, List[Int]]</span><br></span><span class="token-line"><span class="token plain">    def stream(a: Int)                         : ZStream[Any, String, Int]</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// test sources</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ExampleMock extends Mock[Example] {</span><br></span><span class="token-line"><span class="token plain">  object Static             extends Effect[Unit, Nothing, String]</span><br></span><span class="token-line"><span class="token plain">  object ZeroArgs           extends Effect[Unit, Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">  object ZeroArgsWithParens extends Effect[Unit, Nothing, Long]</span><br></span><span class="token-line"><span class="token plain">  object SingleArg          extends Effect[Int, Nothing, String]</span><br></span><span class="token-line"><span class="token plain">  object MultiArgs          extends Effect[(Int, Long), Nothing, String]</span><br></span><span class="token-line"><span class="token plain">  object MultiParamLists    extends Effect[(Int, Long), Nothing, String]</span><br></span><span class="token-line"><span class="token plain">  object Command            extends Effect[Int, Nothing, Unit]</span><br></span><span class="token-line"><span class="token plain">  object Overloaded {</span><br></span><span class="token-line"><span class="token plain">    object _0 extends Effect[Int, Nothing, String]</span><br></span><span class="token-line"><span class="token plain">    object _1 extends Effect[Long, Nothing, String]</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">  object Function extends Method[Int, Throwable, String]</span><br></span><span class="token-line"><span class="token plain">  object Sink     extends Sink[Any, String, Int, Int, List[Int]]</span><br></span><span class="token-line"><span class="token plain">  object Stream   extends Stream[Any, String, Int]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val compose: URLayer[Has[Proxy], Example] = ???</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A <em>capability tag</em> is just a value which extends the <code>zio.test.mock.Capability[R &lt;: Has[_], I, E, A]</code> type constructor, where:</p><ul><li><code>R</code> is the type of environment the method belongs to</li><li><code>I</code> is the type of methods input arguments</li><li><code>E</code> is the type of error it can fail with</li><li><code>A</code> is the type of return value it can produce</li></ul><p>The <code>Capability</code> type is not publicly available, instead you have to extend <code>Mock</code> dependent types <code>Effect</code>, <code>Method</code>, <code>Sink</code> or <code>Stream</code>.</p><p>We model input arguments according to following scheme:</p><ul><li>for zero arguments the type is <code>Unit</code></li><li>for one or more arguments, regardless in how many parameter lists, the type is a <code>TupleN</code> where <code>N</code> is the size of arguments list</li></ul><blockquote><p><strong>Note:</strong> we&#x27;re using tuples to represent multiple argument methods, which follows with a limit to max 22 arguments, as is Scala itself limited.</p></blockquote><p>For overloaded methods we nest a list of numbered objects, each representing subsequent overloads.</p><p>Finally we need to define a <em>compose layer</em> that can create our environment from a <code>Proxy</code>.
A <code>Proxy</code> holds the mock state and serves predefined responses to calls.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import ExampleMock._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val compose: URLayer[Has[Proxy], Example] =</span><br></span><span class="token-line"><span class="token plain">  ZLayer.fromServiceM { proxy =&gt;</span><br></span><span class="token-line"><span class="token plain">    withRuntime.map { rts =&gt;</span><br></span><span class="token-line"><span class="token plain">      new Example.Service {</span><br></span><span class="token-line"><span class="token plain">        val static                                 = proxy(Static)</span><br></span><span class="token-line"><span class="token plain">        def zeroArgs                               = proxy(ZeroArgs)</span><br></span><span class="token-line"><span class="token plain">        def zeroArgsWithParens()                   = proxy(ZeroArgsWithParens)</span><br></span><span class="token-line"><span class="token plain">        def singleArg(arg1: Int)                   = proxy(SingleArg, arg1)</span><br></span><span class="token-line"><span class="token plain">        def multiArgs(arg1: Int, arg2: Long)       = proxy(MultiArgs, arg1, arg2)</span><br></span><span class="token-line"><span class="token plain">        def multiParamLists(arg1: Int)(arg2: Long) = proxy(MultiParamLists, arg1, arg2)</span><br></span><span class="token-line"><span class="token plain">        def command(arg1: Int)                     = proxy(Command, arg1)</span><br></span><span class="token-line"><span class="token plain">        def overloaded(arg1: Int)                  = proxy(Overloaded._0, arg1)</span><br></span><span class="token-line"><span class="token plain">        def overloaded(arg1: Long)                 = proxy(Overloaded._1, arg1)</span><br></span><span class="token-line"><span class="token plain">        def function(arg1: Int)                    = rts.unsafeRunTask(proxy(Function, arg1))</span><br></span><span class="token-line"><span class="token plain">        def sink(a: Int)                           = rts.unsafeRun(proxy(Sink, a).catchAll(error =&gt; UIO(ZSink.fail[String, Int](error))))</span><br></span><span class="token-line"><span class="token plain">        def stream(a: Int)                         = rts.unsafeRun(proxy(Stream, a))</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong> The <code>withRuntime</code> helper is defined in <code>Mock</code>. It accesses the Runtime via <code>ZIO.runtime</code> and if you&#x27;re on JS platform, it will replace the executor to an unyielding one.</p></blockquote><p>A reference to this layer is passed to <em>capability tags</em> so it can be used to automatically build environment for composed expectations on
multiple services.</p><blockquote><p><strong>Note:</strong> for non-effectful capabilities you need to unsafely run the final effect to satisfy the required interface. For <code>ZSink</code> you also need to map the error into a failed sink as demonstrated above.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="complete-example">Complete example<a aria-hidden="true" class="hash-link" href="#complete-example" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// main sources</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.console.Console</span><br></span><span class="token-line"><span class="token plain">import zio.test.mock._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">type AccountObserver = Has[AccountObserver.Service]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object AccountObserver {</span><br></span><span class="token-line"><span class="token plain">  trait Service {</span><br></span><span class="token-line"><span class="token plain">    def processEvent(event: AccountEvent): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">    def runCommand(): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def processEvent(event: AccountEvent) =</span><br></span><span class="token-line"><span class="token plain">    ZIO.accessM[AccountObserver](_.get.processEvent(event))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def runCommand() =</span><br></span><span class="token-line"><span class="token plain">    ZIO.accessM[AccountObserver](_.get.runCommand)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val live: ZLayer[Console, Nothing, AccountObserver] =</span><br></span><span class="token-line"><span class="token plain">    ZLayer.fromService[Console.Service, Service] { console =&gt;</span><br></span><span class="token-line"><span class="token plain">      new Service {</span><br></span><span class="token-line"><span class="token plain">        def processEvent(event: AccountEvent): UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">          for {</span><br></span><span class="token-line"><span class="token plain">            _    &lt;- console.putStrLn(s&quot;Got $event&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">            line &lt;- console.getStrLn.orDie</span><br></span><span class="token-line"><span class="token plain">            _    &lt;- console.putStrLn(s&quot;You entered: $line&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">          } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">        def runCommand(): UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">          console.putStrLn(&quot;Done!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// test sources</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object AccountObserverMock extends Mock[AccountObserver] {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  object ProcessEvent extends Effect[AccountEvent, Nothing, Unit]</span><br></span><span class="token-line"><span class="token plain">  object RunCommand   extends Effect[Unit, Nothing, Unit]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val compose: URLayer[Has[Proxy], AccountObserver] =</span><br></span><span class="token-line"><span class="token plain">    ZLayer.fromService { proxy =&gt;</span><br></span><span class="token-line"><span class="token plain">      new AccountObserver.Service {</span><br></span><span class="token-line"><span class="token plain">        def processEvent(event: AccountEvent) = proxy(ProcessEvent, event)</span><br></span><span class="token-line"><span class="token plain">        def runCommand(): UIO[Unit]           = proxy(RunCommand)</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong> ZIO provides some useful macros to help you generate repetitive code, see <a href="/version-1.x/howto/use-zio-macros">Scrapping the boilerplate with macros</a>.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="provided-zio-services">Provided ZIO services<a aria-hidden="true" class="hash-link" href="#provided-zio-services" title="Direct link to heading">â€‹</a></h2><p>For each built-in ZIO service you will find their mockable counterparts in <code>zio.test.mock</code> package:</p><ul><li><code>MockClock</code> for <code>zio.clock.Clock</code></li><li><code>MockConsole</code> for <code>zio.console.Console</code></li><li><code>MockRandom</code> for <code>zio.random.Random</code></li><li><code>MockSystem</code> for <code>zio.system.System</code></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="setting-up-expectations">Setting up expectations<a aria-hidden="true" class="hash-link" href="#setting-up-expectations" title="Direct link to heading">â€‹</a></h2><p>To create expectations we use the previously defined <em>capability tags</em>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.test.Assertion._</span><br></span><span class="token-line"><span class="token plain">import zio.test.mock.Expectation._</span><br></span><span class="token-line"><span class="token plain">import zio.test.mock.MockSystem</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val exp01 = ExampleMock.SingleArg( // capability to build an expectation for</span><br></span><span class="token-line"><span class="token plain">  equalTo(42), // assertion of the expected input argument</span><br></span><span class="token-line"><span class="token plain">  value(&quot;bar&quot;) // result, that will be returned</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For methods that take input, the first argument will be an assertion on input, and the second the predefined result.</p><p>In the most robust example, the result can be either a successful value or a failure. To construct either we must use
one of following combinators from <code>zio.test.mock.Expectation</code> companion object:</p><ul><li><code>failure[E](failure: E)</code> Expectation result failing with <code>E</code></li><li><code>failureF[I, E](f: I =&gt; E)</code> Maps the input arguments <code>I</code> to expectation result failing with <code>E</code>.</li><li><code>failureM[I, E](f: I =&gt; IO[E, Nothing])</code> Effectfully maps the input arguments <code>I</code> to expectation result failing with <code>E</code>.</li><li><code>never</code> Expectation result computing forever.</li><li><code>unit</code> Expectation result succeeding with <code>Unit</code>.</li><li><code>value[A](value: A)</code> Expectation result succeeding with <code>A</code>.</li><li><code>valueF[I, A](f: I =&gt; A)</code> Maps the input arguments <code>I</code> to expectation result succeeding with <code>A</code>.</li><li><code>valueM[I, A](f: I =&gt; IO[Nothing, A])</code> Effectfully maps the input arguments <code>I</code> expectation result succeeding with <code>A</code>.</li></ul><p>For methods that take no input, we only define the expected output.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val exp02 = ExampleMock.ZeroArgs(value(42))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For methods that may return <code>Unit</code>, we may skip the predefined result (it will default to successful value) or use <code>unit</code> helper.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.test.mock.MockConsole</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val exp03 = MockConsole.PutStrLn(equalTo(&quot;Welcome to ZIO!&quot;))</span><br></span><span class="token-line"><span class="token plain">val exp04 = MockConsole.PutStrLn(equalTo(&quot;Welcome to ZIO!&quot;), unit)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For methods that may return <code>Unit</code> and take no input we can skip both:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val exp05 = AccountObserverMock.RunCommand()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Finally we&#x27;re all set and can create ad-hoc mock environments with our services.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.test._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val event = new AccountEvent {}</span><br></span><span class="token-line"><span class="token plain">val app: URIO[AccountObserver, Unit] = AccountObserver.processEvent(event)</span><br></span><span class="token-line"><span class="token plain">val mockEnv: ULayer[Console] = (</span><br></span><span class="token-line"><span class="token plain">  MockConsole.PutStrLn(equalTo(s&quot;Got $event&quot;), unit) ++</span><br></span><span class="token-line"><span class="token plain">  MockConsole.GetStrLn(value(&quot;42&quot;)) ++</span><br></span><span class="token-line"><span class="token plain">  MockConsole.PutStrLn(equalTo(&quot;You entered: 42&quot;))</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can combine our expectation to build complex scenarios using combinators defined in <code>zio.test.mock.Expectation</code>:</p><ul><li><code>andThen</code> (alias <code>++</code>) Compose two expectations, producing a new expectation to <strong>satisfy both sequentially</strong>.</li><li><code>and</code> (alias <code>&amp;&amp;</code>) Compose two expectations, producing a new expectation to <strong>satisfy both in any order</strong>.</li><li><code>or</code> (alias <code>||</code>) Compose two expectations, producing a new expectation to <strong>satisfy only one of them</strong>.</li><li><code>repeated</code> Repeat expectation within given bounds, produces a new expectation to <strong>satisfy itself sequentially given number of times</strong>.</li><li><code>atLeast</code> Lower-bounded variant of <code>repeated</code>, produces a new expectation to satisfy <strong>itself sequentially at least given number of times</strong>.</li><li><code>atMost</code> Upper-bounded variant of <code>repeated</code>, produces a new expectation to satisfy <strong>itself sequentially at most given number of times</strong>.</li><li><code>optional</code> Alias for <code>atMost(1)</code>, produces a new expectation to satisfy <strong>itself at most once</strong>.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="providing-mocked-environment">Providing mocked environment<a aria-hidden="true" class="hash-link" href="#providing-mocked-environment" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">object AccountObserverSpec extends DefaultRunnableSpec {</span><br></span><span class="token-line"><span class="token plain">  def spec = suite(&quot;processEvent&quot;)(</span><br></span><span class="token-line"><span class="token plain">    testM(&quot;calls putStrLn &gt; getStrLn &gt; putStrLn and returns unit&quot;) {</span><br></span><span class="token-line"><span class="token plain">      val result = app.provideLayer(mockEnv &gt;&gt;&gt; AccountObserver.live)</span><br></span><span class="token-line"><span class="token plain">      assertM(result)(isUnit)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mocking-unused-collaborators">Mocking unused collaborators<a aria-hidden="true" class="hash-link" href="#mocking-unused-collaborators" title="Direct link to heading">â€‹</a></h2><p>Often the dependency on a collaborator is only in some branches of the code. To test the correct behaviour of branches without depedencies, we still have to provide it to the environment, but we would like to assert it was never called. With the <code>Mock.empty</code> method you can obtain a <code>ZLayer</code> with an empty service (no calls expected).</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">object MaybeConsoleSpec extends DefaultRunnableSpec {</span><br></span><span class="token-line"><span class="token plain">  def spec = suite(&quot;processEvent&quot;)(</span><br></span><span class="token-line"><span class="token plain">    testM(&quot;expect no call&quot;) {</span><br></span><span class="token-line"><span class="token plain">      def maybeConsole(invokeConsole: Boolean) =</span><br></span><span class="token-line"><span class="token plain">        ZIO.when(invokeConsole)(console.putStrLn(&quot;foo&quot;))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">      val maybeTest1 = maybeConsole(false).provideLayer(MockConsole.empty)</span><br></span><span class="token-line"><span class="token plain">      val maybeTest2 = maybeConsole(true).provideLayer(MockConsole.PutStrLn(equalTo(&quot;foo&quot;)))</span><br></span><span class="token-line"><span class="token plain">      assertM(maybeTest1)(isUnit) *&gt; assertM(maybeTest2)(isUnit)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mocking-multiple-collaborators">Mocking multiple collaborators<a aria-hidden="true" class="hash-link" href="#mocking-multiple-collaborators" title="Direct link to heading">â€‹</a></h2><p>In some cases we have more than one collaborating service being called. You can create mocks for rich environments and as you enrich the environment by using <em>capability tags</em> from another service, the underlaying mocked layer will be updated.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.console.Console</span><br></span><span class="token-line"><span class="token plain">import zio.random.Random</span><br></span><span class="token-line"><span class="token plain">import zio.test.mock.MockRandom</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val combinedEnv: ULayer[Console with Random] = (</span><br></span><span class="token-line"><span class="token plain">  MockConsole.PutStrLn(equalTo(&quot;What is your name?&quot;)) ++</span><br></span><span class="token-line"><span class="token plain">  MockConsole.GetStrLn(value(&quot;Mike&quot;)) ++</span><br></span><span class="token-line"><span class="token plain">  MockRandom.NextInt(value(42)) ++</span><br></span><span class="token-line"><span class="token plain">  MockConsole.PutStrLn(equalTo(&quot;Mike, your lucky number today is 42!&quot;))</span><br></span><span class="token-line"><span class="token plain">)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val combinedApp =</span><br></span><span class="token-line"><span class="token plain">  for {</span><br></span><span class="token-line"><span class="token plain">    _    &lt;- console.putStrLn(&quot;What is your name?&quot;)</span><br></span><span class="token-line"><span class="token plain">    name &lt;- console.getStrLn.orDie</span><br></span><span class="token-line"><span class="token plain">    num  &lt;- random.nextInt</span><br></span><span class="token-line"><span class="token plain">    _    &lt;- console.putStrLn(s&quot;$name, your lucky number today is $num!&quot;)</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val result = combinedApp.provideLayer(combinedEnv)</span><br></span><span class="token-line"><span class="token plain">assertM(result)(isUnit)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="polymorphic-capabilities">Polymorphic capabilities<a aria-hidden="true" class="hash-link" href="#polymorphic-capabilities" title="Direct link to heading">â€‹</a></h2><p>Mocking polymorphic methods is also supported, but the interface must require <code>zio.Tag</code> implicit evidence for each type parameter.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// main sources</span><br></span><span class="token-line"><span class="token plain">type PolyExample = Has[PolyExample.Service]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object PolyExample {</span><br></span><span class="token-line"><span class="token plain">  trait Service {</span><br></span><span class="token-line"><span class="token plain">    def polyInput[I: Tag](input: I): Task[String]</span><br></span><span class="token-line"><span class="token plain">    def polyError[E: Tag](input: Int): IO[E, String]</span><br></span><span class="token-line"><span class="token plain">    def polyOutput[A: Tag](input: Int): Task[A]</span><br></span><span class="token-line"><span class="token plain">    def polyAll[I: Tag, E: Tag, A: Tag](input: I): IO[E, A]</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the test sources we construct partially applied <em>capability tags</em> by extending <code>Method.Poly</code> family. The unknown types
must be provided at call site. To produce a final monomorphic <code>Method</code> tag we must use the <code>of</code> combinator and pass the
missing types.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// test sources</span><br></span><span class="token-line"><span class="token plain">object PolyExampleMock extends Mock[PolyExample] {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  object PolyInput  extends Poly.Effect.Input[Throwable, String]</span><br></span><span class="token-line"><span class="token plain">  object PolyError  extends Poly.Effect.Error[Int, String]</span><br></span><span class="token-line"><span class="token plain">  object PolyOutput extends Poly.Effect.Output[Int, Throwable]</span><br></span><span class="token-line"><span class="token plain">  object PolyAll    extends Poly.Effect.InputErrorOutput</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val compose: URLayer[Has[Proxy], PolyExample] =</span><br></span><span class="token-line"><span class="token plain">    ZLayer.fromServiceM { proxy =&gt;</span><br></span><span class="token-line"><span class="token plain">      withRuntime.map { rts =&gt;</span><br></span><span class="token-line"><span class="token plain">        new PolyExample.Service {</span><br></span><span class="token-line"><span class="token plain">          def polyInput[I: Tag](input: I)                     = proxy(PolyInput.of[I], input)</span><br></span><span class="token-line"><span class="token plain">          def polyError[E: Tag](input: Int)                   = proxy(PolyError.of[E], input)</span><br></span><span class="token-line"><span class="token plain">          def polyOutput[A: Tag](input: Int)                  = proxy(PolyOutput.of[A], input)</span><br></span><span class="token-line"><span class="token plain">          def polyAll[I: Tag, E: Tag, A: Tag](input: I) = proxy(PolyAll.of[I, E, A], input)</span><br></span><span class="token-line"><span class="token plain">        }</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Similarly, we use the same <code>of</code> combinator to refer to concrete monomorphic call in our test suite when building expectations:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import PolyExampleMock._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val exp06 = PolyInput.of[String](equalTo(&quot;foo&quot;), value(&quot;bar&quot;))</span><br></span><span class="token-line"><span class="token plain">val exp07 = PolyInput.of[Int](equalTo(42), failure(new Exception))</span><br></span><span class="token-line"><span class="token plain">val exp08 = PolyInput.of[Long](equalTo(42L), value(&quot;baz&quot;))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val exp09 = PolyAll.of[Int, Throwable, String](equalTo(42), value(&quot;foo&quot;))</span><br></span><span class="token-line"><span class="token plain">val exp10 = PolyAll.of[Int, Throwable, String](equalTo(42), failure(new Exception))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="more-examples">More examples<a aria-hidden="true" class="hash-link" href="#more-examples" title="Direct link to heading">â€‹</a></h2><p>You can find more examples in the <code>examples</code> and <code>test-tests</code> subproject:</p><ul><li><a href="https://github.com/zio/zio/blob/master/examples/shared/src/test/scala/zio/examples/test/MockExampleSpec.scala" target="_blank" rel="noopener noreferrer">MockExampleSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/EmptyMockSpec.scala" target="_blank" rel="noopener noreferrer">EmptyMockSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/ComposedMockSpec.scala" target="_blank" rel="noopener noreferrer">ComposedMockSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/ComposedEmptyMockSpec.scala" target="_blank" rel="noopener noreferrer">ComposedEmptyMockSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/PolyMockSpec.scala" target="_blank" rel="noopener noreferrer">PolyMockSpec</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/versioned_docs/version-1.x/howto/mock-services.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/version-1.x/howto/test-effects"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->How to Test effects?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/version-1.x/howto/handle-errors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to Handle Errors?<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-test-interactions-between-services" class="table-of-contents__link toc-highlight">How to test interactions between services?</a></li><li><a href="#hidden-outputs" class="table-of-contents__link toc-highlight">Hidden outputs</a></li><li><a href="#mocking" class="table-of-contents__link toc-highlight">Mocking</a></li><li><a href="#creating-a-mock-service" class="table-of-contents__link toc-highlight">Creating a mock service</a></li><li><a href="#complete-example" class="table-of-contents__link toc-highlight">Complete example</a></li><li><a href="#provided-zio-services" class="table-of-contents__link toc-highlight">Provided ZIO services</a></li><li><a href="#setting-up-expectations" class="table-of-contents__link toc-highlight">Setting up expectations</a></li><li><a href="#providing-mocked-environment" class="table-of-contents__link toc-highlight">Providing mocked environment</a></li><li><a href="#mocking-unused-collaborators" class="table-of-contents__link toc-highlight">Mocking unused collaborators</a></li><li><a href="#mocking-multiple-collaborators" class="table-of-contents__link toc-highlight">Mocking multiple collaborators</a></li><li><a href="#polymorphic-capabilities" class="table-of-contents__link toc-highlight">Polymorphic capabilities</a></li><li><a href="#more-examples" class="table-of-contents__link toc-highlight">More examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.2ca2038d.js"></script>
<script src="/assets/js/main.d278da23.js"></script>
</body>
</html>