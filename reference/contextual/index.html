<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/contextual/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-rh="true">Introduction to the ZIO&#x27;s Contextual Data Types | ZIO</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/reference/contextual/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Introduction to the ZIO&#x27;s Contextual Data Types | ZIO"><meta data-rh="true" name="description" content="ZIO provides a contextual abstraction that encodes the environment of the running effect. This means, every effect can work within a specific context, called an environment."><meta data-rh="true" property="og:description" content="ZIO provides a contextual abstraction that encodes the environment of the running effect. This means, every effect can work within a specific context, called an environment."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/reference/contextual/"><link data-rh="true" rel="alternate" href="https://zio.dev/reference/contextual/" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/reference/contextual/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.97da2182.css">
<link rel="preload" href="/assets/js/runtime~main.769a9ae6.js" as="script">
<link rel="preload" href="/assets/js/main.0d7a2020.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/reference/contextual/">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reference/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/reference/core/zio/">Core</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference/core/zio/">ZIO</a><button aria-label="Toggle the collapsible sidebar category &#x27;ZIO&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/zioapp">ZIOApp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/runtime">Runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/exit">Exit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/cause">Cause</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/error-management/">Error Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Error Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/services/">Built-in Services</a><button aria-label="Toggle the collapsible sidebar category &#x27;Built-in Services&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/schedule/">Scheduling</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scheduling&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" href="/reference/contextual/">Contextual Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contextual Types&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/contextual/zenvironment">ZEnvironment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/reference/contextual/zlayer">ZIO Layers</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/state/">State Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;State Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/fiber/">Concurrency</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/resource/">Resource Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resource Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/stream/">Streaming</a><button aria-label="Toggle the collapsible sidebar category &#x27;Streaming&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/metrics/">Metrics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Metrics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/test/">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/misc/chunk">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Contextual Types</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Introduction to the ZIO&#x27;s Contextual Data Types</h1></header><p>ZIO provides a contextual abstraction that encodes the environment of the running effect. This means, every effect can work within a specific context, called an environment.</p><p>So when we have a <code>ZIO[R, E, A]</code> effect, we can say &quot;given <code>R</code> as the environment of the effect, the effect may fail with an error type of <code>E</code>, or may succeed with a value of type <code>A</code>&quot;.</p><p>For example, when we have an effect of type <code>ZIO[DatabaseConnection, IOException, String]</code>, we can say that our effect works within the context of <code>DatabaseConnection</code>. In other words, we can say that our effect requires the <code>DatabaseConnection</code> service as a context to run.</p><p>We will see how layers can be used to eliminate the environment of an effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> DatabaseConnection</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// An effect which requires DatabaseConnection to run</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> effect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DatabaseConnection</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// A layer that produces DatabaseConnection service</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> dbConnection</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> DatabaseConnection</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// After applying dbConnection to our environmental effect the reurned</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// effect has no dependency on the DatabaseConnection</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> eliminated</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  dbConnection </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token comment">// Provides DatabaseConnection context</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    effect       </span><span class="token comment">// An effect running within `DatabaseConnection` context</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO provides this facility through the following concepts and data types:</p><ol><li><a href="#1-zio-environment">ZIO Environment</a> — The <code>R</code> type parameter of <code>ZIO[R, E, A]</code> data type.</li><li><a href="#2-zenvironment">ZEnvironment</a> — Built-in type-level map for maintaining the environment of a <code>ZIO</code> data type. </li><li><a href="#3-zlayer">ZLayer</a> — Describes how to build one or more services in our application.</li></ol><p>Next, we will discuss <em>ZIO Environment</em> and <em>ZLayer</em> and finally how to write ZIO services using the <em>Service Pattern</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-zio-environment">1. ZIO Environment<a class="hash-link" href="#1-zio-environment" title="Direct link to heading">​</a></h2><p>The <code>ZIO[-R, +E, +A]</code> data type describes an effect that requires an input of type <code>R</code>, as an environment, may fail with an error of type <code>E</code>, or succeed with a value of type <code>A</code>.</p><p>The input type is also known as <em>environment type</em>. This type-parameter indicates that to run an effect we need one or some services as an environment of that effect. In other word, <code>R</code> represents the <em>requirement</em> for the effect to run, meaning we need to fulfill the requirement in order to make the effect <em>runnable</em>.</p><p>So we can think of <code>ZIO[R, E, A]</code> as a mental model of a function from a value of type <code>R</code> to the <code>Either[E, A]</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">type</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> R </span><span class="token keyword">=&gt;</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>R</code> represents dependencies; whatever services, config, or wiring a part of a ZIO program depends upon to work. We will explore what we can do with <code>R</code>, as it plays a crucial role in <code>ZIO</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">​</a></h3><p>One might ask &quot;What is the motivation behind encoding the dependency in the type parameter of <code>ZIO</code> data type&quot;? What is the benefit of doing so?</p><p>Let&#x27;s see how writing an application which requires reading from or writing to the terminal. As part of making the application <em>modular</em> and <em>testable</em> we define a separate service called <code>Terminal</code> which is responsible for reading from and writing to the terminal. We do that simply by writing an interface:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Terminal </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> print</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> readLine</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can write our application that accepts the <code>Terminal</code> interface as a parameter:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> myApp</span><span class="token punctuation">(</span><span class="token plain">c</span><span class="token operator">:</span><span class="token plain"> Terminal</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _    </span><span class="token keyword">&lt;-</span><span class="token plain"> c</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter your name: &quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    name </span><span class="token keyword">&lt;-</span><span class="token plain"> c</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">    _    </span><span class="token keyword">&lt;-</span><span class="token plain"> c</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Hello, </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">name</span><span class="token string-interpolation string">!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similar to the object-oriented paradigm we code to interface not implementation. In order to run the application, we need to implement a production version of the <code>Terminal</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> TerminalLive </span><span class="token keyword">extends</span><span class="token plain"> Terminal </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> print</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain">scala</span><span class="token punctuation">.</span><span class="token plain">Predef</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain">scala</span><span class="token punctuation">.</span><span class="token plain">Predef</span><span class="token punctuation">.</span><span class="token plain">println</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> readLine</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain">scala</span><span class="token punctuation">.</span><span class="token plain">io</span><span class="token punctuation">.</span><span class="token plain">StdIn</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, we can provide the <code>TerminalLive</code> to our application and run the whole:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> myApp</span><span class="token punctuation">(</span><span class="token plain">c</span><span class="token operator">:</span><span class="token plain"> Terminal</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _    </span><span class="token keyword">&lt;-</span><span class="token plain"> c</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter your name: &quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      name </span><span class="token keyword">&lt;-</span><span class="token plain"> c</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">      _    </span><span class="token keyword">&lt;-</span><span class="token plain"> c</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Hello, </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">name</span><span class="token string-interpolation string">!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">(</span><span class="token plain">TerminalLive</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above example, we discard the fact that we could use the ZIO environment and utilize the <code>R</code> parameter of the <code>ZIO</code> data type. So instead we tried to write the application with the <code>Task</code> data type, which ignores the ZIO environment. To create our application testable, we gathered all terminal functionalities into the same interface called <code>Terminal</code>, and implemented that in another object called <code>TerminalLive</code>. Finally, at the end of the day, we provide the implementation of the <code>Terminal</code> service, i.e. <code>TerminalLive</code>, to our application.</p><p><strong>While this technique works for small programs, it doesn&#x27;t scale.</strong> Assume we have multiple services, and we use them in our application logic like below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">   s1</span><span class="token operator">:</span><span class="token plain"> Service1</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">   s2</span><span class="token operator">:</span><span class="token plain"> Service2</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">   s3</span><span class="token operator">:</span><span class="token plain"> Service3</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">arg1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> arg2</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> arg3</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> bar</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  s1</span><span class="token operator">:</span><span class="token plain"> Service1</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  s12</span><span class="token operator">:</span><span class="token plain"> Service12</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  s18</span><span class="token operator">:</span><span class="token plain"> Service18</span><span class="token punctuation">,</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  sn</span><span class="token operator">:</span><span class="token plain"> ServiceN</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">arg1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> arg2</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> arg3</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">,</span><span class="token plain"> arg4</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> myApp</span><span class="token punctuation">(</span><span class="token plain">s1</span><span class="token operator">:</span><span class="token plain"> Service1</span><span class="token punctuation">,</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> Service2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token plain"> sn</span><span class="token operator">:</span><span class="token plain"> ServiceN</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    a </span><span class="token keyword">&lt;-</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token plain">s1</span><span class="token punctuation">,</span><span class="token plain"> s2</span><span class="token punctuation">,</span><span class="token plain"> s3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;arg1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;arg2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> bar</span><span class="token punctuation">(</span><span class="token plain">s1</span><span class="token punctuation">,</span><span class="token plain"> s12</span><span class="token punctuation">,</span><span class="token plain"> s18</span><span class="token punctuation">,</span><span class="token plain"> sn</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;arg2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1.2</span><span class="token punctuation">,</span><span class="token plain"> a</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Writing real applications using this technique is tedious and cumbersome because all dependencies have to be passed across all methods. We can simplify the process of writing our application by using the ZIO environment and <a href="#service-pattern">Service Pattern</a>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token plain">arg1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> arg2</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> arg3</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Service1 </span><span class="token operator">&amp;</span><span class="token plain"> Service2 </span><span class="token operator">&amp;</span><span class="token plain"> Service3</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    s1 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Service1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    s2 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Service2</span><span class="token punctuation">]</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> bar</span><span class="token punctuation">(</span><span class="token plain">arg1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> arg2</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> arg3</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">,</span><span class="token plain"> arg4</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Service1 </span><span class="token operator">&amp;</span><span class="token plain"> Service12 </span><span class="token operator">&amp;</span><span class="token plain"> Service18 </span><span class="token operator">&amp;</span><span class="token plain"> ServiceN</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    s1  </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Service1</span><span class="token punctuation">]</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    s12 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Service12</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantage-of-using-zio-environment">Advantage of Using ZIO Environment<a class="hash-link" href="#advantage-of-using-zio-environment" title="Direct link to heading">​</a></h3><p>ZIO environment facility enables us to:</p><ol><li><p><strong>Code to Interface</strong> — Like object-oriented paradigm, in ZIO we are encouraged to code to interface and defer the implementation. It is the best practice, but ZIO does not enforce us to do that.</p></li><li><p><strong>Write a Testable Code</strong> — By coding to an interface, whenever we want to test our effects, we can easily mock any external services, by providing a <em>test</em> version of those instead of the <em>live</em> version.</p></li><li><p><strong>Compose Services with Strong Type Inference Facility</strong> — We can compose multiple effects that require various services, so the final effect requires the intersection of all those services:</p></li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ServiceA</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ServiceB</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ServiceC</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Requires ServiceA and produces a value of type Int</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceA</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Requires ServiceB and ServiceC and produces a value of type String</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> bar</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceB </span><span class="token operator">&amp;</span><span class="token plain"> ServiceC</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Requires ServicB and produces a value of type Double</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> baz</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceB</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Requires ServiceB and ServiceB and ServiceC and produces a value of type Double</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceA </span><span class="token operator">&amp;</span><span class="token plain"> ServiceB </span><span class="token operator">&amp;</span><span class="token plain"> ServiceC</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    a </span><span class="token keyword">&lt;-</span><span class="token plain"> foo</span><br></span><span class="token-line"><span class="token plain">    b </span><span class="token keyword">&lt;-</span><span class="token plain"> bar</span><br></span><span class="token-line"><span class="token plain">    c </span><span class="token keyword">&lt;-</span><span class="token plain"> baz</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another important note about the ZIO environment is that the type inference works well on effect composition. After we composed all the application logic together, the compiler and also IDE can infer the proper type for the environment of the final effect.</p><p>In the example above, the compiler can infer the environment type of the <code>myApp</code> effect which is <code>ServiceA &amp; ServiceB &amp; ServiceC</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-zio-environment">Accessing ZIO Environment<a class="hash-link" href="#accessing-zio-environment" title="Direct link to heading">​</a></h3><p>We have two types of accessors for the ZIO environment:DocRepo</p><ol><li><strong>Service Accessor (<code>ZIO.service</code>)</strong> is used to access a specific service from the environment.</li><li><strong>Service Member Accessors (<code>ZIO.serviceWith</code> and <code>ZIO.serviceWithZIO</code>)</strong> are used to access capabilities of a specific service from the environment.</li></ol><blockquote><p><strong>Note</strong>:</p><p>To access the entire ZIO environment we can use <code>ZIO.environment*</code>, but we do not use these methods regularly to access ZIO services. Instead, we use service accessors and service member accessors.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-accessor">Service Accessor<a class="hash-link" href="#service-accessor" title="Direct link to heading">​</a></h4><p>To access a service from the ZIO environment, we can use the <code>ZIO.service</code> constructor. For example, in the following program we are going to access the <code>AppConfig</code> from the environment:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    config </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">logInfo</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Application started with config: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">config</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To run the <code>myApp</code> effect, we should provide the <code>AppConfig</code> layer (we will talk about <code>ZLayer</code> on the next section):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">AppConfig</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To access multiple services from the ZIO environment, we can do the same:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Foo</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Bar</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Baz</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  foo </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Foo</span><span class="token punctuation">]</span><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  bar </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Bar</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  bax </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Baz</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When creating ZIO layers that have multiple dependencies, this can be helpful. We will discuss this pattern in the <a href="#service-pattern">Service Pattern</a> section.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-member-accessors">Service Member Accessors<a class="hash-link" href="#service-member-accessors" title="Direct link to heading">​</a></h4><p>Sometimes instead of accessing a service, we need to access the capabilities (members) of a service. Based on the return type of each capability, we can use one of these accessors:</p><ul><li><strong>ZIO.serviceWith</strong></li><li><strong>ZIO.serviceWithZIO</strong></li></ul><p>In <a href="#service-pattern">Service Pattern</a>, we use these accessors to write &quot;accessor methods&quot; for ZIO services.</p><p>Let&#x27;s look at each one in more detail:</p><ol><li><strong>ZIO.serviceWith</strong> — When we are accessing service members whose return type is an ordinary value, we should use the <code>ZIO.serviceWith</code>.</li></ol><p>In the following example, we need to use the <code>ZIO.serviceWith</code> to write accessor methods for all of the <code>AppConfig</code> members:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AppConfig</span><span class="token punctuation">(</span><span class="token plain">host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> poolSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> AppConfig </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// Accessor Methods</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> host</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain">  </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWith</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">host</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">     </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWith</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">port</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> poolSize</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWith</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">poolSize</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">AppConfig</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    host     </span><span class="token keyword">&lt;-</span><span class="token plain"> AppConfig</span><span class="token punctuation">.</span><span class="token plain">host</span><br></span><span class="token-line"><span class="token plain">    port     </span><span class="token keyword">&lt;-</span><span class="token plain"> AppConfig</span><span class="token punctuation">.</span><span class="token plain">port</span><br></span><span class="token-line"><span class="token plain">    _        </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">logInfo</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;The service will be service at </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">host</span><span class="token string-interpolation string">:</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">port</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    poolSize </span><span class="token keyword">&lt;-</span><span class="token plain"> AppConfig</span><span class="token punctuation">.</span><span class="token plain">poolSize</span><br></span><span class="token-line"><span class="token plain">    _        </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">logInfo</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Application started with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">poolSize</span><span class="token string-interpolation string"> pool size&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>ZIO.serviceWithZIO</strong> — When we are accessing service members whose return type is a ZIO effect, we should use the <code>ZIO.serviceWithZIO</code>.</li></ol><p>For example, in order to write the accessor method for the <code>foo</code> member of the <code>Foo</code> service, we need to use the <code>ZIO.serviceWithZIO</code> function:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Foo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Foo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// Accessor Method</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> foo</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Foo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">foo</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-zenvironment">2. ZEnvironment<a class="hash-link" href="#2-zenvironment" title="Direct link to heading">​</a></h2><p><code>ZEnvironment</code> is a built-in type-level map for maintaining the environment of a <code>ZIO</code> data type. We don&#x27;t typically use this data type directly. It&#x27;s okay to skip learning it at the moment. We have a <a href="/reference/contextual/zenvironment">separate article</a> about this data type.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-zlayer">3. ZLayer<a class="hash-link" href="#3-zlayer" title="Direct link to heading">​</a></h2><p><code>ZLayer[-RIn, +E, +ROut]</code> is a recipe to build an environment of type <code>ROut</code>, starting from a value <code>RIn</code>, and possibly producing an error <code>E</code> during creation.</p><p><code>ZLayer</code> combined with the <em>ZIO Environment</em>, allow us to use ZIO for <em>dependency injection</em>. There are two parts of dependency injection:</p><ol><li><strong>Building Dependency Graph</strong></li><li><strong>Dependency Propagation</strong></li></ol><p>ZIO has a full solution to the dependency injection problem. It solves the first problem by using <a href="/reference/contextual/zlayer#manual-layer-construction">compositional properties</a> of <code>ZLayer</code>. Assume we have several services with their dependencies, and we need a way to compose and wire up these dependencies to create the dependency graph of the application. <code>ZLayer</code> is a ZIO solution for this problem. It allows us to build up the whole application dependency graph by composing layers horizontally and vertically. </p><p>ZIO also solves the second problem by using <a href="/reference/contextual/zlayer#dependency-propagation">ZIO Environment facilities like <code>ZIO#provide</code></a>.</p><blockquote><p><strong>Note:</strong></p><p>By using ZLayer and ZIO Environment we can solve the propagation and wire-up problems in dependency injection. Note that we are not enforced to use this approach, as we can still use things like <a href="https://github.com/google/guice" target="_blank" rel="noopener noreferrer">Guice</a> with ZIO, or we might like to use <a href="https://izumi.7mind.io/distage/index.html" target="_blank" rel="noopener noreferrer">izumi distage</a> solution for dependency injection.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-zio-services">Defining ZIO Services<a class="hash-link" href="#defining-zio-services" title="Direct link to heading">​</a></h2><p>Defining services in ZIO is not very different from object-oriented style, it has the same principle: coding to an interface, not an implementation. Therefore, ZIO encourages us to implement this principle by using <em>Service Pattern</em>, which is quite similar to the object-oriented style.</p><p>Before diving into writing services in ZIO style, let&#x27;s review how we define them in an object-oriented fashion in the next section.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-services-in-oop">Defining Services in OOP<a class="hash-link" href="#defining-services-in-oop" title="Direct link to heading">​</a></h3><p>Here are the steps we take to implement a service in object-oriented programming:</p><ol><li><strong>Service Definition</strong> — In object-oriented programming, we define services with traits. A service is a bundle of related functionality that is defined in a trait:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> FooService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>Service Implementation</strong> — We implement these services by using classes:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">class</span><span class="token plain"> FooServiceImpl </span><span class="token keyword">extends</span><span class="token plain"> FooService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong>Defining Dependencies</strong> — If the creation of a service depends on other services, we can define these dependencies by using constructors:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ServiceA </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ServiceB </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> FooServiceImpl</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> ServiceA</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> ServiceB</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> FooService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In object-oriented programming, the best practice is to <em>program to an interface, not an implementation</em>. So in the previous example, <code>ServiceA</code> and <code>ServiceB</code> are interfaces, not concrete classes.</p><ol start="4"><li><strong>Injecting Dependencies</strong> — Now, the client of <code>FooServiceImpl</code> service can provide its own implementation of <code>ServiceA</code> and <code>ServiceB</code>, and inject them to the <code>FooServiceImpl</code> constructor:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">class</span><span class="token plain"> ServiceAImpl </span><span class="token keyword">extends</span><span class="token plain"> ServiceA</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> ServiceBImpl </span><span class="token keyword">extends</span><span class="token plain"> ServiceB</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooService </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> FooServiceImpl</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ServiceAImpl</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> ServiceBImpl</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sometimes, as the number of dependent services grows and the dependency graph of our application becomes complicated, we need an automatic way of wiring and providing dependencies into the services of our application. In these situations, we might use a dependency injection framework to do all its magic machinery for us.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-services-in-zio">Defining Services in ZIO<a class="hash-link" href="#defining-services-in-zio" title="Direct link to heading">​</a></h3><p>A service is a group of functions that deals with only one concern. Keeping the scope of each service limited to a single responsibility improves our ability to understand code, in that we need to focus only on one topic at a time without juggling too many concepts together in our head.</p><p>In functional Scala as well as in object-oriented programming the best practice is to <em>Program to an Interface, Not an Implementation</em>. This is the most important design principle in software development and helps us to write maintainable code by:</p><ul><li><p>Allowing the client to hold an interface as a contract and don&#x27;t worry about the implementation. The interface signature determines all operations that should be done.</p></li><li><p>Enabling a developer to write more testable programs. When we write a test for our business logic we don&#x27;t have to run and interact with real services like databases which makes our test run very slow. If our code is correct our test code should always pass, there should be no hidden variables or depend on outside sources. We can&#x27;t know that the database is always running correctly. We don&#x27;t want to fail our tests because of the failure of external service.</p></li><li><p>Providing the ability to write more modular applications. So we can plug in different implementations for different purposes without a major modification.</p></li></ul><p>It is not mandatory, but ZIO encourages us to follow this principle by bundling related functionality as an interface by using the <em>Service Pattern</em>.</p><p>The core idea is that a layer depends upon the interfaces exposed by the layers immediately below itself, but is completely unaware of its dependencies&#x27; internal implementations.</p><p>In object-oriented programming:</p><ul><li><strong>Service Definition</strong> is done by using <em>interfaces</em> (Scala trait or Java Interface).</li><li><strong>Service Implementation</strong> is done by implementing interfaces using <em>classes</em> or creating <em>new object</em> of the interface.</li><li><strong>Defining Dependencies</strong> is done by using <em>constructors</em>. They allow us to build classes, given their dependencies. This is called constructor-based dependency injection.</li></ul><p>We have a similar analogy in the Service Pattern, except instead of using <em>constructors</em> we use <strong><code>ZLayer</code></strong> to define dependencies. So in ZIO fashion, we can think of <code>ZLayer</code> as a service constructor.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-pattern">Service Pattern<a class="hash-link" href="#service-pattern" title="Direct link to heading">​</a></h3><p>Writing services in ZIO using the <em>Service Pattern</em> is very similar to the object-oriented way of defining services. We use scala traits to define services, classes to implement services, and constructors to define service dependencies. Finally, we lift the class constructor into the <code>ZLayer</code>.</p><p>Let&#x27;s start learning this service pattern by writing a <code>DocRepo</code> service:</p><ol><li><strong>Service Definition</strong> — Traits are how we define services. A service could be all the stuff that is related to one concept with singular responsibility. We define the service definition with a trait named <code>DocRepo</code>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Doc</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    description</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    language</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    format</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    content</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> DocRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Doc</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Doc</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Doc</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>Service Implementation</strong> — It is the same as what we did in an object-oriented fashion. We implement the service with the Scala class:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DocRepoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DocRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Doc</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Doc</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Doc</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong>Define Service Dependencies</strong> — We might need <code>MetadataRepo</code> and <code>BlobStorage</code> services to implement the <code>DocRepo</code> service. Here, we put its dependencies into its constructor. All the dependencies are just interfaces, not implementation. Just like what we did in object-oriented style.</li></ol><p>First, we need to define the interfaces for <code>MetadataRepo</code> and <code>BlobStorage</code> services:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Metadata</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    description</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    language</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    format</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> MetadataRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Metadata</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> put</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> metadata</span><span class="token operator">:</span><span class="token plain"> Metadata</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> Metadata</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> BlobStorage </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> put</span><span class="token punctuation">(</span><span class="token plain">content</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, we can implement the <code>DocRepo</code> service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DocRepoImpl</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    metadataRepo</span><span class="token operator">:</span><span class="token plain"> MetadataRepo</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    blobStorage</span><span class="token operator">:</span><span class="token plain"> BlobStorage</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DocRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Doc</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      metadata </span><span class="token keyword">&lt;-</span><span class="token plain"> metadataRepo</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      content </span><span class="token keyword">&lt;-</span><span class="token plain"> blobStorage</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> Doc</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      metadata</span><span class="token punctuation">.</span><span class="token plain">title</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      metadata</span><span class="token punctuation">.</span><span class="token plain">description</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      metadata</span><span class="token punctuation">.</span><span class="token plain">language</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      metadata</span><span class="token punctuation">.</span><span class="token plain">format</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      content</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Doc</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      id </span><span class="token keyword">&lt;-</span><span class="token plain"> blobStorage</span><span class="token punctuation">.</span><span class="token plain">put</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token punctuation">.</span><span class="token plain">content</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> metadataRepo</span><span class="token punctuation">.</span><span class="token plain">put</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        id</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Metadata</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          document</span><span class="token punctuation">.</span><span class="token plain">title</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          document</span><span class="token punctuation">.</span><span class="token plain">description</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          document</span><span class="token punctuation">.</span><span class="token plain">language</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          document</span><span class="token punctuation">.</span><span class="token plain">format</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> id</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> blobStorage</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> metadataRepo</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Doc</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      map </span><span class="token keyword">&lt;-</span><span class="token plain"> metadataRepo</span><span class="token punctuation">.</span><span class="token plain">findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      content </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain"> metadata</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          content </span><span class="token keyword">&lt;-</span><span class="token plain"> blobStorage</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> id </span><span class="token operator">-&gt;</span><span class="token plain"> Doc</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          metadata</span><span class="token punctuation">.</span><span class="token plain">title</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          metadata</span><span class="token punctuation">.</span><span class="token plain">description</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          metadata</span><span class="token punctuation">.</span><span class="token plain">language</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          metadata</span><span class="token punctuation">.</span><span class="token plain">format</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          content</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> content</span><span class="token punctuation">.</span><span class="token plain">values</span><span class="token punctuation">.</span><span class="token plain">toList</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li><strong>Defining ZLayer</strong> — Now, we create a companion object for <code>DocRepoImpl</code> data type and lift the service implementation into the <code>ZLayer</code>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> DocRepoImpl </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">BlobStorage </span><span class="token keyword">with</span><span class="token plain"> MetadataRepo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> DocRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        metadataRepo </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">MetadataRepo</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        blobStorage  </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">BlobStorage</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> DocRepoImpl</span><span class="token punctuation">(</span><span class="token plain">metadataRepo</span><span class="token punctuation">,</span><span class="token plain"> blobStorage</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li><strong>Accessor Methods</strong> — Finally, to create the API more ergonomic, it&#x27;s better to write accessor methods for all of our service methods using <code>ZIO.serviceWithZIO</code> constructor inside the companion object:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> DocRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Doc</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Doc</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Doc</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Accessor methods allow us to utilize all the features inside the service through the ZIO Environment. That means, if we call <code>DocRepo.get</code>, we don&#x27;t need to pull out the <code>get</code> function from the ZIO Environment. The <code>ZIO.serviceWithZIO</code> constructor helps us to access the environment and reduce the redundant operations, every time.</p><p>Similarly, we need to implement the <code>BlobStorage</code> and <code>MetadataRepo</code> services:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> InmemoryBlobStorage </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> InmemoryMetadataRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is how ZIO services are created. Let&#x27;s use the <code>DocRepo</code> service in our application. We should provide <code>DocRepo</code> layer to be able to run the application:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> app </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      id </span><span class="token keyword">&lt;-</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        DocRepo</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          Doc</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token string">&quot;content&quot;</span><span class="token punctuation">.</span><span class="token plain">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      doc </span><span class="token keyword">&lt;-</span><span class="token plain"> DocRepo</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;&quot;&quot;</span><br></span><span class="token-line"><span class="token string-interpolation string">          |Downloaded the document with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">id</span><span class="token string-interpolation string"> id:</span><br></span><span class="token-line"><span class="token string-interpolation string">          |  title: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">title</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |  description: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">description</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |  language: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">language</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |  format: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">format</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |&quot;&quot;&quot;</span><span class="token punctuation">.</span><span class="token plain">stripMargin</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> DocRepo</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Deleted the document with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">id</span><span class="token string-interpolation string"> id&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    app</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      DocRepoImpl</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      InmemoryBlobStorage</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      InmemoryMetadataRepo</span><span class="token punctuation">.</span><span class="token plain">layer</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>During writing the application, we don&#x27;t care which implementation version of the <code>BlobStorage</code> and <code>MetadataRepo</code> services will be injected into our <code>app</code>. Later at the end of the day, it will be provided by one of <code>ZIO#provide*</code> methods.</p><p>That&#x27;s it! Very simple! ZIO encourages us to follow some of the best practices in object-oriented programming. So it doesn&#x27;t require us to throw away all our object-oriented knowledge.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-polymorphic-services-in-zio">Defining Polymorphic Services in ZIO<a class="hash-link" href="#defining-polymorphic-services-in-zio" title="Direct link to heading">​</a></h3><p>As we discussed <a href="/reference/contextual/zenvironment">here</a>, the <code>ZEnvironment</code>, which is the underlying data type used by <code>ZLayer</code>, is backed by a type-level mapping from types of services to implementations of those services. This functionality is backed by <code>izumi.reflect.Tag</code>, which captures a type as a value. </p><p>We just need to know what is the type of service when we put it in the <code>ZEnvironment</code> because <code>ZEnvironment</code> is essentially a map from <em>service types (interfaces)</em> to <em>implementation of those interfaces</em>. To implement the map, the <code>ZEnvironment</code> needs a type tag for the new service, and also needs a way to remove the old service from the type level map. So we should have service type information at the runtime. </p><p>We can think of <code>Tag[A]</code> as like a <code>TypeTag[A]</code> or <code>ClassTag[A]</code> from the Scala standard library but available on a cross-version and cross-platform basis. Basically, it carries information about a certain type into runtime that was available at compile time. Methods that construct <code>ZEnvironment</code> values generally require a tag for the value being included in the “bundle of services”. </p><p>As a user, we should not normally interact with <code>Tag</code> except where we define polymorphic services. In general, a <code>Tag</code> should always be available whenever we have a concrete type. The only time we should have to use it is when we have a <em>polymorphic service</em>. If we are using polymorphic code, we need to provide implicit evidence that a tag exists for that type (<code>implicit tag: Tag[A]</code>) or as a context-bound for that type parameter: (<code>A: Tag</code>).</p><p>Let&#x27;s try to write a polymorphic service. Assume we have the following service interface:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the next step, we are going to write its accessors. We might end up with the following snippet code:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> KeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// error: could not find implicit value for izumi.reflect.Tag[K]. Did you forget to put on a Tag, TagK or TagKK context bound on one of the parameters in K? e.g. def x[T: Tag, F[_]: TagK] = ...</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// &lt;trace&gt;: </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   deriving Tag for K, dealiased: K:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   could not find implicit value for Tag[K]: K is a type parameter without an implicit Tag!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     ZIO.serviceWithZIO[KeyValueStore[K, V, E, IO]](_.get(key))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//                                                   ^</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// error: could not find implicit value for izumi.reflect.Tag[K]. Did you forget to put on a Tag, TagK or TagKK context bound on one of the parameters in K? e.g. def x[T: Tag, F[_]: TagK] = ...</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// &lt;trace&gt;: </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   deriving Tag for K, dealiased: K:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   could not find implicit value for Tag[K]: K is a type parameter without an implicit Tag!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     ZIO.serviceWithZIO[KeyValueStore[K, V, E, IO]](_.set(key, value))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//                                                   ^</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// error: could not find implicit value for izumi.reflect.Tag[K]. Did you forget to put on a Tag, TagK or TagKK context bound on one of the parameters in K? e.g. def x[T: Tag, F[_]: TagK] = ...</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// &lt;trace&gt;: </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   deriving Tag for K, dealiased: K:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   could not find implicit value for Tag[K]: K is a type parameter without an implicit Tag!</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     ZIO.serviceWithZIO(_.remove(key))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//                       ^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The compiler generates the following errors:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">could not find implicit value for izumi.reflect.Tag[K]. Did you forget to put on a Tag, TagK or TagKK context bound on one of the parameters in K? e.g. def x[T: Tag, F[_]: TagK] = ...</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">&lt;trace&gt;: </span><br></span><span class="token-line"><span class="token plain">  deriving Tag for K, dealiased: K:</span><br></span><span class="token-line"><span class="token plain">  could not find implicit value for Tag[K]: K is a type parameter without an implicit Tag!</span><br></span><span class="token-line"><span class="token plain">    ZIO.serviceWithZIO[KeyValueStore[K, V, E, IO]](_.get(key))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As the compiler says, we should put <code>Tag</code> as a context-bound for <code>K</code>, <code>V</code>, and <code>E</code> type parameters:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> KeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, we can continue and implement the in-memory version of this key-value store:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> Ref</span><span class="token punctuation">[</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">someOrFail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">key</span><span class="token string-interpolation string"> not found&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">updated</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">removed</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> InmemoryKeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Ref</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">(</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">InmemoryKeyValueStore</span><span class="token punctuation">.</span><span class="token plain">apply</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The last step is to use the service in a ZIO application:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">remove</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">either</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">InmemoryKeyValueStore</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that in the above example, one might want to write accessors more polymorphic. So in this case we should add <code>TagKK</code> as a context-bound of the <code>F</code> type parameter:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> KeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> TagKK</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWith</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> TagKK</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWith</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> TagKK</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWith</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">remove</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="generating-accessor-methods-using-macros">Generating Accessor Methods Using Macros<a class="hash-link" href="#generating-accessor-methods-using-macros" title="Direct link to heading">​</a></h3><p>Writing accessor methods is a repetitive task and would be cumbersome in services with many methods. We can automate the generation of accessor methods using <code>zio-macro</code> module. </p><p>To install the <code>zio-macro</code> we should add the following line in our <code>build.sbt</code> file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">libraryDependencies </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token string">&quot;dev.zio&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;zio-macros&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;&lt;zio-version&gt;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, to enable macro expansion we need to setup our project:</p><ul><li><p>for Scala <code>&gt;= 2.13</code> add compiler option:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">scalacOptions </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token string">&quot;-Ymacro-annotations&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>for Scala <code>&lt; 2.13</code> add macro paradise compiler plugin:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">compilerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;org.scalamacros&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;paradise&quot;</span><span class="token plain">  </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;2.1.1&quot;</span><span class="token punctuation">)</span><span class="token plain"> cross CrossVersion</span><span class="token punctuation">.</span><span class="token plain">full</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><blockquote><p><strong>Note:</strong></p><p>At the moment these are only available for Scala versions <code>2.x</code>, however their equivalents for Scala 3 are on our roadmap.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="monomorphic-services">Monomorphic Services<a class="hash-link" href="#monomorphic-services" title="Direct link to heading">​</a></h4><p>We can use the <code>@accessible</code> macro to generate <em>service member accessors</em>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token annotation punctuation">@accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ServiceA </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> method</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> Something</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// below will be autogenerated</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> ServiceA </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> method</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> Something</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceA</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">method</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For normal values, a <code>ZIO</code> with <code>Nothing</code> on error channel is generated:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token annotation punctuation">@accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ServiceB </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> pureMethod</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> Something</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> SomethingElse</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// below will be autogenerated</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> ServiceB </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> pureMethod</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> Something</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceB</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> SomethingElse</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWith</span><span class="token punctuation">[</span><span class="token plain">ServiceB</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">pureMethod</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>@throwing</code> annotation will mark impure methods. Using this annotation will request ZIO to push the error on the error channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">throwing</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token annotation punctuation">@accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ServiceC </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token annotation punctuation">@throwing</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> impureMethod</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> Something</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> SomethingElse</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// below will be autogenerated</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> ServiceC </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> impureMethod</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> Something</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceC</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> SomethingElse</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">ServiceC</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">s </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">.</span><span class="token plain">impureMethod</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below is a fully working example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token annotation punctuation">@accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> KeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> Ref</span><span class="token punctuation">[</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> KeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">updated</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">someOrFailException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> InmemoryKeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        map </span><span class="token keyword">&lt;-</span><span class="token plain"> Ref</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">(</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _   </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      key </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> key</span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">InmemoryKeyValueStore</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="writing-polymorphic-services">Writing Polymorphic Services<a class="hash-link" href="#writing-polymorphic-services" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="with-proper-type-parameters">With Proper Type Parameters<a class="hash-link" href="#with-proper-type-parameters" title="Direct link to heading">​</a></h5><p>If the service is polymorphic for some proper types, we can use the <code>@accessible</code> macro like previous examples.</p><p>Assume we have a <code>KeyValueStore</code> like below, as we will see using <code>@accessible</code> will generate us the accessor methods:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token annotation punctuation">@accessible</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> Ref</span><span class="token punctuation">[</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">updated</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">someOrFailException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> InmemoryKeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        map </span><span class="token keyword">&lt;-</span><span class="token plain"> Ref</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">(</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      key </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> key</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">InmemoryKeyValueStore</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="with-higher-kinded-type-parameters-f_">With Higher-Kinded Type Parameters (<code>F[_]</code>)<a class="hash-link" href="#with-higher-kinded-type-parameters-f_" title="Direct link to heading">​</a></h5><p>If a service has a higher-kinded type parameter like <code>F[_]</code> we should use the <code>accessibleM</code> macro. Here is an example of such a service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">accessibleM</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token annotation punctuation">@accessibleM</span><span class="token punctuation">[</span><span class="token plain">Task</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">_</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> Ref</span><span class="token punctuation">[</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Task</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">updated</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">someOrFailException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> InmemoryKeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Task</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        map </span><span class="token keyword">&lt;-</span><span class="token plain"> Ref</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">(</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      key </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _   </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> key</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">InmemoryKeyValueStore</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="with-higher-kinded-type-parameters-f_-_">With Higher-Kinded Type Parameters (<code>F[_, _]</code>)<a class="hash-link" href="#with-higher-kinded-type-parameters-f_-_" title="Direct link to heading">​</a></h5><p>If the service has a higher-kinded type parameter like <code>F[_, _]</code> we should use the <code>accessibleMM</code> macro. Let&#x27;s see an example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">macros</span><span class="token namespace punctuation">.</span><span class="token namespace">accessibleMM</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token annotation punctuation">@accessibleMM</span><span class="token punctuation">[</span><span class="token plain">IO</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> K</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> F</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> Ref</span><span class="token punctuation">[</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">extends</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> set</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">updated</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    map</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">someOrFail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;key not found: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">key</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> InmemoryKeyValueStore </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">KeyValueStore</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> IO</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        map </span><span class="token keyword">&lt;-</span><span class="token plain"> Ref</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">(</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> InmemoryKeyValueStore</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _   </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      key </span><span class="token keyword">&lt;-</span><span class="token plain"> KeyValueStore</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> key</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">InmemoryKeyValueStore</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-three-laws-of-zio-environment">The Three Laws of ZIO Environment<a class="hash-link" href="#the-three-laws-of-zio-environment" title="Direct link to heading">​</a></h3><p>When we are working with the ZIO environment, one question might arise: &quot;When should we use environment and when do we need to use constructors?&quot;.</p><p>Using ZIO environment follows three laws:</p><ol><li><strong>Service Interface (Trait)</strong> — When we are defining service interfaces we should <em>never</em> use the environment for dependencies of the service itself.</li></ol><p>For example, if the implementation of service <code>X</code> depends on service <code>Y</code> and <code>Z</code> then these should never be reflected in the trait that defines service <code>X</code>. It&#x27;s leaking implementation details.</p><p>So the following service definition is wrong because the <code>BlobStorage</code> and <code>MetadataRepo</code> services are dependencies of the  <code>DocRepo</code> service&#x27;s implementation, not the <code>DocRepo</code> interface itself:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> DocRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Doc</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">BlobStorage </span><span class="token operator">&amp;</span><span class="token plain"> MetadataRepo</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>Service Implementation (Class)</strong> — When implementing service interfaces, we should accept all dependencies in the class constructor.</li></ol><p>Again, let&#x27;s see how <code>DocRepoImpl</code> accepts <code>BlobStorage</code> and <code>MetadataRepo</code> dependencies from the class constructor:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DocRepoImpl</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    metadataRepo</span><span class="token operator">:</span><span class="token plain"> MetadataRepo</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    blobStorage</span><span class="token operator">:</span><span class="token plain"> BlobStorage</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DocRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> blobStorage</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> metadataRepo</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Doc</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Doc</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Doc</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> DocRepoImpl </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">BlobStorage </span><span class="token keyword">with</span><span class="token plain"> MetadataRepo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> DocRepo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZLayer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        metadataRepo </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">MetadataRepo</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        blobStorage  </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">BlobStorage</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> DocRepoImpl</span><span class="token punctuation">(</span><span class="token plain">metadataRepo</span><span class="token punctuation">,</span><span class="token plain"> blobStorage</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So keep in mind, we can&#x27;t do something like this:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DocRepoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> DocRepo </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      blobStorage  </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">BlobStorage</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      metadataRepo </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">MetadataRepo</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _            </span><span class="token keyword">&lt;-</span><span class="token plain"> blobStorage</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _            </span><span class="token keyword">&lt;-</span><span class="token plain"> metadataRepo</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Doc</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">document</span><span class="token operator">:</span><span class="token plain"> Doc</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> findByTitle</span><span class="token punctuation">(</span><span class="token plain">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Doc</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong>Business Logic</strong> — Finally, in the business logic we should use the ZIO environment to consume services.</li></ol><p>Therefore, in the last example, if we inline all accessor methods whenever we are using services, we are using the ZIO environment:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> app </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      id </span><span class="token keyword">&lt;-</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          Doc</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token string">&quot;How to write a ZIO application?&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token string">&quot;In this tutorial we will learn how to write a ZIO application.&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token string">&quot;content&quot;</span><span class="token punctuation">.</span><span class="token plain">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      doc </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;&quot;&quot;</span><br></span><span class="token-line"><span class="token string-interpolation string">          |Downloaded the document with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">id</span><span class="token string-interpolation string"> id:</span><br></span><span class="token-line"><span class="token string-interpolation string">          |  title: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">title</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |  description: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">description</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |  language: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">language</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |  format: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">doc</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">format</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"></span><br></span><span class="token-line"><span class="token string-interpolation string">          |&quot;&quot;&quot;</span><span class="token punctuation">.</span><span class="token plain">stripMargin</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">DocRepo</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">delete</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Deleted the document with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">id</span><span class="token string-interpolation string"> id&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    app</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      DocRepoImpl</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      InmemoryBlobStorage</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      InmemoryMetadataRepo</span><span class="token punctuation">.</span><span class="token plain">layer</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That&#x27;s it! These are the most important rules we need to know about the ZIO environment.</p><blockquote><p><strong>Note</strong>:</p><p>The remaining part of this section can be skipped if you are not an advanced ZIO user.</p></blockquote><p>Now let&#x27;s elaborate more on the first rule. On rare occasions, all of which involve local context that is independent of implementation, it&#x27;s <em>acceptable</em> to use the environment in the definition of a service.</p><p>Here are two examples:</p><ol><li>In a web application, a service may be defined only to operate in the context of an HTTP request. In such a case, the request itself could be stored in the environment: <code>ZIO[HttpRequest, ...]</code>. This is acceptable because this use of the environment is part of the semantics of the trait itself, rather than leaking an implementation detail of some particular class that implements the service trait:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">net</span><span class="token namespace punctuation">.</span><span class="token plain">URI</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">nio</span><span class="token namespace punctuation">.</span><span class="token namespace">charset</span><span class="token namespace punctuation">.</span><span class="token plain">StandardCharsets</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">type</span><span class="token plain"> HttpApp </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">HttpRequest</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> HttpResponse</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">type</span><span class="token plain"> HttpRoute </span><span class="token operator">=</span><span class="token plain"> Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> HttpApp</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> HttpRequest</span><span class="token punctuation">(</span><span class="token plain">method</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                       uri</span><span class="token operator">:</span><span class="token plain"> URI</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                       headers</span><span class="token operator">:</span><span class="token plain"> Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                       body</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> HttpResponse</span><span class="token punctuation">(</span><span class="token plain">status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                        headers</span><span class="token operator">:</span><span class="token plain"> Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                        body</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> HttpResponse </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> apply</span><span class="token punctuation">(</span><span class="token plain">status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> HttpResponse </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    HttpResponse</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      status </span><span class="token operator">=</span><span class="token plain"> status</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      headers </span><span class="token operator">=</span><span class="token plain"> Map</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      body </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromChunk</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Chunk</span><span class="token punctuation">.</span><span class="token plain">fromArray</span><span class="token punctuation">(</span><span class="token plain">message</span><span class="token punctuation">.</span><span class="token plain">getBytes</span><span class="token punctuation">(</span><span class="token plain">StandardCharsets</span><span class="token punctuation">.</span><span class="token plain">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> ok</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> HttpResponse </span><span class="token operator">=</span><span class="token plain"> HttpResponse</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token plain"> msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> error</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> HttpResponse </span><span class="token operator">=</span><span class="token plain"> HttpResponse</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token plain"> msg</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> HttpServer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> serve</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> HttpRoute</span><span class="token punctuation">,</span><span class="token plain"> host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> HttpServer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> serve</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> HttpRoute</span><span class="token punctuation">,</span><span class="token plain"> host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">HttpServer</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">serve</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token punctuation">,</span><span class="token plain"> host</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> HttpServerLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> HttpServer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> serve</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token operator">:</span><span class="token plain"> HttpRoute</span><span class="token punctuation">,</span><span class="token plain"> host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> port</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> HttpServerLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> HttpServer</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">HttpServerLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainWebApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">HttpServer</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">    healthcheck</span><span class="token operator">:</span><span class="token plain"> HttpApp </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">HttpRequest</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      HttpResponse</span><span class="token punctuation">.</span><span class="token plain">ok</span><span class="token punctuation">(</span><span class="token string">&quot;up&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">    pingpong </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">HttpRequest</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> req </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">ifZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        req</span><span class="token punctuation">.</span><span class="token plain">body</span><span class="token punctuation">.</span><span class="token plain">via</span><span class="token punctuation">(</span><span class="token plain">ZPipeline</span><span class="token punctuation">.</span><span class="token plain">utf8Decode</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">runHead</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">contains</span><span class="token punctuation">(</span><span class="token string">&quot;ping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        onTrue </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">HttpResponse</span><span class="token punctuation">.</span><span class="token plain">ok</span><span class="token punctuation">(</span><span class="token string">&quot;pong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        onFalse </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">HttpResponse</span><span class="token punctuation">.</span><span class="token plain">error</span><span class="token punctuation">(</span><span class="token string">&quot;bad request&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">    map </span><span class="token operator">=</span><span class="token plain"> Map</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token string">&quot;/healthcheck&quot;</span><span class="token plain"> </span><span class="token operator">-&gt;</span><span class="token plain"> healthcheck</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token string">&quot;/pingpong&quot;</span><span class="token plain"> </span><span class="token operator">-&gt;</span><span class="token plain"> pingpong</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> HttpServer</span><span class="token punctuation">.</span><span class="token plain">serve</span><span class="token punctuation">(</span><span class="token plain">map</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">HttpServerLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>In a database application, a service may be defined only to operate in the context of a larger database transaction. In such a case, the transaction could be stored in the environment: <code>ZIO[DatabaseTransaction, ...]</code>. As in the previous example, because this is part of the semantics of the trait itself (whose functionality all operates within a transaction), this is not leaking implementation details, and therefore it is valid:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> DatabaseTransaction </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> put</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> DatabaseTransaction </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DatabaseTransaction</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> put</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DatabaseTransaction</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">put</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> atomically</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">zio</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DatabaseTransaction</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> atomically</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">zio</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DatabaseTransaction</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Database</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">atomically</span><span class="token punctuation">(</span><span class="token plain">zio</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> DatabaseLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> atomically</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">zio</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">DatabaseTransaction</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> DatabaseLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer </span><span class="token operator">=</span><span class="token plain"> ZLayer</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">DatabaseLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainDatabaseApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Database</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Database</span><span class="token punctuation">.</span><span class="token plain">atomically</span><span class="token punctuation">(</span><span class="token plain">DatabaseTransaction</span><span class="token punctuation">.</span><span class="token plain">put</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">foreachPar</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Database</span><span class="token punctuation">.</span><span class="token plain">atomically</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            value </span><span class="token keyword">&lt;-</span><span class="token plain"> DatabaseTransaction</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            _ </span><span class="token keyword">&lt;-</span><span class="token plain"> DatabaseTransaction</span><span class="token punctuation">.</span><span class="token plain">put</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">,</span><span class="token plain"> value </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">DatabaseLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So while it&#x27;s better to err on the side of &quot;don&#x27;t put things into the environment of service interface&quot;, there are cases where it&#x27;s acceptable.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/reference/contextual/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/reference/schedule/examples"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Examples</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reference/contextual/zenvironment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ZEnvironment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-zio-environment" class="table-of-contents__link toc-highlight">1. ZIO Environment</a><ul><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#advantage-of-using-zio-environment" class="table-of-contents__link toc-highlight">Advantage of Using ZIO Environment</a></li><li><a href="#accessing-zio-environment" class="table-of-contents__link toc-highlight">Accessing ZIO Environment</a></li></ul></li><li><a href="#2-zenvironment" class="table-of-contents__link toc-highlight">2. ZEnvironment</a></li><li><a href="#3-zlayer" class="table-of-contents__link toc-highlight">3. ZLayer</a></li><li><a href="#defining-zio-services" class="table-of-contents__link toc-highlight">Defining ZIO Services</a><ul><li><a href="#defining-services-in-oop" class="table-of-contents__link toc-highlight">Defining Services in OOP</a></li><li><a href="#defining-services-in-zio" class="table-of-contents__link toc-highlight">Defining Services in ZIO</a></li><li><a href="#service-pattern" class="table-of-contents__link toc-highlight">Service Pattern</a></li><li><a href="#defining-polymorphic-services-in-zio" class="table-of-contents__link toc-highlight">Defining Polymorphic Services in ZIO</a></li><li><a href="#generating-accessor-methods-using-macros" class="table-of-contents__link toc-highlight">Generating Accessor Methods Using Macros</a></li><li><a href="#the-three-laws-of-zio-environment" class="table-of-contents__link toc-highlight">The Three Laws of ZIO Environment</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.769a9ae6.js"></script>
<script src="/assets/js/main.0d7a2020.js"></script>
</body>
</html>