<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-react-helmet="true">Scope | ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zio.dev/next/datatypes/resource/scope"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Scope | ZIO"><meta data-react-helmet="true" name="description" content="The Scope data type is the foundation of safe and composable resources handling in ZIO."><meta data-react-helmet="true" property="og:description" content="The Scope data type is the foundation of safe and composable resources handling in ZIO."><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://zio.dev/next/datatypes/resource/scope"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/datatypes/resource/scope" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/datatypes/resource/scope" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.6feee118.css">
<link rel="preload" href="/assets/js/runtime~main.183b2960.js" as="script">
<link rel="preload" href="/assets/js/main.eb82bc51.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/version-1.x/overview/">Overview</a><a class="navbar__item navbar__link" href="/version-1.x/datatypes/">Data Types</a><a class="navbar__item navbar__link" href="/version-1.x/usecases/">Use Cases</a><a class="navbar__item navbar__link" href="/version-1.x/howto/">How to</a><a class="navbar__item navbar__link" href="/version-1.x/resources/">Resources</a><a class="navbar__item navbar__link" href="/version-1.x/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/next/overview/">ZIO 2.x (WIP)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/datatypes/resource/scope">ZIO 2.x (WIP)</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/core/zio/">Core Data Types</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/contextual/">Contextual Types</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/fiber/">Concurrency</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/next/datatypes/resource/">Resource Management</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/resource/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/next/datatypes/resource/scope">Scope</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/resource/zpool">ZPool</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/stream/">Streaming</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/metrics/">Metrics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/test/">ZIO Test</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/misc/chunk">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->ZIO<!-- --> <b>ZIO 2.x (WIP)</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/version-1.x/overview/">latest version</a></b> (<!-- -->ZIO 1.x<!-- -->).</div></div><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->ZIO 2.x (WIP)</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Scope</h1></header><p>The <code>Scope</code> data type is the foundation of safe and composable resources handling in ZIO.</p><p>Conceptually, a scope represents the lifetime of one or more resources. The resources can be used in the scope and are guaranteed to be released when the scope is closed.</p><p>The <code>Scope</code> data type takes this idea and represents it as a first class value.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">trait Scope {</span><br></span><span class="token-line"><span class="token plain">  def addFinalizerExit(finalizer: Exit[Any, Any] =&gt; UIO[Any]): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">  def close(exit: =&gt; Exit[Any, Any]): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>addFinalizerExit</code> operator lets us add a finalizer to the <code>Scope</code>. The <code>close</code> operator closes the scope, running all the finalizers that have been added to the scope.</p><p>In combination with the ZIO environment, <code>Scope</code> gives us an extremely powerful way to manage resources.</p><p>We can define a resource using operators such as <code>ZIO.acquireRelease</code>, which lets us construct a scoped value from an <code>acquire</code> and <code>release</code> workflow. For example, here is how we might define a simple resource:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import java.io.IOException</span><br></span><span class="token-line"><span class="token plain">import scala.io._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def acquire(name: =&gt; String): ZIO[Any, IOException, Source] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.attemptBlockingIO(Source.fromFile(name))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def release(source: =&gt; Source): ZIO[Any, Nothing, Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.succeedBlocking(source.close())</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def source(name: =&gt; String): ZIO[Scope, IOException, Source] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.acquireRelease(acquire(name))(release(_))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Notice that the <code>acquireRelease</code> operator added a <code>Scope</code> to the environment required by the workflow. This indicates that this workflow needs a <code>Scope</code> to be run and will add a finalizer that will close the resource when the scope is closed.</p><p>We can continue working with the resource as long as we want by using <code>flatMap</code> or other <code>ZIO</code> operators. For example, here is how we might read the contents of a file:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">source(&quot;cool.txt&quot;).flatMap { source =&gt;</span><br></span><span class="token-line"><span class="token plain">  ZIO.attemptBlockingIO(source.getLines())</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain">// res1: ZIO[Scope, IOException, Iterator[String]] = &lt;function1&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When we are done working with the file we can close the scope using the <code>ZIO.scoped</code> operator, which creates a new <code>Scope</code>, provides it to the workflow, and closes the <code>Scope</code> when the workflow is done.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def contents(name: =&gt; String): ZIO[Any, IOException, Chunk[String]] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.scoped {</span><br></span><span class="token-line"><span class="token plain">    source(name).flatMap { source =&gt;</span><br></span><span class="token-line"><span class="token plain">      ZIO.attemptBlockingIO(Chunk.fromIterator(source.getLines()))</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>scoped</code> operator removes the <code>Scope</code> from the environment, indicating that there are no longer any resources used by this workflow which require a scope. We now have a workflow that is ready to run.</p><p>In some cases ZIO applications may provide a <code>Scope</code> for us for resources that we don&#x27;t specify a scope for. For example <code>ZIOApp</code> provides a <code>Scope</code> for our entire application and ZIO Test provides a <code>Scope</code> for each test.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="defining-resources">Defining Resources<a class="hash-link" href="#defining-resources" title="Direct link to heading">â€‹</a></h2><p>We have already seen the <code>acquireRelease</code> operator, which is one of the most fundamental operators for creating scoped resources.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">object ZIO {</span><br></span><span class="token-line"><span class="token plain">  def acquireRelease[R, E, A](acquire: =&gt; ZIO[R, E, A])(release: A =&gt; ZIO[R, Nothing, Any]): ZIO[R with Scope, E, A] =</span><br></span><span class="token-line"><span class="token plain">    ???</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>acquireRelease</code> operator performs the <code>acquire</code> workflow uninterruptibly. This is important because if we allowed interruption during resource acquisition we could be interrupted when the resource was partially acquired.</p><p>The guarantee of the <code>acquireRelease</code> operator is that if the <code>acquire</code> workflow successfully completes execution then the <code>release</code> workflow is guaranteed to be run when the <code>Scope</code> is closed.</p><p>In addition to the <code>acquireRelease</code> operator, there is a more powerful variant called <code>acquireReleaseExit</code> that lets the finalizer depend on the <code>Exit</code> value that the <code>Scope</code> is closed with. This can be useful if we want to run a different finalizer depending on whether the <code>Scope</code> was closed with a success or a failure.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">object ZIO {</span><br></span><span class="token-line"><span class="token plain">  def acquireReleaseExit[R, E, A](acquire: =&gt; ZIO[R, E, A])(release: (A, Exit[Any, Any]) =&gt; ZIO[R, Nothing, Any]): ZIO[R with Scope, E, A] =</span><br></span><span class="token-line"><span class="token plain">    ???</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>There is also another family of operators to be aware of that allow the <code>acquire</code> workflow to be interrupted.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">object ZIO {</span><br></span><span class="token-line"><span class="token plain">  def acquireReleaseInterruptible[R, E, A](acquire: =&gt; ZIO[R, E, A])(release: ZIO[R, Nothing, Any]): ZIO[R with Scope, E, A] =</span><br></span><span class="token-line"><span class="token plain">    ???</span><br></span><span class="token-line"><span class="token plain">  def acquireReleaseInterruptibleExit[R, E, A](acquire: =&gt; ZIO[R, E, A])(release: Exit[Any, Any] =&gt; ZIO[R, Nothing, Any]): ZIO[R with Scope, E, A] =</span><br></span><span class="token-line"><span class="token plain">    ???</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this case the <code>release</code> workflow is not allowed to depend on the resource, since the <code>acquire</code> workflow might be interrupted after partially acquiring the resource. The <code>release</code> workflow is responsible for independently determining what finalization is required, for example by inspecting in-memory state.</p><p>This is a more advanced variant so we should generally use the standard <code>acquireRelease</code> operator. However, the <code>acquireReleaseInterruptible</code> operator can be very useful to describe more advanced resource acquisition scenarios where part of the acquisition can be interruptible.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="converting-resources-into-other-zio-data-types">Converting Resources Into Other ZIO Data Types<a class="hash-link" href="#converting-resources-into-other-zio-data-types" title="Direct link to heading">â€‹</a></h2><p>We will commonly want to convert scoped resources into other ZIO data types, particularly <code>ZLayer</code> for dependency injection and <code>ZStream</code>, <code>ZSink</code>, and <code>ZChannel</code> for streaming.</p><p>We can easily do this using the <code>scoped</code> constructor on each of these data types. For example, here is how we might convert the <code>source</code> resource above into a <code>ZStream</code> of the contents:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio.stream._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def lines(name: =&gt; String): ZStream[Any, IOException, String] =</span><br></span><span class="token-line"><span class="token plain">  ZStream.scoped(source(name)).flatMap { source =&gt;</span><br></span><span class="token-line"><span class="token plain">    ZStream.fromIteratorSucceed(source.getLines())</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Just like the <code>scoped</code> operator on <code>ZIO</code>, the <code>scoped</code> operator on <code>ZStream</code> removes the <code>Scope</code> from the environment, indicating that there are no longer any resources used by this workflow which require a scope.</p><p>The lifetime of these resources will now be governed by the lifetime of the stream, which generally means that the resources will be released as soon as we are done pulling from the stream. This lets the lifetime of these resources be managed by various stream operators to release those resources as efficiently as possible, for example releasing resources associated with each stream as soon as we are done with that stream when we merge two streams.</p><p>Similarly, we can convert a scoped resource into a <code>ZLayer</code> by using the <code>scoped</code> constructor on <code>ZLayer</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def sourceLayer(name: =&gt; String): ZLayer[Any, IOException, Source] =</span><br></span><span class="token-line"><span class="token plain">  ZLayer.scoped(source(name))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Again, the <code>Scope</code> has been removed from the environment, indicating that the lifetime of this resource will no longer be governed by the <code>Scope</code> but by the lifetime of the layer. In this case, that means the resource will be released as soon as the workflow that the layer is provided to completes execution, whether by success, failure, or interruption.</p><p>We should generally use the <code>scoped</code> operators on other ZIO data types to convert a scoped resource into a value of that data type. Having the lifetime of resources governed by the lifetime of those data types makes our code simpler and easier to reason about.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="controlling-finalizer-ordering">Controlling Finalizer Ordering<a class="hash-link" href="#controlling-finalizer-ordering" title="Direct link to heading">â€‹</a></h2><p>By default, when a <code>Scope</code> is closed all finalizers added to that <code>Scope</code> will be closed in the reverse of the order in which those finalizers were added to the <code>Scope</code>.</p><p>Releasing resources in the reverse order in which they were acquired makes sense because a resource that was acquired first may be necessary for a later acquired resource to be closed.</p><p>For example, if we open a network connection and then open a file on a remote server we need to close the file before closing the network connection. Otherwise we would no longer be able to interact with the remote server to close the file!</p><p>Therefore, in most cases we don&#x27;t have to do anything with regard to order of finalizers. However, in some cases we may want to run finalizers in parallel instead of sequentially, for example when the resources were also acquired in parallel.</p><p>For this we can use the <code>ZIO.parallelFinalizers</code> operator to indicate that finalizers should be run in parallel instead of sequentially when a scope is closed. Here is how we could use it to implement an operator that acquires and releases two resources in parallel.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def zipScoped[R &lt;: Scope, E, A, B](</span><br></span><span class="token-line"><span class="token plain">  left: ZIO[R, E, A],</span><br></span><span class="token-line"><span class="token plain">  right: ZIO[R, E, B]</span><br></span><span class="token-line"><span class="token plain">): ZIO[R, E, (A, B)] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.parallelFinalizers(left.zipPar(right))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>zipPar</code> operator on <code>ZIO</code> takes care of acquiring the resources in parallel and the <code>parallelFinalizers</code> operator handles releasing them in parallel. This makes it easy for us to do parallel resource acquisition by leveraging the powerful concurrency operators that already exist on <code>ZIO</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="advanced-scope-operators">Advanced Scope Operators<a class="hash-link" href="#advanced-scope-operators" title="Direct link to heading">â€‹</a></h2><p>So far we have seen that while <code>Scope</code> is the foundation of safe and composable resource handling in ZIO, we don&#x27;t actually need to work with the <code>Scope</code> data type directly other than being able to inpect the type signature to see if a workflow is scoped.</p><p>In most cases we just use the <code>acquireRelease</code> constructor or one of its variants to construct our resource and either work with the resource and close its scope using <code>ZIO.scoped</code> or convert the resource into another ZIO data type using an operator such as <code>ZSteam.scoped</code> or <code>ZLayer.scoped</code>. However, for more advanced use cases we may need to work with scopes directly and <code>Scope</code> has several useful operators for helping us do so.</p><p>First, we can <code>use</code> a <code>Scope</code> by providing it to a workflow that needs a <code>Scope</code> and closing the <code>Scope</code> immediately after. This is analogous to the <code>ZIO.scoped</code> operator.</p><p>Second, we can use the <code>extend</code> operator on <code>Scope</code> to provide a workflow with a scope without closing it afterwards. This allows us to extend the lifetime of a scoped resource to the lifetime of a scope, effectively allowing us to &quot;extend&quot; the lifetime of that resource.</p><p>Third, we can <code>close</code> a <code>Scope</code>. One thing to note here is that by default only the creator of a <code>Scope</code> can close it.</p><p>Creating a new <code>Scope</code> returns a <code>Scope.Closeable</code> which can be closed. Normally users of a <code>Scope</code> will only be provided with a <code>Scope</code> which does not expose a <code>close</code> operator.</p><p>This way the creator of a <code>Scope</code> can be sure that someone else will not &quot;pull the rug out from under them&quot; by closing the scope prematurely.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/datatypes/resource/scope.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/next/datatypes/resource/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/next/datatypes/resource/zpool"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ZPool</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#defining-resources" class="table-of-contents__link toc-highlight">Defining Resources</a></li><li><a href="#converting-resources-into-other-zio-data-types" class="table-of-contents__link toc-highlight">Converting Resources Into Other ZIO Data Types</a></li><li><a href="#controlling-finalizer-ordering" class="table-of-contents__link toc-highlight">Controlling Finalizer Ordering</a></li><li><a href="#advanced-scope-operators" class="table-of-contents__link toc-highlight">Advanced Scope Operators</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.183b2960.js"></script>
<script src="/assets/js/main.eb82bc51.js"></script>
</body>
</html>