<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-react-helmet="true">ZSink | ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zio.dev/next/datatypes/stream/zsink"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ZSink | ZIO"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://zio.dev/next/datatypes/stream/zsink"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/datatypes/stream/zsink" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/datatypes/stream/zsink" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b999c5ee.css">
<link rel="preload" href="/assets/js/runtime~main.7f3e08ea.js" as="script">
<link rel="preload" href="/assets/js/main.84c81040.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_TMUO themedImage--dark_uzRr"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/version-1.x/overview/overview_index">Overview</a><a class="navbar__item navbar__link" href="/version-1.x/datatypes/index">Data Types</a><a class="navbar__item navbar__link" href="/version-1.x/usecases/usecases_index">Use Cases</a><a class="navbar__item navbar__link" href="/version-1.x/howto/index">How to</a><a class="navbar__item navbar__link" href="/version-1.x/resources/index">Resources</a><a class="navbar__item navbar__link" href="/version-1.x/about/about_index">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/next/overview/overview_index">ZIO 2.x (WIP)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/datatypes/stream/zsink">ZIO 2.x (WIP)</a></li><li><a class="dropdown__link" href="/version-1.x/datatypes/stream/zsink">ZIO 1.x</a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Core Data Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contextual Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concurrency</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Resource Management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Streaming</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stream/index">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Main Components</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">ZStream</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">ZPipeline</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">ZSink</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/next/datatypes/stream/zsink">ZSink</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stream/sink">Sink</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stream/subscription-ref">SubscriptionRef</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Metrics</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Miscellaneous</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->ZIO<!-- --> <b>ZIO 2.x (WIP)</b> version.</div><div class="margin-top--md">See here for the <b><a href="/version-1.x/datatypes/stream/zsink">latest version</a></b> of ZIO (<!-- -->ZIO 1.x<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->ZIO 2.x (WIP)</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZSink</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="introduction">Introduction<a aria-hidden="true" class="hash-link" href="#introduction" title="Direct link to heading">â€‹</a></h2><p>A <code>ZSink[R, E, I, L, Z]</code> is used to consume elements produced by a <code>ZStream</code>. You can think of a sink as a function that will consume a variable amount of <code>I</code> elements (could be 0, 1, or many!), might fail with an error of type <code>E</code>, and will eventually yield a value of type <code>Z</code> together with a remainder of type <code>L</code> as leftover.</p><p>To consume a stream using <code>ZSink</code> we can pass <code>ZSink</code> to the <code>ZStream#run</code> function:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stream._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val stream = ZStream.fromIterable(1 to 1000)</span><br></span><span class="token-line"><span class="token plain">val sink   = ZSink.sum[Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">val sum    = stream.run(sink)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="creating-sinks">Creating sinks<a aria-hidden="true" class="hash-link" href="#creating-sinks" title="Direct link to heading">â€‹</a></h2><p>The <code>zio.stream</code> provides numerous kinds of sinks to use.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="common-constructors">Common Constructors<a aria-hidden="true" class="hash-link" href="#common-constructors" title="Direct link to heading">â€‹</a></h3><p><strong>ZSink.head</strong> â€” It creates a sink containing the first element, returns <code>None</code> for empty streams:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val sink: ZSink[Any, Nothing, Int, Nothing, Int, Option[Int]] = ZSink.head[Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">val head: ZIO[Any, Nothing, Option[Int]]             = ZStream(1, 2, 3, 4).run(sink)</span><br></span><span class="token-line"><span class="token plain">// Result: Some(1)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.last</strong> â€” It consumes all elements of a stream and returns the last element of the stream:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val sink: ZSink[Any, Nothing, Int, Nothing, Int, Option[Int]] = ZSink.last[Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">val last: ZIO[Any, Nothing, Option[Int]]                 = ZStream(1, 2, 3, 4).run(sink)</span><br></span><span class="token-line"><span class="token plain">// Result: Some(4)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.count</strong> â€” A sink that consumes all elements of the stream and counts the number of elements fed to it:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val sink : ZSink[Any, Nothing, Int, Nothing, Nothing, Int] = ZSink.sum[Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">val count: ZIO[Any, Nothing, Int]                 = ZStream(1, 2, 3, 4, 5).run(sink)</span><br></span><span class="token-line"><span class="token plain">// Result: 5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.sum</strong> â€” A sink that consumes all elements of the stream and sums incoming numeric values:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val sink : ZSink[Any, Nothing, Int, Nothing, Nothing, Int] = ZSink.sum[Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">val sum: ZIO[Any, Nothing, Int]                 = ZStream(1, 2, 3, 4, 5).run(sink)</span><br></span><span class="token-line"><span class="token plain">// Result: 15</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.take</strong> â€” A sink that takes the specified number of values and result in a <code>Chunk</code> data type:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val sink  : ZSink[Any, Nothing, Int, Nothing, Int, Chunk[Int]] = ZSink.take[Nothing, Int](3)</span><br></span><span class="token-line"><span class="token plain">val stream: ZIO[Any, Nothing, Chunk[Int]]             = ZStream(1, 2, 3, 4, 5).run(sink)</span><br></span><span class="token-line"><span class="token plain">// Result: Chunk(1, 2, 3)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.drain</strong> â€” A sink that ignores its inputs:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val drain: ZSink[Any, Nothing, Any, Nothing, Nothing, Unit] = ZSink.drain</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.timed</strong> â€” A sink that executes the stream and times its execution:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val timed: ZSink[Has[Clock], Nothing, Any, Nothing, Nothing, Duration] = ZSink.timed</span><br></span><span class="token-line"><span class="token plain">val stream: ZIO[Has[Clock], Nothing, Long] =</span><br></span><span class="token-line"><span class="token plain">  ZStream(1, 2, 3, 4, 5).fixed(2.seconds).run(timed).map(_.getSeconds)</span><br></span><span class="token-line"><span class="token plain">// Result: 10</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.foreach</strong> â€” A sink that executes the provided effectful function for every element fed to it:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val printer: ZSink[Has[Console], IOException, Int, IOException, Int, Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZSink.foreach((i: Int) =&gt; printLine(i))</span><br></span><span class="token-line"><span class="token plain">val stream : ZIO[Has[Console], IOException, Unit]             =</span><br></span><span class="token-line"><span class="token plain">  ZStream(1, 2, 3, 4, 5).run(printer)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-success-and-failure">From Success and Failure<a aria-hidden="true" class="hash-link" href="#from-success-and-failure" title="Direct link to heading">â€‹</a></h3><p>Similar to the <code>ZStream</code> data type, we can create a <code>ZSink</code> using <code>fail</code> and <code>succeed</code> methods.</p><p>A sink that doesn&#x27;t consume any element from its upstream and successes with a value of <code>Int</code> type:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val succeed: ZSink[Any, Any, Any, Nothing, Nothing, Int] = ZSink.succeed(5)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A sink that doesn&#x27;t consume any element from its upstream and intentionally fails with a message of <code>String</code> type:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val failed : ZSink[Any, Any, Any, String, Nothing, Nothing] = ZSink.fail(&quot;fail!&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="collecting">Collecting<a aria-hidden="true" class="hash-link" href="#collecting" title="Direct link to heading">â€‹</a></h3><p>To create a sink that collects all elements of a stream into a <code>Chunk[A]</code>, we can use <code>ZSink.collectAll</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val stream    : UStream[Int]    = UStream(1, 2, 3, 4, 5)</span><br></span><span class="token-line"><span class="token plain">val collection: UIO[Chunk[Int]] = stream.run(ZSink.collectAll[Nothing, Int])</span><br></span><span class="token-line"><span class="token plain">// Output: Chunk(1, 2, 3, 4, 5)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can collect all elements into a <code>Set</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val collectAllToSet: ZSink[Any, Nothing, Int, Nothing, Nothing, Set[Int]] = ZSink.collectAllToSet[Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">val stream: ZIO[Any, Nothing, Set[Int]] = ZStream(1, 3, 2, 3, 1, 5, 1).run(collectAllToSet)</span><br></span><span class="token-line"><span class="token plain">// Output: Set(1, 3, 2, 5)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Or we can collect and merge them into a <code>Map[K, A]</code> using a merge function. In the following example, we use <code>(_:Int) % 3</code> to determine map keys and, we provide <code>_ + _</code> function to merge multiple elements with the same key:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val collectAllToMap: ZSink[Any, Nothing, Int, Nothing, Nothing, Map[Int, Int]] = ZSink.collectAllToMap((_: Int) % 3)(_ + _)</span><br></span><span class="token-line"><span class="token plain">val stream: ZIO[Any, Nothing, Map[Int, Int]] = ZStream(1, 3, 2, 3, 1, 5, 1).run(collectAllToMap)</span><br></span><span class="token-line"><span class="token plain">// Output: Map(1 -&gt; 3, 0 -&gt; 6, 2 -&gt; 7)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.collectAllN</strong> â€” Collects incoming values into chunk of maximum size of <code>n</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, 2, 3, 4, 5).run(</span><br></span><span class="token-line"><span class="token plain">  ZSink.collectAllN(3)</span><br></span><span class="token-line"><span class="token plain">)</span><br></span><span class="token-line"><span class="token plain">// Output: Chunk(1,2,3), Chunk(4,5)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.collectAllWhile</strong> â€” Accumulates incoming elements into a chunk as long as they verify the given predicate:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, 2, 0, 4, 0, 6, 7).run(</span><br></span><span class="token-line"><span class="token plain">  ZSink.collectAllWhile(_ != 0)</span><br></span><span class="token-line"><span class="token plain">)</span><br></span><span class="token-line"><span class="token plain">// Output: Chunk(1,2), Chunk(4), Chunk(6,7)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.collectAllToMapN</strong> â€” Creates a sink accumulating incoming values into maps of up to <code>n</code> keys. Elements are mapped to keys using the function <code>key</code>; elements mapped to the same key will be merged with the function <code>f</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">object ZSink {</span><br></span><span class="token-line"><span class="token plain">  def collectAllToMapN[Err, In, K](</span><br></span><span class="token-line"><span class="token plain">    n: Long</span><br></span><span class="token-line"><span class="token plain">  )(key: In =&gt; K)(f: (In, In) =&gt; In): ZSink[Any, Err, In, Err, In, Map[K, In]]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let&#x27;s do an example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, 2, 0, 4, 5).run(</span><br></span><span class="token-line"><span class="token plain">  ZSink.collectAllToMapN[Nothing, Int, Int](10)(_ % 3)(_ + _)</span><br></span><span class="token-line"><span class="token plain">)</span><br></span><span class="token-line"><span class="token plain">// Output: Map(1 -&gt; 5, 2 -&gt; 7, 0 -&gt; 0)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.collectAllToSetN</strong> â€” Creates a sink accumulating incoming values into sets of maximum size <code>n</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, 2, 1, 2, 1, 3, 0, 5, 0, 2).run(</span><br></span><span class="token-line"><span class="token plain">  ZSink.collectAllToSetN(3)</span><br></span><span class="token-line"><span class="token plain">)</span><br></span><span class="token-line"><span class="token plain">// Output: Set(1,2,3), Set(0,5,2), Set(1)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="folding">Folding<a aria-hidden="true" class="hash-link" href="#folding" title="Direct link to heading">â€‹</a></h3><p>Basic fold accumulation of received elements:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZSink.foldLeft[Nothing, Int, Int](0)(_ + _)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A fold with short-circuiting has a termination predicate that determines the end of the folding process:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream.iterate(0)(_ + 1).run(</span><br></span><span class="token-line"><span class="token plain">  ZSink.fold(0)(sum =&gt; sum &lt;= 10)((acc, n: Int) =&gt; acc + n)</span><br></span><span class="token-line"><span class="token plain">)</span><br></span><span class="token-line"><span class="token plain">// Output: 15</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.foldWeighted</strong> â€” Creates a sink that folds incoming elements until reaches the <code>max</code> worth of elements determined by the <code>costFn</code>, then the pipeline emits the computed value and restarts the folding process:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">object ZSink {</span><br></span><span class="token-line"><span class="token plain">  def foldWeighted[Err, In, S](z: S)(costFn: (S, In) =&gt; Long, max: Long)(</span><br></span><span class="token-line"><span class="token plain">    f: (S, In) =&gt; S</span><br></span><span class="token-line"><span class="token plain">  ): ZSink[Any, Err, In, Err, In, S] = ???</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the following example, each time we consume a new element we return one as the weight of that element using cost function. After three times, the sum of the weights reaches to the <code>max</code> number, and the folding process restarted. So we expect this pipeline to group each three elements in one <code>Chunk</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(3, 2, 4, 1, 5, 6, 2, 1, 3, 5, 6)</span><br></span><span class="token-line"><span class="token plain">  .transduce(</span><br></span><span class="token-line"><span class="token plain">    ZSink</span><br></span><span class="token-line"><span class="token plain">      .foldWeighted(Chunk[Int]())(</span><br></span><span class="token-line"><span class="token plain">        (_, _: Int) =&gt; 1,</span><br></span><span class="token-line"><span class="token plain">        3</span><br></span><span class="token-line"><span class="token plain">      ) { (acc, el) =&gt;</span><br></span><span class="token-line"><span class="token plain">        acc ++ Chunk(el)</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">// Output: Chunk(3,2,4),Chunk(1,5,6),Chunk(2,1,3),Chunk(5,6)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Another example is when we want to group element which sum of them equal or less than a specific number:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, 2, 2, 4, 2, 1, 1, 1, 0, 2, 1, 2)</span><br></span><span class="token-line"><span class="token plain">  .transduce(</span><br></span><span class="token-line"><span class="token plain">    ZSink</span><br></span><span class="token-line"><span class="token plain">      .foldWeighted(Chunk[Int]())(</span><br></span><span class="token-line"><span class="token plain">        (_, i: Int) =&gt; i.toLong,</span><br></span><span class="token-line"><span class="token plain">        5</span><br></span><span class="token-line"><span class="token plain">      ) { (acc, el) =&gt;</span><br></span><span class="token-line"><span class="token plain">        acc ++ Chunk(el)</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">// Output: Chunk(1,2,2),Chunk(4),Chunk(2,1,1,1,0),Chunk(2,1,2)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p><em><strong>Note</strong></em></p><p>The <code>ZSink.foldWeighted</code> cannot decompose elements whose weight is more than the <code>max</code> number. So elements that have an individual cost larger than <code>max</code> will force the pipeline to cross the <code>max</code> cost. In the last example, if the source stream was <code>ZStream(1, 2, 2, 4, 2, 1, 6, 1, 0, 2, 1, 2)</code> the output would be <code>Chunk(1,2,2),Chunk(4),Chunk(2,1),Chunk(6),Chunk(1,0,2,1),Chunk(2)</code>. As we see, the <code>6</code> element crossed the <code>max</code> cost.</p><p>To decompose these elements, we should use <code>ZSink.foldWeightedDecompose</code> function.</p></blockquote><p><strong>ZSink.foldWeightedDecompose</strong> â€” As we saw in the previous section, we need a way to decompose elements â€” whose cause the output aggregate cross the <code>max</code> â€” into smaller elements. This version of fold takes <code>decompose</code> function and enables us to do that:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">object ZSink {</span><br></span><span class="token-line"><span class="token plain">  def foldWeightedDecompose[Err, In, S](</span><br></span><span class="token-line"><span class="token plain">     z: S</span><br></span><span class="token-line"><span class="token plain">   )(costFn: (S, In) =&gt; Long, max: Long, decompose: In =&gt; Chunk[In])(</span><br></span><span class="token-line"><span class="token plain">     f: (S, In) =&gt; S</span><br></span><span class="token-line"><span class="token plain">   ): ZSink[Any, Err, In, Err, In, S] = ???</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the following example, we are break down elements that are bigger than 5, using <code>decompose</code> function:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, 2, 2, 2, 1, 6, 1, 7, 2, 1, 2)</span><br></span><span class="token-line"><span class="token plain">  .transduce(</span><br></span><span class="token-line"><span class="token plain">    ZSink</span><br></span><span class="token-line"><span class="token plain">      .foldWeightedDecompose(Chunk[Int]())(</span><br></span><span class="token-line"><span class="token plain">        (_, i: Int) =&gt; i.toLong,</span><br></span><span class="token-line"><span class="token plain">        5,</span><br></span><span class="token-line"><span class="token plain">        (i: Int) =&gt;</span><br></span><span class="token-line"><span class="token plain">          if (i &gt; 5) Chunk(i - 1, 1) else Chunk(i)</span><br></span><span class="token-line"><span class="token plain">      )((acc, el) =&gt; acc ++ Chunk.succeed(el))</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">// Ouput: Chunk(1,2,2),Chunk(2,1),Chunk(5),Chunk(1,1),Chunk(5),Chunk(1,1,2,1),Chunk(2)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.foldUntil</strong> â€” Creates a sink that folds incoming element until specific <code>max</code> elements have been folded:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)</span><br></span><span class="token-line"><span class="token plain">  .run(ZSink.foldUntil(0, 3)(_ + _))</span><br></span><span class="token-line"><span class="token plain">// Output: 6, 15, 24, 10</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ZSink.foldLeft</strong> â€” This sink will fold the inputs until the stream ends, resulting in one element:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val stream: ZIO[Any, Nothing, Int] = </span><br></span><span class="token-line"><span class="token plain">  ZStream(1, 2, 3, 4).run(ZSink.foldLeft[Nothing, Int, Int](0)(_ + _))</span><br></span><span class="token-line"><span class="token plain">// Output: 10</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-effect">From Effect<a aria-hidden="true" class="hash-link" href="#from-effect" title="Direct link to heading">â€‹</a></h3><p>The <code>ZSink.fromEffect</code> creates a single-value sink produced from an effect:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val sink = ZSink.fromZIO(ZIO.succeed(1))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-file">From File<a aria-hidden="true" class="hash-link" href="#from-file" title="Direct link to heading">â€‹</a></h3><p>The <code>ZSink.fromFile</code> creates a file sink that consumes byte chunks and writes them to the specified file:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">def fileSink(path: Path): ZSink[Any, Throwable, String, Throwable, Byte, Long] =</span><br></span><span class="token-line"><span class="token plain">  ZSink</span><br></span><span class="token-line"><span class="token plain">    .fromFile(path)</span><br></span><span class="token-line"><span class="token plain">    .contramapChunks[String](_.flatMap(_.getBytes))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val result = ZStream(&quot;Hello&quot;, &quot;ZIO&quot;, &quot;World!&quot;)</span><br></span><span class="token-line"><span class="token plain">  .intersperse(&quot;\n&quot;)</span><br></span><span class="token-line"><span class="token plain">  .run(fileSink(Paths.get(&quot;file.txt&quot;)))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-outputstream">From OutputStream<a aria-hidden="true" class="hash-link" href="#from-outputstream" title="Direct link to heading">â€‹</a></h3><p>The <code>ZSink.fromOutputStream</code> creates a sink that consumes byte chunks and write them to the <code>OutputStream</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(&quot;Application&quot;, &quot;Error&quot;, &quot;Logs&quot;)</span><br></span><span class="token-line"><span class="token plain">  .intersperse(&quot;\n&quot;)</span><br></span><span class="token-line"><span class="token plain">  .run(</span><br></span><span class="token-line"><span class="token plain">    ZSink</span><br></span><span class="token-line"><span class="token plain">      .fromOutputStream(java.lang.System.err)</span><br></span><span class="token-line"><span class="token plain">      .contramapChunks[String](_.flatMap(_.getBytes))</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-queue">From Queue<a aria-hidden="true" class="hash-link" href="#from-queue" title="Direct link to heading">â€‹</a></h3><p>A queue has a finite or infinite buffer size, so they are useful in situations where we need to consume streams as fast as we can, and then do some batching operations on consumed messages. By using <code>ZSink.fromQueue</code> we can create a sink that is backed by a queue; it enqueues each element into the specified queue:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val myApp: ZIO[Has[Console] with Has[Clock], IOException, Unit] =</span><br></span><span class="token-line"><span class="token plain">  for {</span><br></span><span class="token-line"><span class="token plain">    queue    &lt;- ZQueue.bounded[Int](32)</span><br></span><span class="token-line"><span class="token plain">    producer &lt;- ZStream</span><br></span><span class="token-line"><span class="token plain">      .iterate(1)(_ + 1)</span><br></span><span class="token-line"><span class="token plain">      .fixed(200.millis)</span><br></span><span class="token-line"><span class="token plain">      .run(ZSink.fromQueue(queue))</span><br></span><span class="token-line"><span class="token plain">      .fork</span><br></span><span class="token-line"><span class="token plain">    consumer &lt;- queue.take.flatMap(printLine(_)).forever</span><br></span><span class="token-line"><span class="token plain">    _        &lt;- producer.zip(consumer).join</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-hub">From Hub<a aria-hidden="true" class="hash-link" href="#from-hub" title="Direct link to heading">â€‹</a></h3><p><code>Hub</code> is an asynchronous data type in which publisher can publish their messages to that and subscribers can subscribe to take messages from the <code>Hub</code>. The <code>ZSink.fromHub</code> takes a <code>ZHub</code> and returns a <code>ZSink</code> which publishes each element to that <code>ZHub</code>.</p><p>In the following example, the <code>sink</code> consumes elements of the <code>producer</code> stream and publishes them to the <code>hub</code>. We have two consumers that are subscribed to that hub and they are taking its elements forever:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val myApp: ZIO[Has[Console] with Has[Clock], IOException, Unit] =</span><br></span><span class="token-line"><span class="token plain">  for {</span><br></span><span class="token-line"><span class="token plain">    promise &lt;- Promise.make[Nothing, Unit]</span><br></span><span class="token-line"><span class="token plain">    hub &lt;- ZHub.bounded[Int](1)</span><br></span><span class="token-line"><span class="token plain">    sink &lt;- ZIO.succeed(ZSink.fromHub(hub))</span><br></span><span class="token-line"><span class="token plain">    producer &lt;- ZStream.iterate(0)(_ + 1).fixed(1.seconds).run(sink).fork</span><br></span><span class="token-line"><span class="token plain">    consumers &lt;- hub.subscribe.zip(hub.subscribe).use { case (left, right) =&gt;</span><br></span><span class="token-line"><span class="token plain">      for {</span><br></span><span class="token-line"><span class="token plain">        _ &lt;- promise.succeed(())</span><br></span><span class="token-line"><span class="token plain">        f1 &lt;- left.take.flatMap(e =&gt; printLine(s&quot;Left Queue: $e&quot;)).forever.fork</span><br></span><span class="token-line"><span class="token plain">        f2 &lt;- right.take.flatMap(e =&gt; printLine(s&quot;Right Queue: $e&quot;)).forever.fork</span><br></span><span class="token-line"><span class="token plain">        _ &lt;- f1.zip(f2).join</span><br></span><span class="token-line"><span class="token plain">      } yield ()</span><br></span><span class="token-line"><span class="token plain">    }.fork</span><br></span><span class="token-line"><span class="token plain">    _ &lt;- promise.await</span><br></span><span class="token-line"><span class="token plain">    _ &lt;- producer.zip(consumers).join</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="operations">Operations<a aria-hidden="true" class="hash-link" href="#operations" title="Direct link to heading">â€‹</a></h2><p>Having created the sink, we can transform it with provided operations.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="contramap">contramap<a aria-hidden="true" class="hash-link" href="#contramap" title="Direct link to heading">â€‹</a></h3><p>Contramap is a simple combinator to change the domain of an existing function. While <em>map</em> changes the co-domain of a function, the <em>contramap</em> changes the domain of a function. So the <em>contramap</em> takes a function and maps over its input.</p><p>This is useful when we have a fixed output, and our existing function cannot consume those outputs. So we can use <em>contramap</em> to create a new function that can consume that fixed output. Assume we have a <code>ZSink.sum</code> that sums incoming numeric values, but we have a <code>ZStream</code> of <code>String</code> values. We can convert the <code>ZSink.sum</code> to a sink that can consume <code>String</code> values;</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val numericSum: ZSink[Any, Nothing, Int, Nothing, Nothing, Int]    = </span><br></span><span class="token-line"><span class="token plain">  ZSink.sum[Nothing, Int]</span><br></span><span class="token-line"><span class="token plain">val stringSum : ZSink[Any, Nothing, String, Nothing, Nothing, Int] = </span><br></span><span class="token-line"><span class="token plain">  numericSum.contramap((x: String) =&gt; x.toInt)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val sum: ZIO[Any, Nothing, Int] =</span><br></span><span class="token-line"><span class="token plain">  ZStream(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;).run(stringSum)</span><br></span><span class="token-line"><span class="token plain">// Output: 15</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="dimap">dimap<a aria-hidden="true" class="hash-link" href="#dimap" title="Direct link to heading">â€‹</a></h3><p>A <code>dimap</code> is an extended <code>contramap</code> that additionally transforms sink&#x27;s output:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// Convert its input to integers, do the computation and then convert them back to a string</span><br></span><span class="token-line"><span class="token plain">val sumSink: ZSink[Any, Nothing, String, Nothing, Nothing, String] =</span><br></span><span class="token-line"><span class="token plain">  numericSum.dimap[String, String](_.toInt, _.toString)</span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">val sum: ZIO[Any, Nothing, String] =</span><br></span><span class="token-line"><span class="token plain">  ZStream(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;).run(sumSink)</span><br></span><span class="token-line"><span class="token plain">// Output: 15</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="filtering">Filtering<a aria-hidden="true" class="hash-link" href="#filtering" title="Direct link to heading">â€‹</a></h3><p>Sinks have <code>ZSink#filterInput</code> for filtering incoming elements:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZStream(1, -2, 0, 1, 3, -3, 4, 2, 0, 1, -3, 1, 1, 6)</span><br></span><span class="token-line"><span class="token plain">  .transduce(</span><br></span><span class="token-line"><span class="token plain">    ZSink</span><br></span><span class="token-line"><span class="token plain">      .collectAllN[Nothing, Int](3)</span><br></span><span class="token-line"><span class="token plain">      .filterInput[Int](_ &gt; 0)</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">// Output: Chunk(Chunk(1,1,3),Chunk(4,2,1),Chunk(1,1,6),Chunk())</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="concurrency-and-parallelism">Concurrency and Parallelism<a aria-hidden="true" class="hash-link" href="#concurrency-and-parallelism" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="parallel-zipping">Parallel Zipping<a aria-hidden="true" class="hash-link" href="#parallel-zipping" title="Direct link to heading">â€‹</a></h3><p>Like <code>ZStream</code>, two <code>ZSink</code> can be zipped together. Both of them will be run in parallel, and their results will be combined in a tuple:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val kafkaSink: ZSink[Any, Throwable, Record, Throwable, Record, Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZSink.foreach[Any, Throwable, Record](record =&gt; ZIO.attempt(???))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val pulsarSink: ZSink[Any, Throwable, Record, Throwable, Record, Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZSink.foreach[Any, Throwable, Record](record =&gt; ZIO.attempt(???))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val stream: ZSink[Any, Throwable, Record, Throwable, Record, Unit] =</span><br></span><span class="token-line"><span class="token plain">  kafkaSink zipPar pulsarSink </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="racing">Racing<a aria-hidden="true" class="hash-link" href="#racing" title="Direct link to heading">â€‹</a></h3><p>We are able to <code>race</code> multiple sinks, they will run in parallel, and the one that wins will provide the result of our program:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val stream: ZSink[Any, Throwable, Record, Throwable, Record, Unit] =</span><br></span><span class="token-line"><span class="token plain">  kafkaSink race pulsarSink </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To determine which one succeeded, we should use the <code>ZSink#raceBoth</code> combinator, it returns an <code>Either</code> result.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="leftovers">Leftovers<a aria-hidden="true" class="hash-link" href="#leftovers" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="exposing-leftovers">Exposing Leftovers<a aria-hidden="true" class="hash-link" href="#exposing-leftovers" title="Direct link to heading">â€‹</a></h3><p>A sink consumes a variable amount of <code>I</code> elements (zero or more) from the upstream. If the upstream is finite, we can expose leftover values by calling <code>ZSink#exposeLeftOver</code>. It returns a tuple that contains the result of the previous sink and its leftovers:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val s1: ZIO[Any, Nothing, (Chunk[Int], Chunk[Int])] =</span><br></span><span class="token-line"><span class="token plain">  ZStream(1, 2, 3, 4, 5).run(</span><br></span><span class="token-line"><span class="token plain">    ZSink.take(3).exposeLeftover</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">// Output: (Chunk(1, 2, 3), Chunk(4, 5))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val s2: ZIO[Any, Nothing, (Option[Int], Chunk[Int])] =</span><br></span><span class="token-line"><span class="token plain">  ZStream(1, 2, 3, 4, 5).run(</span><br></span><span class="token-line"><span class="token plain">    ZSink.head[Nothing, Int].exposeLeftover</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">// Output: (Some(1), Chunk(2, 3, 4, 5))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="dropping-leftovers">Dropping Leftovers<a aria-hidden="true" class="hash-link" href="#dropping-leftovers" title="Direct link to heading">â€‹</a></h3><p>If we don&#x27;t need leftovers, we can drop them by using <code>ZSink#dropLeftover</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">ZSink.take[Nothing, Int](3).dropLeftover</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/datatypes/stream/zsink.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/next/datatypes/stream/zpipeline"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->ZPipeline</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/next/datatypes/stream/sink"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Sink<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#creating-sinks" class="table-of-contents__link toc-highlight">Creating sinks</a><ul><li><a href="#common-constructors" class="table-of-contents__link toc-highlight">Common Constructors</a></li><li><a href="#from-success-and-failure" class="table-of-contents__link toc-highlight">From Success and Failure</a></li><li><a href="#collecting" class="table-of-contents__link toc-highlight">Collecting</a></li><li><a href="#folding" class="table-of-contents__link toc-highlight">Folding</a></li><li><a href="#from-effect" class="table-of-contents__link toc-highlight">From Effect</a></li><li><a href="#from-file" class="table-of-contents__link toc-highlight">From File</a></li><li><a href="#from-outputstream" class="table-of-contents__link toc-highlight">From OutputStream</a></li><li><a href="#from-queue" class="table-of-contents__link toc-highlight">From Queue</a></li><li><a href="#from-hub" class="table-of-contents__link toc-highlight">From Hub</a></li></ul></li><li><a href="#operations" class="table-of-contents__link toc-highlight">Operations</a><ul><li><a href="#contramap" class="table-of-contents__link toc-highlight">contramap</a></li><li><a href="#dimap" class="table-of-contents__link toc-highlight">dimap</a></li><li><a href="#filtering" class="table-of-contents__link toc-highlight">Filtering</a></li></ul></li><li><a href="#concurrency-and-parallelism" class="table-of-contents__link toc-highlight">Concurrency and Parallelism</a><ul><li><a href="#parallel-zipping" class="table-of-contents__link toc-highlight">Parallel Zipping</a></li><li><a href="#racing" class="table-of-contents__link toc-highlight">Racing</a></li></ul></li><li><a href="#leftovers" class="table-of-contents__link toc-highlight">Leftovers</a><ul><li><a href="#exposing-leftovers" class="table-of-contents__link toc-highlight">Exposing Leftovers</a></li><li><a href="#dropping-leftovers" class="table-of-contents__link toc-highlight">Dropping Leftovers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.7f3e08ea.js"></script>
<script src="/assets/js/main.84c81040.js"></script>
</body>
</html>