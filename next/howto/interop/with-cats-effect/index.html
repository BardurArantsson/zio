<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-react-helmet="true">How to Interop with Cats Effect? | ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zio.dev/next/howto/interop/with-cats-effect"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to Interop with Cats Effect? | ZIO"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://zio.dev/next/howto/interop/with-cats-effect"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/howto/interop/with-cats-effect" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/howto/interop/with-cats-effect" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b999c5ee.css">
<link rel="preload" href="/assets/js/runtime~main.7f3e08ea.js" as="script">
<link rel="preload" href="/assets/js/main.84c81040.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_TMUO themedImage--dark_uzRr"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/version-1.x/overview/overview_index">Overview</a><a class="navbar__item navbar__link" href="/version-1.x/datatypes/index">Data Types</a><a class="navbar__item navbar__link" href="/version-1.x/usecases/usecases_index">Use Cases</a><a class="navbar__item navbar__link" href="/version-1.x/howto/index">How to</a><a class="navbar__item navbar__link" href="/version-1.x/resources/index">Resources</a><a class="navbar__item navbar__link" href="/version-1.x/about/about_index">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/next/overview/overview_index">ZIO 2.x (WIP)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/howto/interop/with-cats-effect">ZIO 2.x (WIP)</a></li><li><a class="dropdown__link" href="/version-1.x/howto/interop/with-cats-effect">ZIO 1.x</a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How to</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Interop</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/next/howto/interop/with-cats-effect">How to Interop with Cats Effect?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-future">How to Interop with Future?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-java">How to Interop with Java?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-javascript">How to Interop with JavaScript?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-monix">How to Interop with Monix?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-scalaz-7x">How to Interop with Scalaz 7.x?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-reactive-streams">How to Interop with Reactive Streams?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-twitter">How to Interop with Twitter?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/interop/with-guava">How to Interop with Guava?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Migrate</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->ZIO<!-- --> <b>ZIO 2.x (WIP)</b> version.</div><div class="margin-top--md">See here for the <b><a href="/version-1.x/howto/interop/with-cats-effect">latest version</a></b> of ZIO (<!-- -->ZIO 1.x<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->ZIO 2.x (WIP)</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to Interop with Cats Effect?</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="introduction">Introduction<a aria-hidden="true" class="hash-link" href="#introduction" title="Direct link to heading">â€‹</a></h2><p><a href="https://github.com/zio/interop-cats" target="_blank" rel="noopener noreferrer"><code>interop-cats</code></a> has instances for the <a href="https://typelevel.org/cats/" target="_blank" rel="noopener noreferrer">Cats</a>, <a href="https://github.com/typelevel/cats-mtl" target="_blank" rel="noopener noreferrer">Cats MTL</a> and <a href="https://typelevel.org/cats-effect/" target="_blank" rel="noopener noreferrer">Cats Effect</a> libraries, which allow you to use ZIO with any libraries that rely on these, like <a href="https://github.com/tpolecat/doobie" target="_blank" rel="noopener noreferrer">Doobie</a>, <a href="https://github.com/http4s/http4s" target="_blank" rel="noopener noreferrer">Http4s</a>, <a href="https://github.com/functional-streams-for-scala/fs2" target="_blank" rel="noopener noreferrer">FS2</a> or <a href="https://github.com/circe/circe" target="_blank" rel="noopener noreferrer">Circe</a></p><p>Depends on which version of Cats Effect we are using, we should pick the right version of <code>zio-interop-cats</code>. In this tutorial, whenever we&#x27;re working with Cats Effect 2.x, we are using:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-interop-cats&quot; % &quot;2.5.1.0&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And whenever we are using Cats Effect 3.x instances, we are using:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-interop-cats&quot; % &quot;3.1.1.0&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Most of the interop functionality resides in the following package:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cats-effect-instances">Cats Effect Instances<a aria-hidden="true" class="hash-link" href="#cats-effect-instances" title="Direct link to heading">â€‹</a></h2><p>ZIO integrates with Typelevel libraries by providing instances of Cats Effect type classes. These type classes are used by <code>fs2</code>, <code>doobie</code>, <code>http4s</code>, and a variety of other libraries in the functional Scala ecosystem.</p><p>Due to the limitations of the Cats Effect, ZIO cannot provide instances for arbitrary error types. Instead, we can obtain instances only for effects whose error type extends <code>Throwable</code>.</p><p>For convenience, ZIO includes the <code>Task</code> and <code>RIO</code> type aliases, which fix the error type to <code>Throwable</code>, and may be useful for interop with Cats Effect:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.{ZIO, Task, RIO}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">type Task[+A]    = ZIO[Any, Throwable, A]</span><br></span><span class="token-line"><span class="token plain">type RIO[-R, +A] = ZIO[  R, Throwable, A]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="providing-runtime-manually">Providing Runtime Manually<a aria-hidden="true" class="hash-link" href="#providing-runtime-manually" title="Direct link to heading">â€‹</a></h3><p>To use Cats Effect instances for these types, we should have an implicit <code>Runtime[R]</code> in scope for the environment type of our effects. The following code snippet creates an implicit <code>Runtime</code> for all the modules built into ZIO:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import cats.implicits._</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioCatsEffectInterop extends scala.App {</span><br></span><span class="token-line"><span class="token plain">  def catsEffectApp[F[_]: cats.effect.Sync]: F[Unit] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.Sync[F].delay(</span><br></span><span class="token-line"><span class="token plain">        println(&quot;Hello from Cats Effect World!&quot;)</span><br></span><span class="token-line"><span class="token plain">      )</span><br></span><span class="token-line"><span class="token plain">      </span><br></span><span class="token-line"><span class="token plain">  implicit val runtime: zio.Runtime[zio.ZEnv] = zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val zioApp: zio.Task[Unit] = catsEffectApp[zio.Task]</span><br></span><span class="token-line"><span class="token plain">  runtime.unsafeRun(zioApp.exitCode)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If we are working with Cats Effect 3.x, the <code>catsEffectApp[Task]</code> will be expanded as if we called the following code explicitly:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import ZioCatsEffectInterop.catsEffectApp</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">object ZioCatsEffectInterop extends scala.App {</span><br></span><span class="token-line"><span class="token plain">  val runtime: zio.Runtime[zio.ZEnv] = zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  val zioApp: zio.Task[Unit] = catsEffectApp[zio.Task](</span><br></span><span class="token-line"><span class="token plain">    zio.interop.catz.asyncRuntimeInstance(runtime) </span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  runtime.unsafeRun(zioApp.exitCode) </span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And if we are working with Cats Effect 2.x, it will be expanded as if we called following code explicitly:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">object ZioCatsEffectInterop extends scala.App {</span><br></span><span class="token-line"><span class="token plain">  val runtime: zio.Runtime[zio.ZEnv] = zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val zioApp = catsEffectApp[zio.Task](zio.interop.catz.taskConcurrentInstance)</span><br></span><span class="token-line"><span class="token plain">  runtime.unsafeRun(zioApp.exitCode)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If we are using <code>RIO</code> for a custom environment <code>R</code>, then we will have to create our own <code>Runtime[R]</code>, and ensure that implicit wherever we need Cats Effect instances.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="using-catsapp-runtime">Using <code>CatsApp</code> Runtime<a aria-hidden="true" class="hash-link" href="#using-catsapp-runtime" title="Direct link to heading">â€‹</a></h3><p>As a convenience, our application can extend <code>CatsApp</code>, which automatically brings an implicit <code>Runtime[ZEnv]</code> into our scope:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain">import cats.implicits._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioCatsEffectInteropWithCatsApp extends CatsApp {</span><br></span><span class="token-line"><span class="token plain">  def catsEffectApp[F[_]: cats.effect.Sync]: F[Unit] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.Sync[F].delay(println(&quot;Hello from Cats Effect World!&quot;))</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] = </span><br></span><span class="token-line"><span class="token plain">    catsEffectApp[zio.Task].exitCode</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This example works properly in both Cats Effect 2.x and 3.x versions.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cats-effect-2x">Cats Effect 2.x<a aria-hidden="true" class="hash-link" href="#cats-effect-2x" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="timer-instance">Timer Instance<a aria-hidden="true" class="hash-link" href="#timer-instance" title="Direct link to heading">â€‹</a></h3><p>In order to get a <code>cats.effect.Timer[zio.Task]</code> instance, we need an extra import (<code>zio.interop.catz.implicits._</code>):</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import java.util.concurrent.TimeUnit</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import cats.implicits._</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz.implicits._ // Provides `zio.Task instance` for `cats.effect.Time` type class</span><br></span><span class="token-line"><span class="token plain">import zio.{ ExitCode, Task, URIO }</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import scala.concurrent.duration.DurationInt</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioCatsEffectTimerInterop extends zio.interop.catz.CatsApp {</span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    catsEffectTimerApp[zio.Task].exitCode</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def catsEffectTimerApp[F[_]: cats.effect.Clock: cats.effect.Timer: cats.effect.Sync]: F[Unit] = for {</span><br></span><span class="token-line"><span class="token plain">    t2 &lt;- cats.effect.Clock[F].monotonic(TimeUnit.SECONDS)</span><br></span><span class="token-line"><span class="token plain">    _  &lt;- cats.effect.Timer[F].sleep(2.seconds)</span><br></span><span class="token-line"><span class="token plain">    t1 &lt;- cats.effect.Clock[F].monotonic(TimeUnit.SECONDS)</span><br></span><span class="token-line"><span class="token plain">    _  &lt;- cats.effect.Sync[F].delay(println(t1 - t2))</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The reason a <code>cats.effect.Timer[zio.Task]</code> instance is not provided by the default <em>interop</em> import is that it makes testing programs that require timing capabilities very difficult. The extra import (wherever needed) makes reasoning about timing-related effects much easier.</p><p>If we&#x27;re using <code>RIO</code> for a custom environment then our environment must use the <code>Clock</code> service, e.g. <code>R &lt;: Clock</code> to get a timer.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="converting-resource-to-zmanaged">Converting Resource to ZManaged<a aria-hidden="true" class="hash-link" href="#converting-resource-to-zmanaged" title="Direct link to heading">â€‹</a></h3><p>To convert Cats Effect <code>Resource</code> into <code>ZManaged</code>, we can call <code>toManaged</code> on <code>Resource</code>.</p><p>For example, assume we have the following <code>File</code> API:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">case class File[F[_]: cats.effect.Sync]() {</span><br></span><span class="token-line"><span class="token plain">  import cats.syntax.apply._</span><br></span><span class="token-line"><span class="token plain">  def read: F[String] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.Sync[F].delay(println(&quot;Reading file.&quot;)) *&gt;</span><br></span><span class="token-line"><span class="token plain">      cats.effect.Sync[F].pure(&quot;Hello, World!&quot;)</span><br></span><span class="token-line"><span class="token plain">  def close: F[Unit]  =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.Sync[F].delay(println(&quot;Closing file.&quot;))</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object File {</span><br></span><span class="token-line"><span class="token plain">  import cats.syntax.apply._</span><br></span><span class="token-line"><span class="token plain">  def open[F[_]: cats.effect.Sync](name: String): F[File[F]] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.Sync[F].delay(println(s&quot;opening $name file&quot;)) *&gt;</span><br></span><span class="token-line"><span class="token plain">      cats.effect.Sync[F].delay(File())</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And, also assume we have <code>fileResource</code> defined as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">def fileResource[F[_]: cats.effect.Sync](name: String): cats.effect.Resource[F, File[F]] =</span><br></span><span class="token-line"><span class="token plain">  cats.effect.Resource.make(File.open[F](name))(_.close)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let&#x27;s convert that to <code>ZManaged</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val resource: zio.ZManaged[zio.ZEnv, Throwable, File[zio.Task]] =</span><br></span><span class="token-line"><span class="token plain">  fileResource[zio.Task](&quot;log.txt&quot;).toManaged[zio.ZEnv]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here is a complete working example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object CatsEffectResourceInterop extends CatsApp {</span><br></span><span class="token-line"><span class="token plain">  def fileResource[F[_]: cats.effect.Sync](name: String): cats.effect.Resource[F, File[F]] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.Resource.make(File.open[F](name))(_.close)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def myApp: zio.ZIO[zio.ZEnv, Throwable, Unit] = for {</span><br></span><span class="token-line"><span class="token plain">    c &lt;- fileResource[zio.Task](&quot;log.txt&quot;).toManaged[zio.ZEnv].use(_.read)</span><br></span><span class="token-line"><span class="token plain">    _ &lt;- zio.console.putStr(s&quot;file content: $c&quot;)</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    myApp.exitCode</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="converting-zmanaged-to-resource">Converting ZManaged to Resource<a aria-hidden="true" class="hash-link" href="#converting-zmanaged-to-resource" title="Direct link to heading">â€‹</a></h3><p>We have an extension method on <code>ZManaged</code> called <code>ZManaged#toResource</code> which converts a ZIO managed resource to Cats Effect resource:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">final class ZManagedSyntax[R, E, A](private val managed: ZManaged[R, E, A]) {</span><br></span><span class="token-line"><span class="token plain">  def toResource[F[_]](implicit</span><br></span><span class="token-line"><span class="token plain">      F: Async[F],</span><br></span><span class="token-line"><span class="token plain">      ev: Effect[ZIO[R, E, *]]</span><br></span><span class="token-line"><span class="token plain">  ): Resource[F, A] = ???</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let&#x27;s try an example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZManagedToResource extends cats.effect.IOApp {</span><br></span><span class="token-line"><span class="token plain">  implicit val zioRuntime: zio.Runtime[zio.ZEnv] = zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val resource: cats.effect.Resource[cats.effect.IO, java.io.InputStream] =</span><br></span><span class="token-line"><span class="token plain">    zio.ZManaged</span><br></span><span class="token-line"><span class="token plain">      .fromAutoCloseable(</span><br></span><span class="token-line"><span class="token plain">        zio.ZIO.effect(</span><br></span><span class="token-line"><span class="token plain">          java.nio.file.Files.newInputStream(</span><br></span><span class="token-line"><span class="token plain">            java.nio.file.Paths.get(&quot;file.txt&quot;)</span><br></span><span class="token-line"><span class="token plain">          )</span><br></span><span class="token-line"><span class="token plain">        )</span><br></span><span class="token-line"><span class="token plain">      )</span><br></span><span class="token-line"><span class="token plain">      .toResource[cats.effect.IO]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val effect: cats.effect.IO[Unit] =</span><br></span><span class="token-line"><span class="token plain">    resource</span><br></span><span class="token-line"><span class="token plain">      .use { is =&gt;</span><br></span><span class="token-line"><span class="token plain">        cats.effect.IO.delay(is.readAllBytes())</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">      .flatMap(bytes =&gt;</span><br></span><span class="token-line"><span class="token plain">        cats.effect.IO.delay(</span><br></span><span class="token-line"><span class="token plain">          println(s&quot;file length: ${bytes.length}&quot;)</span><br></span><span class="token-line"><span class="token plain">        )</span><br></span><span class="token-line"><span class="token plain">      )</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): cats.effect.IO[cats.effect.ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    effect.as(cats.effect.ExitCode.Success)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cats-effect-3x">Cats Effect 3.x<a aria-hidden="true" class="hash-link" href="#cats-effect-3x" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="type-class-instances-for-zios-task">Type class Instances for ZIO&#x27;s Task<a aria-hidden="true" class="hash-link" href="#type-class-instances-for-zios-task" title="Direct link to heading">â€‹</a></h3><p>ZIO integrates with Cats Effect 3.x as well as 2.x. The <code>interop-cats</code> module provides <code>Concurrent</code>, <code>Temporal</code> and <code>Async</code> for <code>zio.Task</code>.</p><p>An example of ZIO interoperability with CE3:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import cats.implicits._</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain">import scala.concurrent.duration.DurationInt</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioCatsEffectInterop extends zio.interop.catz.CatsApp {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def catsEffectTimerApp[F[_]: cats.effect.Async]: F[Unit] = for {</span><br></span><span class="token-line"><span class="token plain">    t2 &lt;- cats.effect.Clock[F].monotonic</span><br></span><span class="token-line"><span class="token plain">    _  &lt;- cats.effect.Temporal[F].sleep(2.seconds)</span><br></span><span class="token-line"><span class="token plain">    t1 &lt;- cats.effect.Clock[F].monotonic</span><br></span><span class="token-line"><span class="token plain">    _  &lt;- cats.effect.Sync[F].delay(println(t1 - t2))</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] = {</span><br></span><span class="token-line"><span class="token plain">    catsEffectTimerApp[zio.Task].exitCode</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="converting-resource-to-zmanaged-1">Converting Resource to ZManaged<a aria-hidden="true" class="hash-link" href="#converting-resource-to-zmanaged-1" title="Direct link to heading">â€‹</a></h3><p>To convert a Cats Effect&#x27;s <code>Resource</code> to <code>ZManaged</code> we can use <code>cats.effect.Resource#toZManaged</code> extension method by importing <code>zio.interop.catz._</code> package and also we should provide an implicit instance of <code>Dispatcher</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain">import scala.concurrent.ExecutionContextExecutor</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ResourceToZManagedExample extends zio.App {</span><br></span><span class="token-line"><span class="token plain">  implicit val ceRuntime: cats.effect.unsafe.IORuntime =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.unsafe.IORuntime.global</span><br></span><span class="token-line"><span class="token plain">  implicit val ec: ExecutionContextExecutor =</span><br></span><span class="token-line"><span class="token plain">    scala.concurrent.ExecutionContext.global</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  implicit val dispatcher: cats.effect.std.Dispatcher[cats.effect.IO] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.std</span><br></span><span class="token-line"><span class="token plain">      .Dispatcher[cats.effect.IO]</span><br></span><span class="token-line"><span class="token plain">      .allocated</span><br></span><span class="token-line"><span class="token plain">      .unsafeRunSync()</span><br></span><span class="token-line"><span class="token plain">      ._1</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def catsResource[F[_]: cats.effect.Sync]</span><br></span><span class="token-line"><span class="token plain">      : cats.effect.Resource[F, java.io.InputStream] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.Resource</span><br></span><span class="token-line"><span class="token plain">      .fromAutoCloseable(</span><br></span><span class="token-line"><span class="token plain">        cats.effect</span><br></span><span class="token-line"><span class="token plain">          .Sync[F]</span><br></span><span class="token-line"><span class="token plain">          .delay(</span><br></span><span class="token-line"><span class="token plain">            java.nio.file.Files.newInputStream(</span><br></span><span class="token-line"><span class="token plain">              java.nio.file.Paths.get(&quot;file.txt&quot;)</span><br></span><span class="token-line"><span class="token plain">            )</span><br></span><span class="token-line"><span class="token plain">          )</span><br></span><span class="token-line"><span class="token plain">      )</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val myApp: zio.ZIO[zio.console.Console, Throwable, Unit] =</span><br></span><span class="token-line"><span class="token plain">    catsResource[cats.effect.IO].toManaged</span><br></span><span class="token-line"><span class="token plain">      .use { is =&gt;</span><br></span><span class="token-line"><span class="token plain">        zio.console.putStrLn(is.readAllBytes().length.toString)</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">      </span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    myApp.exitCode</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="cats-core">Cats Core<a aria-hidden="true" class="hash-link" href="#cats-core" title="Direct link to heading">â€‹</a></h2><p>There is another package in <code>interop-cats</code> module called <code>zio.interop.catz.core._</code> which helps us to interop with core data types. This package contains instances of <code>zio.Chunk</code> data type for Cats Core module like <code>cats.Order</code>, <code>cats.Hash</code>, <code>cats.Traverse</code>, and so forth.</p><p>In the following example, we are going to use <code>zio.Chunk</code> in a Cats Effect application:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import cats.implicits._</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz.core._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioInteropWithCatsCore extends cats.effect.IOApp {</span><br></span><span class="token-line"><span class="token plain">  val chunk = zio.Chunk(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def parseInt(s: String): Option[Int] =</span><br></span><span class="token-line"><span class="token plain">    Either.catchOnly[NumberFormatException](s.toInt).toOption</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val parseAll = cats.Traverse[zio.Chunk].traverse(chunk)(parseInt)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): cats.effect.IO[cats.effect.ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.IO.println(parseAll).as(cats.effect.ExitCode.Success)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This package also contains utilities to support <code>zio.NonEmptyChunk</code> interoperability with Cats Core module.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="fs2-streams">FS2 Streams<a aria-hidden="true" class="hash-link" href="#fs2-streams" title="Direct link to heading">â€‹</a></h2><p>The <code>interop-cats</code> module contains extension methods to convert <em>FS2 Stream</em> to <em>ZStream</em> and vice versa. These methods support both FS2 series, 2.x and 3.x:</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-fs2-stream-to-zstream">From FS2 Stream to ZStream<a aria-hidden="true" class="hash-link" href="#from-fs2-stream-to-zstream" title="Direct link to heading">â€‹</a></h3><p>By importing <code>zio.stream.interop.fs2z._</code> into our application, the <code>fs2.Stream#toZStream</code> extension method converts a <code>fs2.Stream</code> to <code>ZStream</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.stream.ZStream</span><br></span><span class="token-line"><span class="token plain">import zio.stream.interop.fs2z._</span><br></span><span class="token-line"><span class="token plain">val zstream: ZStream[Any, Throwable, Int] = fs2.Stream.range(1, 10).toZStream()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="from-zstream-to-fs2-stream">From ZStream to FS2 Stream<a aria-hidden="true" class="hash-link" href="#from-zstream-to-fs2-stream" title="Direct link to heading">â€‹</a></h3><p>Also, the <code>ZStream#toFs2Stream</code> converts a ZIO Stream into FS2 Stream:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.stream.ZStream</span><br></span><span class="token-line"><span class="token plain">import zio.Chunk</span><br></span><span class="token-line"><span class="token plain">import zio.stream.interop.fs2z._</span><br></span><span class="token-line"><span class="token plain">val fs2stream = ZStream.fromChunks(Chunk(1, 2, 3, 4)).toFs2Stream</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="using-zqueue-with-cats-effect">Using ZQueue with Cats Effect<a aria-hidden="true" class="hash-link" href="#using-zqueue-with-cats-effect" title="Direct link to heading">â€‹</a></h2><p>The <code>interop-cats</code> library has an <code>import zio.interop.Queue</code> package to lift creation of <code>ZQueue</code> effect from <code>UIO[Queue[A]]</code> to <code>F[Queue[F, A]]</code> which enables us to run <code>ZQueue</code> under Cats Effect runtime. It supports all variants of <code>ZQueue</code> like <code>bounded</code>, <code>unbounded</code>, <code>sliding</code> and <code>dropping</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">def bounded[F[+_], A](capacity: Int)(implicit R: Runtime[ZEnv], F: LiftIO[F]): F[Queue[F, A]]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cats-effect-2x-1">Cats Effect 2.x<a aria-hidden="true" class="hash-link" href="#cats-effect-2x-1" title="Direct link to heading">â€‹</a></h3><p>In the following example, we are going to lift the <code>ZQueue</code> creation effect to Cats <code>IO</code> effect. If we are integrating with 2.x Cats Effect library, this snippet works properly:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.interop.Queue</span><br></span><span class="token-line"><span class="token plain">import cats.effect.IO</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">implicit val runtime = Runtime.default</span><br></span><span class="token-line"><span class="token plain">def liftedToIO: IO[List[Int]] = for {</span><br></span><span class="token-line"><span class="token plain">  q &lt;- Queue.bounded[IO, Int](100)</span><br></span><span class="token-line"><span class="token plain">  _  &lt;- q.offer(1)</span><br></span><span class="token-line"><span class="token plain">  _  &lt;- q.offer(2)</span><br></span><span class="token-line"><span class="token plain">  r &lt;- q.takeAll</span><br></span><span class="token-line"><span class="token plain">} yield (r)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cats-effect-3x-1">Cats Effect 3.x<a aria-hidden="true" class="hash-link" href="#cats-effect-3x-1" title="Direct link to heading">â€‹</a></h3><p>To run <code>ZQueue</code> with Cats Effect 3.x we also need to provide an instance of <code>Dispatcher</code> to our contextual environment:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.interop.Queue</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioQueueInteropWithCats extends scala.App {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  implicit val ceRuntime: cats.effect.unsafe.IORuntime =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.unsafe.IORuntime.global</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  implicit val zioRuntime: zio.Runtime[zio.ZEnv] =</span><br></span><span class="token-line"><span class="token plain">    zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  implicit val ec: scala.concurrent.ExecutionContextExecutor =</span><br></span><span class="token-line"><span class="token plain">    scala.concurrent.ExecutionContext.global</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  implicit val dispatcher: cats.effect.std.Dispatcher[cats.effect.IO] =</span><br></span><span class="token-line"><span class="token plain">    cats.effect.std</span><br></span><span class="token-line"><span class="token plain">      .Dispatcher[cats.effect.IO]</span><br></span><span class="token-line"><span class="token plain">      .allocated</span><br></span><span class="token-line"><span class="token plain">      .unsafeRunSync()</span><br></span><span class="token-line"><span class="token plain">      ._1</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def liftedToIO: cats.effect.IO[List[Int]] = for {</span><br></span><span class="token-line"><span class="token plain">    q &lt;- Queue.bounded[cats.effect.IO, Int](100)</span><br></span><span class="token-line"><span class="token plain">    _ &lt;- q.offer(1)</span><br></span><span class="token-line"><span class="token plain">    _ &lt;- q.offer(2)</span><br></span><span class="token-line"><span class="token plain">    r &lt;- q.takeAll</span><br></span><span class="token-line"><span class="token plain">  } yield (r)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val catsApp = liftedToIO</span><br></span><span class="token-line"><span class="token plain">    .flatMap { e =&gt;</span><br></span><span class="token-line"><span class="token plain">      cats.effect.IO.println(s&quot;List of elements retrieved from Queue: $e&quot;)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">    .as(cats.effect.ExitCode.Success)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  catsApp.unsafeRunSync()</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="using-stm-with-cats-effect">Using STM with Cats Effect<a aria-hidden="true" class="hash-link" href="#using-stm-with-cats-effect" title="Direct link to heading">â€‹</a></h2><p>The <code>zio.interop.stm</code> provides a wrapper data type on <code>STM[Throwable, A]</code> which enables us to run <code>STM</code> with the Cats Effect library.</p><p>Currently, the <code>interop-cats</code> support <code>TRef</code>, <code>TPromise</code>,  <code>TQueue</code> and <code>TSemaphore</code> data types.</p><p>Let&#x27;s try a working example using <code>STM</code> and <code>TRef</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import cats.effect.IO</span><br></span><span class="token-line"><span class="token plain">import cats.effect.unsafe.IORuntime</span><br></span><span class="token-line"><span class="token plain">import zio.interop.stm.{STM, TRef}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">implicit val zioRuntime: zio.Runtime[zio.ZEnv] = zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain">implicit val catsRuntime: IORuntime            = IORuntime.global</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def transferMoney(</span><br></span><span class="token-line"><span class="token plain">    from: TRef[IO, Long],</span><br></span><span class="token-line"><span class="token plain">    to: TRef[IO, Long],</span><br></span><span class="token-line"><span class="token plain">    amount: Long</span><br></span><span class="token-line"><span class="token plain">): STM[IO, Long] =</span><br></span><span class="token-line"><span class="token plain">  for {</span><br></span><span class="token-line"><span class="token plain">    senderBal &lt;- from.get</span><br></span><span class="token-line"><span class="token plain">    _ &lt;-</span><br></span><span class="token-line"><span class="token plain">      if (senderBal &lt; amount)</span><br></span><span class="token-line"><span class="token plain">        STM.fail[IO](new Exception(&quot;Not enough money&quot;))</span><br></span><span class="token-line"><span class="token plain">      else</span><br></span><span class="token-line"><span class="token plain">        STM.unit[IO]</span><br></span><span class="token-line"><span class="token plain">    _       &lt;- from.update(existing =&gt; existing - amount)</span><br></span><span class="token-line"><span class="token plain">    _       &lt;- to.update(existing =&gt; existing + amount)</span><br></span><span class="token-line"><span class="token plain">    recvBal &lt;- to.get</span><br></span><span class="token-line"><span class="token plain">  } yield recvBal</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val program: IO[Long] = for {</span><br></span><span class="token-line"><span class="token plain">  sndAcc &lt;- STM.atomically[cats.effect.IO, TRef[IO, Long]](</span><br></span><span class="token-line"><span class="token plain">    TRef.make[IO, Long](1000)</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">  rcvAcc &lt;- STM.atomically[cats.effect.IO, TRef[IO, Long]](</span><br></span><span class="token-line"><span class="token plain">    TRef.make[IO, Long](200)</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">  recvAmt &lt;- STM.atomically(transferMoney(sndAcc, rcvAcc, 500L))</span><br></span><span class="token-line"><span class="token plain">} yield recvAmt</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">program</span><br></span><span class="token-line"><span class="token plain">  .flatMap(amount =&gt;</span><br></span><span class="token-line"><span class="token plain">    IO.println(s&quot;Balance of second account after transaction: $amount&quot;)</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">  .unsafeRunSync()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="examples">Examples<a aria-hidden="true" class="hash-link" href="#examples" title="Direct link to heading">â€‹</a></h2><p>Cats Effect and Type-Level libraries are older than the ZIO ecosystem. So there are very nice libraries like doobie and http4s, that a ZIO user would like to use in its application.</p><p>We have provided some full working example of using these important libraries:</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="using-zio-with-doobie">Using ZIO with Doobie<a aria-hidden="true" class="hash-link" href="#using-zio-with-doobie" title="Direct link to heading">â€‹</a></h3><p>The following example shows how to use ZIO with Doobie (a library for JDBC access) and FS2 (a streaming library), which both rely on Cats Effect instances:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">// This snippet works with both CE2 and CE3</span><br></span><span class="token-line"><span class="token plain">import doobie._</span><br></span><span class="token-line"><span class="token plain">import doobie.implicits._</span><br></span><span class="token-line"><span class="token plain">import fs2.Stream</span><br></span><span class="token-line"><span class="token plain">import zio.Task</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">implicit val zioRuntime: zio.Runtime[zio.ZEnv] = zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class User(id: String, name: String, age: Int)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def xa: Transactor[Task] =</span><br></span><span class="token-line"><span class="token plain">  Transactor.fromDriverManager[Task](</span><br></span><span class="token-line"><span class="token plain">    &quot;org.h2.Driver&quot;,</span><br></span><span class="token-line"><span class="token plain">    &quot;jdbc:h2:mem:users;DB_CLOSE_DELAY=-1&quot;</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def createTable: doobie.ConnectionIO[Int] =</span><br></span><span class="token-line"><span class="token plain">  sql&quot;&quot;&quot;|CREATE TABLE IF NOT EXISTS USERS(</span><br></span><span class="token-line"><span class="token plain">        |id   INT SERIAL UNIQUE,</span><br></span><span class="token-line"><span class="token plain">        |name VARCHAR NOT NULL UNIQUE,</span><br></span><span class="token-line"><span class="token plain">        |age  SMALLINT</span><br></span><span class="token-line"><span class="token plain">        |)&quot;&quot;&quot;.stripMargin.update.run</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def dropTable: doobie.ConnectionIO[Int] =</span><br></span><span class="token-line"><span class="token plain">  sql&quot;&quot;&quot;DROP TABLE IF EXISTS USERS&quot;&quot;&quot;.update.run</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def insert(name: String, age: Int): doobie.ConnectionIO[Int] =</span><br></span><span class="token-line"><span class="token plain">  sql&quot;insert into users (name, age) values ($name, $age)&quot;.update.run</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def loadUsers: Stream[doobie.ConnectionIO, User] =</span><br></span><span class="token-line"><span class="token plain">  sql&quot;&quot;&quot;SELECT * FROM users&quot;&quot;&quot;.query[User].stream</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val doobieApp: Stream[doobie.ConnectionIO, User] = for {</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- fs2.Stream.eval(dropTable)</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- fs2.Stream.eval(createTable)</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- fs2.Stream.eval(insert(&quot;Olivia&quot;, 21))</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- fs2.Stream.eval(insert(&quot;Oliver&quot;, 30))</span><br></span><span class="token-line"><span class="token plain">  u &lt;- loadUsers</span><br></span><span class="token-line"><span class="token plain">} yield u</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val run: Stream[Task, User] = doobieApp.transact(xa)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val allUsers: List[User] =</span><br></span><span class="token-line"><span class="token plain">  zioRuntime.unsafeRun(run.compile.toList)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Sounds good, but how can we specify a specialized transactor than the default one? Creating a customized transactor in CE2 differs from CE3. </p><p>Let&#x27;s try doing that in each of which:</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="customized-transactor-ce2">Customized Transactor (CE2)<a aria-hidden="true" class="hash-link" href="#customized-transactor-ce2" title="Direct link to heading">â€‹</a></h4><p>ZIO provides a specific blocking thread pool for blocking operations. The <code>doobie-hikari</code> module helps us create a transactor with two separated executors, one for blocking operations like JDBC operations, and the other one for non-blocking operations like performing awaiting connections to the database. So we shouldn&#x27;t run blocking JDBC operations on the main thread pool. </p><p>So let&#x27;s fix this issue in the previous example. In the following snippet we are going to create a <code>ZMHikari</code> of Hikari transactor. In this example we are using <code>0.13.4</code> version of doobie which supports CE2:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import zio.ZManaged</span><br></span><span class="token-line"><span class="token plain">import zio.{ Runtime, Task, ZIO, ZManaged }</span><br></span><span class="token-line"><span class="token plain">import doobie.hikari.HikariTransactor</span><br></span><span class="token-line"><span class="token plain">import cats.effect.Blocker</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def transactor: ZManaged[Any, Throwable, HikariTransactor[Task]] =</span><br></span><span class="token-line"><span class="token plain">  for {</span><br></span><span class="token-line"><span class="token plain">    rt &lt;- ZIO.runtime[Any].toManaged</span><br></span><span class="token-line"><span class="token plain">    be &lt;- ZIO.blockingExecutor.toManaged                          // our blocking EC</span><br></span><span class="token-line"><span class="token plain">    xa &lt;- HikariTransactor</span><br></span><span class="token-line"><span class="token plain">            .newHikariTransactor[Task](</span><br></span><span class="token-line"><span class="token plain">              &quot;org.h2.Driver&quot;,                                    // driver classname</span><br></span><span class="token-line"><span class="token plain">              &quot;jdbc:h2:mem:test;DB_CLOSE_DELAY=-1&quot;,               // connect URL</span><br></span><span class="token-line"><span class="token plain">              &quot;sa&quot;,                                               // username</span><br></span><span class="token-line"><span class="token plain">              &quot;&quot;,                                                 // password</span><br></span><span class="token-line"><span class="token plain">              rt.runtimeConfig.executor.asExecutionContext,       // await connection here</span><br></span><span class="token-line"><span class="token plain">              Blocker.liftExecutionContext(be.asExecutionContext) // execute JDBC operations here</span><br></span><span class="token-line"><span class="token plain">            )</span><br></span><span class="token-line"><span class="token plain">            .toManagedZIO</span><br></span><span class="token-line"><span class="token plain">  } yield xa</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now we can <code>transact</code> our <code>doobieApp</code> with this <code>transactor</code> and convert that to the <code>ZIO</code> effect:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val zioApp: ZIO[Any, Throwable, List[User]] =</span><br></span><span class="token-line"><span class="token plain">  transactor.use(xa =&gt; doobieApp.transact(xa).compile.toList)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="customized-transactor-ce3">Customized Transactor (CE3)<a aria-hidden="true" class="hash-link" href="#customized-transactor-ce3" title="Direct link to heading">â€‹</a></h4><p>In Cats Effect 3.x, the <code>cats.effect.Blocker</code> has been removed. So the transactor constructor doesn&#x27;t require us a blocking executor; it happens under the hood using the <code>Sync[F].blocking</code> operation.</p><p>To create a <code>Transactor</code> in CE3, we need to create an instance of <code>Dispatcher</code> for <code>zio.Task</code>. The following example is based on Doobie&#x27;s <code>1.0.0-M5</code> version which supports CE3:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import doobie.hikari.HikariTransactor</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain">import zio.{Task, ZIO, ZManaged}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">implicit val zioRuntime: zio.Runtime[zio.ZEnv] =</span><br></span><span class="token-line"><span class="token plain">  zio.Runtime.default</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">implicit val dispatcher: cats.effect.std.Dispatcher[zio.Task] =</span><br></span><span class="token-line"><span class="token plain">  zioRuntime</span><br></span><span class="token-line"><span class="token plain">    .unsafeRun(</span><br></span><span class="token-line"><span class="token plain">      cats.effect.std</span><br></span><span class="token-line"><span class="token plain">        .Dispatcher[zio.Task]</span><br></span><span class="token-line"><span class="token plain">        .allocated</span><br></span><span class="token-line"><span class="token plain">    )</span><br></span><span class="token-line"><span class="token plain">    ._1</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def transactor: ZManaged[Any, Throwable, HikariTransactor[Task]] =</span><br></span><span class="token-line"><span class="token plain">  for {</span><br></span><span class="token-line"><span class="token plain">    rt &lt;- ZIO.runtime[Any].toManaged</span><br></span><span class="token-line"><span class="token plain">    xa &lt;-</span><br></span><span class="token-line"><span class="token plain">      HikariTransactor</span><br></span><span class="token-line"><span class="token plain">        .newHikariTransactor[Task](</span><br></span><span class="token-line"><span class="token plain">          &quot;org.h2.Driver&quot;,                             // driver classname</span><br></span><span class="token-line"><span class="token plain">          &quot;jdbc:h2:mem:test;DB_CLOSE_DELAY=-1&quot;,        // connect URL</span><br></span><span class="token-line"><span class="token plain">          &quot;sa&quot;,                                        // username</span><br></span><span class="token-line"><span class="token plain">          &quot;&quot;,                                          // password</span><br></span><span class="token-line"><span class="token plain">          rt.runtimeConfig.executor.asExecutionContext // await connection here</span><br></span><span class="token-line"><span class="token plain">        )</span><br></span><span class="token-line"><span class="token plain">        .toManaged</span><br></span><span class="token-line"><span class="token plain">  } yield xa</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now we can <code>transact</code> our <code>doobieApp</code> with this <code>transactor</code> and convert that to the <code>ZIO</code> effect:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">val zioApp: ZIO[Any, Throwable, List[User]] =</span><br></span><span class="token-line"><span class="token plain">  transactor.use(xa =&gt; doobieApp.transact(xa).compile.toList)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="http4s">Http4s<a aria-hidden="true" class="hash-link" href="#http4s" title="Direct link to heading">â€‹</a></h3><p>Here is the full working example of using http4s in ZIO App:</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="cats-effect-2x-2">Cats Effect 2.x<a aria-hidden="true" class="hash-link" href="#cats-effect-2x-2" title="Direct link to heading">â€‹</a></h4><p>The following example is based on http4s&#x27;s <code>0.21.24</code> version which supports CE2:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import cats.effect.{ConcurrentEffect, Sync, Timer}</span><br></span><span class="token-line"><span class="token plain">import cats.implicits._</span><br></span><span class="token-line"><span class="token plain">import fs2.Stream</span><br></span><span class="token-line"><span class="token plain">import org.http4s.HttpRoutes</span><br></span><span class="token-line"><span class="token plain">import org.http4s.client.blaze.BlazeClientBuilder</span><br></span><span class="token-line"><span class="token plain">import org.http4s.dsl.Http4sDsl</span><br></span><span class="token-line"><span class="token plain">import org.http4s.server.blaze.BlazeServerBuilder</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz.implicits._ </span><br></span><span class="token-line"><span class="token plain">import zio.{Task, URIO}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import scala.concurrent.ExecutionContext.global</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioHttp4sInterop extends CatsApp {</span><br></span><span class="token-line"><span class="token plain">  def run(args: List[String]): URIO[zio.ZEnv, zio.ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    stream[Task].compile.drain.exitCode</span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  def stream[F[_]: ConcurrentEffect: Timer]: Stream[F, Nothing] = {</span><br></span><span class="token-line"><span class="token plain">    import org.http4s.implicits._</span><br></span><span class="token-line"><span class="token plain">    val httpApp = helloWorldRoute[F].orNotFound</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- BlazeClientBuilder[F](global).stream</span><br></span><span class="token-line"><span class="token plain">      exitCode &lt;- BlazeServerBuilder[F](global)</span><br></span><span class="token-line"><span class="token plain">        .bindHttp(8080, &quot;0.0.0.0&quot;)</span><br></span><span class="token-line"><span class="token plain">        .withHttpApp(httpApp)</span><br></span><span class="token-line"><span class="token plain">        .serve</span><br></span><span class="token-line"><span class="token plain">    } yield exitCode</span><br></span><span class="token-line"><span class="token plain">  }.drain</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def helloWorldRoute[F[_]: Sync]: HttpRoutes[F] = {</span><br></span><span class="token-line"><span class="token plain">    val dsl = new Http4sDsl[F]{}</span><br></span><span class="token-line"><span class="token plain">    import dsl._</span><br></span><span class="token-line"><span class="token plain">    HttpRoutes.strict[F] {</span><br></span><span class="token-line"><span class="token plain">      case GET -&gt; Root =&gt;</span><br></span><span class="token-line"><span class="token plain">        Ok(&quot;Hello, World!&quot;)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="cats-effect-3x-2">Cats Effect 3.x<a aria-hidden="true" class="hash-link" href="#cats-effect-3x-2" title="Direct link to heading">â€‹</a></h4><p>The following example is based on http4s&#x27;s <code>0.23.0-RC1</code> version which supports CE3:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar"><code class="codeBlockLines_1zSZ"><span class="token-line"><span class="token plain">import cats.Applicative</span><br></span><span class="token-line"><span class="token plain">import cats.effect.Async</span><br></span><span class="token-line"><span class="token plain">import fs2.Stream</span><br></span><span class="token-line"><span class="token plain">import org.http4s.HttpRoutes</span><br></span><span class="token-line"><span class="token plain">import org.http4s.blaze.client.BlazeClientBuilder</span><br></span><span class="token-line"><span class="token plain">import org.http4s.blaze.server.BlazeServerBuilder</span><br></span><span class="token-line"><span class="token plain">import org.http4s.dsl.Http4sDsl</span><br></span><span class="token-line"><span class="token plain">import zio.interop.catz._</span><br></span><span class="token-line"><span class="token plain">import zio.{Task, URIO}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import scala.concurrent.ExecutionContext.global</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZioHttp4sInterop extends zio.interop.catz.CatsApp {</span><br></span><span class="token-line"><span class="token plain">  def stream[F[_]: Async]: Stream[F, Nothing] = {</span><br></span><span class="token-line"><span class="token plain">    import org.http4s.implicits._</span><br></span><span class="token-line"><span class="token plain">    val httpApp = helloWorldRoute[F].orNotFound</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- BlazeClientBuilder[F](global).stream</span><br></span><span class="token-line"><span class="token plain">      exitCode &lt;- BlazeServerBuilder[F](global)</span><br></span><span class="token-line"><span class="token plain">        .bindHttp(8080, &quot;0.0.0.0&quot;)</span><br></span><span class="token-line"><span class="token plain">        .withHttpApp(httpApp)</span><br></span><span class="token-line"><span class="token plain">        .serve</span><br></span><span class="token-line"><span class="token plain">    } yield exitCode</span><br></span><span class="token-line"><span class="token plain">  }.drain</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def helloWorldRoute[F[_]: Applicative]: HttpRoutes[F] = {</span><br></span><span class="token-line"><span class="token plain">    val dsl = new Http4sDsl[F] {}</span><br></span><span class="token-line"><span class="token plain">    import dsl._</span><br></span><span class="token-line"><span class="token plain">    HttpRoutes.strict[F] { case GET -&gt; Root =&gt;</span><br></span><span class="token-line"><span class="token plain">      Ok(&quot;Hello, World!&quot;)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def run(args: List[String]): URIO[zio.ZEnv, zio.ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    stream[Task].compile.drain.exitCode</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/howto/interop/with-cats-effect.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/next/howto/use-zio-macros"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->How to use ZIO Macros?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/next/howto/interop/with-future"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to Interop with Future?<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#cats-effect-instances" class="table-of-contents__link toc-highlight">Cats Effect Instances</a><ul><li><a href="#providing-runtime-manually" class="table-of-contents__link toc-highlight">Providing Runtime Manually</a></li><li><a href="#using-catsapp-runtime" class="table-of-contents__link toc-highlight">Using <code>CatsApp</code> Runtime</a></li></ul></li><li><a href="#cats-effect-2x" class="table-of-contents__link toc-highlight">Cats Effect 2.x</a><ul><li><a href="#timer-instance" class="table-of-contents__link toc-highlight">Timer Instance</a></li><li><a href="#converting-resource-to-zmanaged" class="table-of-contents__link toc-highlight">Converting Resource to ZManaged</a></li><li><a href="#converting-zmanaged-to-resource" class="table-of-contents__link toc-highlight">Converting ZManaged to Resource</a></li></ul></li><li><a href="#cats-effect-3x" class="table-of-contents__link toc-highlight">Cats Effect 3.x</a><ul><li><a href="#type-class-instances-for-zios-task" class="table-of-contents__link toc-highlight">Type class Instances for ZIO&#39;s Task</a></li><li><a href="#converting-resource-to-zmanaged-1" class="table-of-contents__link toc-highlight">Converting Resource to ZManaged</a></li></ul></li><li><a href="#cats-core" class="table-of-contents__link toc-highlight">Cats Core</a></li><li><a href="#fs2-streams" class="table-of-contents__link toc-highlight">FS2 Streams</a><ul><li><a href="#from-fs2-stream-to-zstream" class="table-of-contents__link toc-highlight">From FS2 Stream to ZStream</a></li><li><a href="#from-zstream-to-fs2-stream" class="table-of-contents__link toc-highlight">From ZStream to FS2 Stream</a></li></ul></li><li><a href="#using-zqueue-with-cats-effect" class="table-of-contents__link toc-highlight">Using ZQueue with Cats Effect</a><ul><li><a href="#cats-effect-2x-1" class="table-of-contents__link toc-highlight">Cats Effect 2.x</a></li><li><a href="#cats-effect-3x-1" class="table-of-contents__link toc-highlight">Cats Effect 3.x</a></li></ul></li><li><a href="#using-stm-with-cats-effect" class="table-of-contents__link toc-highlight">Using STM with Cats Effect</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#using-zio-with-doobie" class="table-of-contents__link toc-highlight">Using ZIO with Doobie</a></li><li><a href="#http4s" class="table-of-contents__link toc-highlight">Http4s</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.7f3e08ea.js"></script>
<script src="/assets/js/main.84c81040.js"></script>
</body>
</html>